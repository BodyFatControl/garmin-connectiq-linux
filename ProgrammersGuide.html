<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>Monkey C Programmer's Guide</title>
	<meta name="author" content="Garmin International"/>
	<meta name="date" content="September 11, 2015"/>
	<link type="text/css" rel="stylesheet" href="resources/programmers-guide/style.css"/>
	<meta name="copyright" content="Monkey C Programmer's Guide version 1.1.3, Copyright 2015 Garmin, International."/>
</head>
<body>

<link href="resources/programmers-guide/google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
<script src="resources/programmers-guide/jquery-1.11.3.min.js"></script>
<script>
    $(document).ready( function() {
        $( 'pre' ).addClass( 'prettyprint' );
    } );
</script>
<script src="resources/programmers-guide/google-code-prettify/run_prettify.js"></script>
<div id="connect_iq_logo">
<figure>
<img src="resources/programmers-guide/connect_iq_logo.png" style="max-width:471px;" title="Powered by Garmin" />
</figure>
</div>
<div id="title">Monkey C Programmer&#8217;s Guide</div>
<div id="tagline">Garmin&#8217;s Programming Language for Wearables</div>
<div class="clear"></div>

<h1 id="tableofcontents">Table of Contents</h1>
<div id="toc">

<ul>
<li><a href="#tableofcontents">Table of Contents</a></li>
<li><a href="#welcometoconnectiq">Welcome to Connect IQ</a>

<ul>
<li><a href="#devicesandapis">Devices and APIs</a></li>
<li><a href="#thetaoofconnectiq">The Tao of Connect IQ</a></li>
<li><a href="#apptypes">App Types</a></li>
</ul></li>
<li><a href="#gettingstarted">Getting Started</a>

<ul>
<li><a href="#theconnectiqsdk">The Connect IQ SDK</a>

<ul>
<li><a href="#osxinstallation">OS X Installation</a></li>
<li><a href="#windowsinstallation">Windows Installation</a></li>
<li><a href="#basiccommands">Basic Commands</a></li>
</ul></li>
<li><a href="#theconnectiqsimulator">The Connect IQ Simulator</a></li>
<li><a href="#theeclipseplug-in">The Eclipse Plug-in</a>

<ul>
<li><a href="#installingtheeclipsexmleditor">Installing the Eclipse XML Editor</a></li>
<li><a href="#installingtheeclipseplug-in">Installing the Eclipse Plug-in</a></li>
<li><a href="#configuringtheeclipseplug-in">Configuring the Eclipse Plug-in</a></li>
</ul></li>
<li><a href="#generatingadeveloperkeyciq1.3">Generating a Developer Key (CIQ 1.3)</a>

<ul>
<li><a href="#generatingakeyusingopenssl">Generating a Key Using OpenSSL</a></li>
<li><a href="#generatingakeyusingtheeclipseplug-in">Generating a Key Using the Eclipse Plug-in</a></li>
</ul></li>
<li><a href="#creatingyourfirstproject">Creating Your First Project</a>

<ul>
<li><a href="#abouttheminimumsdkversionfield">About the Minimum SDK Version Field</a></li>
</ul></li>
<li><a href="#runningtheprogram">Running the Program</a>

<ul>
<li><a href="#aboutthetargetsdkversionfield">About the Target SDK Version Field</a></li>
</ul></li>
<li><a href="#importinganexample">Importing an Example</a></li>
<li><a href="#sideloadinganapp">Side Loading an App</a></li>
</ul></li>
<li><a href="#hellomonkeyc">Hello Monkey C!</a>

<ul>
<li><a href="#differencesfromotherlanguages">Differences From Other Languages</a>

<ul>
<li><a href="#java">Java</a></li>
<li><a href="#luajavascript">Lua/Javascript</a></li>
<li><a href="#rubypythonandphp">Ruby, Python, and PHP</a></li>
</ul></li>
<li><a href="#functions">Functions</a></li>
<li><a href="#variablesexpressionsandoperators">Variables, Expressions, and Operators</a>

<ul>
<li><a href="#keywords">Keywords</a></li>
<li><a href="#declaringvariables">Declaring Variables</a></li>
<li><a href="#arrays">Arrays</a></li>
<li><a href="#dictionaries">Dictionaries</a></li>
<li><a href="#symbols">Symbols</a></li>
<li><a href="#constants">Constants</a></li>
<li><a href="#enumerations">Enumerations</a></li>
<li><a href="#callingmethodsandfunctions">Calling Methods and Functions</a></li>
<li><a href="#ifstatements">If Statements</a></li>
<li><a href="#loops">Loops</a></li>
<li><a href="#returningvaluesfromfunctions">Returning Values From Functions</a></li>
<li><a href="#instanceofandhas">Instanceof and Has</a></li>
</ul></li>
<li><a href="#errors">Errors</a>

<ul>
<li><a href="#structuredexceptionhandling">Structured Exception Handling</a></li>
</ul></li>
<li><a href="#objects">Objects</a>

<ul>
<li><a href="#constructors">Constructors</a></li>
<li><a href="#inheritance">Inheritance</a></li>
<li><a href="#datahiding">Data Hiding</a></li>
<li><a href="#callbacks">Callbacks</a></li>
<li><a href="#weakreferencesciq1.2">Weak References (CIQ 1.2)</a></li>
</ul></li>
<li><a href="#modules">Modules</a>

<ul>
<li><a href="#usingstatements">Using Statements</a></li>
</ul></li>
<li><a href="#apisandapptypes">APIs and App Types</a></li>
<li><a href="#scoping">Scoping</a>

<ul>
<li><a href="#annotations">Annotations</a></li>
</ul></li>
</ul></li>
<li><a href="#resourcecompiler">Resource Compiler</a>

<ul>
<li><a href="#theresourcemodulea.k.a.rez">The Resource Module (a.k.a. Rez)</a>

<ul>
<li><a href="#referencingresourceswithinresourcefiles">Referencing Resources Within Resource Files</a></li>
</ul></li>
<li><a href="#bitmaps">Bitmaps</a></li>
<li><a href="#fonts">Fonts</a></li>
<li><a href="#appsettings">App Settings</a>

<ul>
<li><a href="#defininganappsetting">Defining an App Setting</a>

<ul>
<li><a href="#properties">Properties</a></li>
<li><a href="#settings">Settings</a></li>
</ul></li>
<li><a href="#accessingappsettingvalues">Accessing App Setting Values</a></li>
<li><a href="#changingsettingswithingarminconnectmobilegarminexpress">Changing Settings Within Garmin Connect Mobile/Garmin Express</a>

<ul>
<li><a href="#testingappsettings">Testing App Settings</a></li>
</ul></li>
</ul></li>
<li><a href="#overridingresources">Overriding Resources</a>

<ul>
<li><a href="#device-basedqualifiers">Device-based Qualifiers</a></li>
<li><a href="#family-basedqualfiers">Family-based Qualfiers</a></li>
</ul></li>
<li><a href="#buildfileexclusions">Build File Exclusions</a></li>
</ul></li>
<li><a href="#entrypointsandthemanifestfile">Entry Points And The Manifest File</a>

<ul>
<li><a href="#applicationattributes">Application Attributes</a>

<ul>
<li><a href="#goalviewsciq1.3">Goal Views (CIQ 1.3)</a></li>
</ul></li>
<li><a href="#products">Products</a></li>
<li><a href="#permissions">Permissions</a></li>
<li><a href="#intents2.2">Intents (2.2)</a>

<ul>
<li><a href="#exitingtoconnectiqapps">Exiting to Connect IQ Apps</a></li>
<li><a href="#exitingtonativeapps">Exiting to Native Apps</a></li>
<li><a href="#intentexceptions">Intent Exceptions</a></li>
</ul></li>
</ul></li>
<li><a href="#userinterface">User Interface</a>

<ul>
<li><a href="#drawablesviewsandlayouts">Drawables, Views, And Layouts</a>

<ul>
<li><a href="#defininglayoutsanddrawablesinresources">Defining Layouts And Drawables In Resources</a></li>
<li><a href="#usingalayout">Using a Layout</a></li>
<li><a href="#drawables">Drawables</a></li>
<li><a href="#customdrawables">Custom Drawables</a>

<ul>
<li><a href="#passingparameterstocustomdrawables">Passing Parameters to Custom Drawables</a></li>
</ul></li>
</ul></li>
<li><a href="#goalviewsciq1.3-1">Goal Views (CIQ 1.3)</a></li>
<li><a href="#inputhandling">Input Handling</a>

<ul>
<li><a href="#inputandapptypes">Input and App Types</a></li>
<li><a href="#inputdelegates">Input Delegates</a></li>
</ul></li>
<li><a href="#behaviors">Behaviors</a></li>
<li><a href="#builtinhandlers">Built In Handlers</a>

<ul>
<li><a href="#menu">Menu</a></li>
<li><a href="#genericpicker">Generic Picker</a>

<ul>
<li><a href="#userinterface-1">User Interface</a></li>
<li><a href="#developmentinterface">Development Interface</a></li>
</ul></li>
<li><a href="#numberpicker-_deprecated_">Number Picker - <em>DEPRECATED</em></a></li>
<li><a href="#confirmationdialog">Confirmation Dialog</a></li>
<li><a href="#progressbar">Progress Bar</a></li>
<li><a href="#datafield">Data Field</a></li>
</ul></li>
<li><a href="#selectablesandbuttonsciq2.1">Selectables and Buttons (CIQ 2.1)</a>

<ul>
<li><a href="#selectables">Selectables</a></li>
<li><a href="#buttons">Buttons</a></li>
<li><a href="#definingselectablesandbuttonsinlayouts">Defining Selectables And Buttons In Layouts</a></li>
</ul></li>
</ul></li>
<li><a href="#positioningandsensors">Positioning and Sensors</a>

<ul>
<li><a href="#location">Location</a></li>
<li><a href="#locationevents">Location Events</a></li>
<li><a href="#sensors">Sensors</a></li>
<li><a href="#sensorhistory2.1">Sensor History (2.1)</a></li>
<li><a href="#fitfilerecording">Fit File Recording</a>

<ul>
<li><a href="#recordingfitfilesciq1.3">Recording FIT Files (CIQ 1.3)</a></li>
<li><a href="#fitdeveloperfieldsciq1.3">FIT Developer Fields (CIQ 1.3)</a></li>
</ul></li>
<li><a href="#communicatingwithantantsensors">Communicating With ANT/ANT+ Sensors</a>

<ul>
<li><a href="#genericantchannels">Generic ANT channels</a>

<ul>
<li><a href="#burstdataciq2.2">Burst Data (CIQ 2.2)</a></li>
</ul></li>
<li><a href="#antprofilesciq2.2">ANT+ Profiles (CIQ 2.2)</a></li>
</ul></li>
</ul></li>
<li><a href="#communication">Communication</a>

<ul>
<li><a href="#approaches">Approaches</a>

<ul>
<li><a href="#garminconnectmobile">Garmin Connect Mobile</a>

<ul>
<li><a href="#authenticationciq1.3">Authentication (CIQ 1.3)</a></li>
<li><a href="#directinguserstowebcontentciq1.3">Directing Users to Web Content (CIQ 1.3)</a></li>
<li><a href="#downloadablecontent2.2">Downloadable Content (2.2)</a></li>
</ul></li>
<li><a href="#directmessaging">Direct Messaging</a></li>
</ul></li>
<li><a href="#persistedcontent2.2">Persisted Content (2.2)</a>

<ul>
<li><a href="#persistedcontentinthesimulator">Persisted Content in the Simulator</a></li>
</ul></li>
<li><a href="#mobilesdkdownloads">Mobile SDK Downloads</a></li>
<li><a href="#blesimulationoverandroiddebugbridge">BLE Simulation Over Android Debug Bridge</a></li>
</ul></li>
<li><a href="#dynamicdatafields">Dynamic Data Fields</a>

<ul>
<li><a href="#datafieldandsimpledatafield">Datafield and SimpleDataField</a></li>
<li><a href="#activityinfo">Activity Info</a></li>
<li><a href="#simulatingaworkout">Simulating a Workout</a></li>
</ul></li>
<li><a href="#howtotest">How To Test</a>

<ul>
<li><a href="#basicdebugging">Basic Debugging</a></li>
<li><a href="#runnoevil">Run No Evil</a>

<ul>
<li><a href="#asserts">Asserts</a></li>
<li><a href="#unittests">Unit Tests</a></li>
<li><a href="#runningunittests">Running Unit Tests</a></li>
</ul></li>
<li><a href="#handlingcrashes">Handling Crashes</a>

<ul>
<li><a href="#appcrashes">App Crashes</a></li>
<li><a href="#devicecrashes">Device Crashes</a></li>
<li><a href="#anoteaboutlogfiles">A Note About Log Files</a></li>
</ul></li>
</ul></li>
<li><a href="#howtopublish">How To Publish</a>

<ul>
<li><a href="#checksupportedproducts">Check Supported Products</a></li>
<li><a href="#exportingtheapp">Exporting the App</a></li>
<li><a href="#publishingthefirstversion">Publishing the First Version</a></li>
</ul></li>
<li><a href="#approvalprocess">Approval Process</a></li>
<li><a href="#appendices">Appendices</a>

<ul>
<li><a href="#appendixa:supportedlanguagequalifiers">Appendix A: Supported Language Qualifiers</a></li>
</ul></li>
</ul>
</div>

<h1 id="welcometoconnectiq">Welcome to Connect IQ</h1>

<p>Developing on wearable platforms is new and challenging. An app developer is asked to make dynamic user experiences that compare to what customers see on their mobile phones and web pages on small screens. If content is too dynamic, the device&#8217;s battery drains faster; if the user is charging the device, they are not using your app.</p>

<p>Connect IQ combines three W’s:</p>

<ol>
<li><strong>Wear</strong> - Garmin&#8217;s experience in power management, activity tracking, and <a href="http://www.thisisant.com/developer/ant-plus/ant-antplus-defined/" title="What are ANT and ANT+?">ANT or ANT+</a> sensors means you will spend more time wearing our product and less time charging it.</li>
<li><strong>Where</strong> - Location awareness is at the center of our products. Our products don’t become dead weight without a smart phone, but become more alive with one.</li>
<li><strong>Ware</strong> - Garmin&#8217;s new Connect IQ app system allows for developers to extend their apps into Garmin’s wearable ecosystem.</li>
</ol>

<p>Connect IQ products provide the best of what Garmin has to offer like beautiful design, location awareness, and efficient power management with the Connect IQ app system. Using the Connect IQ SDK, developers can create apps for Connect IQ devices and distribute them via the Connect IQ Store.</p>

<p>Monkey C is an object-oriented language built from the ground up, designed for easy app development on wearable devices. The goal of Monkey C is to round the sharp edges of making a wearable app, letting developers focus more on the customer and less on resource constraints. It uses reference counting to automatically clean up memory, freeing you from focusing on memory management. In addition, the resource compiler helps you import fonts and images to easily convert them between devices.</p>

<p>If you’ve worked with dynamic languages in the past like Java&trade;, PHP, Ruby, or Python&trade;, Monkey C should be very familiar.</p>

<h2 id="devicesandapis">Devices and APIs</h2>

<p>The problem of <em>API Fragmentation</em> is a challenge for app developers. If a developer takes advantage of new APIs, newer devices with less customer penetration may be targeted. If only established APIs are used, apps may not take advantage of new capabilities.</p>

<p>Unlike cell phones, Garmin devices are all wildly different from each other: round screens versus square screens, touch screens versus buttons, and a different array of sensors depending on device purpose. While the Java philosophy of &#8220;write once run anywhere&#8221; is a notable goal, creating a universal API that crosses every Garmin device would inevitably become a lowest common denominator API.</p>

<p>Rather than attempting to abstract away differences in devices, Connect IQ APIs are tailored to the devices they run on. If a device has a magnetometer, the device should have available the Magnetometer API. If two devices each have a magnetometer, the API should be the same between them. If a device does not have a magnetometer, it will not provide that API.</p>

<h2 id="thetaoofconnectiq">The Tao of Connect IQ</h2>

<p>There is a rhyme and reason behind Monkey C to make it easier for developers to support the Garmin ecosystem of products:</p>

<ol>
<li><p><strong>The developer chooses what devices to support</strong></p>

<p>Connect IQ apps can run across multiple devices, but the intended devices are up to the developer. Not every device will be aimed at the markets the developer wants to target or provide the experience the developer wants to provide. The developer should not be forced to support devices they don&#8217;t want to.</p></li>
<li><p><strong>The developer tools should help developers support multiple devices</strong></p>

<p>The developer tools lessen the weight of supporting multiple devices. The Resource Compiler hides device specific palettes and orientations from the developer. It also allows per device override of resources, allowing different images, fonts, and page layouts to be specified in the resources XML. The simulator needs to expose only the APIs a particular device supports so the developer can test device support.</p></li>
<li><p><strong>Similar devices should have similar APIs</strong></p>

<p>Not all devices will be equal, but there is often commonality between them. Two different watches may have different display technologies, but they both support bitmaps, fonts, user events, <a href="http://www.thisisant.com/developer/ant-plus/ant-antplus-defined/" title="What are ANT and ANT+?">ANT/ANT+</a>, and <a href="https://en.wikipedia.org/wiki/Bluetooth_low_energy" title="Bluetooth low energy">BLE</a>. A developer writing a sports app should not have to completely rewrite their app to support multiple devices.</p></li>
<li><p><strong>At runtime, the developer can ask what the system &#8216;has&#8217;</strong></p>

<p>Connect IQ applications are dynamically linked to the system. If an app makes a reference to an API that does not exist on a particular system, the app will fail at runtime when the app references the API, not at load time like C++. This allows an app to avoid making the call by taking advantage of the &#8216;<code>has</code>&#8217; operator.</p></li>
</ol>

<h2 id="apptypes">App Types</h2>

<p>There are four main use cases for third party developers to interact with the watch:</p>

<ul>
<li><strong>Watch Faces</strong> - These replace the main watch face and are the home screen of the watch.</li>
<li><strong>Data Fields</strong> - Data fields run within Garmin activities. They allow developers to compute values based off of the current activity, such as running, biking, etc.</li>
<li><strong>Widgets</strong> - Widgets are full screen pages that can be embedded into the main page loop. They are loaded when brought on-screen and shut down when the user switches to the next widget. Widgets will timeout and automatically shutdown after a device specific period of inactivity.</li>
<li><strong>Wearable Apps</strong> - Started from the action list, wearable apps can be used to implement use cases like third party activities, games, and other user-initiated actions. Apps push a page onto the UI and exit when the user backs out of the last page of the page stack. While running, the app has full control of the UI.</li>
</ul>

<h1 id="gettingstarted">Getting Started</h1>
<figure>
<img src="resources/programmers-guide/learning-monkey.png" style="max-width:408px;" title="What is step 3?" />
</figure>

<p>To use the Connect IQ SDK on all platforms Oracle Java&trade; Runtime Environment version 7 or higher is needed. <a href="http://java.com/en/download/">Download the JRE</a>.</p>

<h2 id="theconnectiqsdk">The Connect IQ SDK</h2>

<p>Download the latest version of the <a href="http://developer.garmin.com/connect-iq/sdk/">Connect IQ SDK</a> and unzip the connect-iq-sdk-x.y.z.zip file into a local directory. Installation specifics will vary depending on your operating system.</p>

<h3 id="osxinstallation">OS X Installation</h3>

<p>The first step for using Monkey C is to point your <code>PATH</code> to the Monkey C bin directory.</p>

<p>To add to a single local shell instance:</p>

<pre><code class="bash">$ export PATH=$PATH:path/to/monkeyc/bin
</code></pre>

<p>To add to a user profile:</p>

<pre><code class="bash">$ touch ~/.bash_profile
$ open ~/.bash_profile
</code></pre>

<p>The above opens <code>.bash_profile</code> in a text editor. Add the line below to the file and save the changes:</p>

<pre><code class="bash">$ export PATH=$PATH:path/to/monkeyc/bin
</code></pre>

<h3 id="windowsinstallation">Windows Installation</h3>

<p>This release works from the Windows NT shell.</p>

<p>The first step for using Monkey C is to point your <code>PATH</code> to the Monkey C bin directory:</p>

<pre><code>&gt; set PATH=%PATH%;path\to\monkeyc\bin
</code></pre>

<h3 id="basiccommands">Basic Commands</h3>

<p>After installation, three new shell commands will be available: <code>connectiq</code>, <code>monkeyc</code>, and <code>monkeydo</code>.</p>

<ul>
<li><p><code>connectiq</code> launches the Monkey C simulator. Use this simple command to start the simulator in the background.</p></li>
<li><p><code>monkeyc</code> calls the Monkey C compiler. The compiler can take code from multiple files and link them together into a single Monkey C executable (a PRG file). The optional <code>-z</code> argument allows resource files to be passed in. If your project uses multiple resource files separate them with the system path separator (&#8216;<code>;</code>&#8217; in Windows and &#8216;<code>:</code>&#8217; in OSX). This allows the addition of bitmaps, drawables, fonts, strings, and menus to your executable. See the samples directory for a sample resource file.</p></li>
</ul>

<p>The usage is:</p>

<pre><code>&gt; monkeyc -o &lt;output.prg&gt; -m &lt;manifest.xml&gt; [-z resource.xml;resource2.xml] &lt;file1.mc&gt; [file2.mc]...
</code></pre>

<ul>
<li><code>monkeydo</code> runs a Monkey C executable in the simulator. You must have previously started the simulator with <code>connectiq</code>. The usage is:</li>
</ul>

<pre><code>&gt; monkeydo myApp.prg
</code></pre>

<p>An example of a typical build cycle:</p>

<pre><code>&gt; connectiq
&gt; monkeyc -o myApp.prg -m manifest.xml myApp.mc
&gt; monkeydo myApp.prg
</code></pre>

<h2 id="theconnectiqsimulator">The Connect IQ Simulator</h2>

<p>The Connect IQ Simulator can be used to run apps on your computer before running them on your device. When running an app in the simulator your app will only have access to those APIs that are available on the currently simulated device. For example, an API only available in Biker Monkey, such as <code>PersistedContent</code>, will not be available to devices that run Aikido Monkey. The generic watches, such as square watch, have access to all the Connect IQ APIs.</p>

<h2 id="theeclipseplug-in">The Eclipse Plug-in</h2>

<p>The Connect IQ Eclipse plug-in turns Eclipse into a Monkey C development environment. Its features include:</p>

<ul>
<li>Syntax highlighting editor</li>
<li>Build integration</li>
<li>Integrated execution of applications in the Connect IQ simulator</li>
</ul>

<p>The Connect IQ plug-in requires either the Standard Edition or IDE for Java Developers (either 32 or 64 bit) of <a href="http://www.eclipse.org/" title="Eclipse">Eclipse Mars or newer</a>. Once Eclipse is installed, install the plug-in with the following steps.</p>

<h3 id="installingtheeclipsexmleditor">Installing the Eclipse XML Editor</h3>

<p>Before you can install the Connect IQ plug-in you must make sure you have the Eclipse XML editor and tools installed.</p>

<ol>
<li><p>In the top menu, go to <em>Help &gt; Install New Software</em>:</p></li>
<li><p>Select your Eclipse distribution (Mars, Neon, etc) from the available update sites.</p></li>
<li><p>Find and mark the check box next to <em>Web, XML, Java EE and OSGi Enterprise Development &gt; Eclipse XML Editor and Tools</em>.</p>
<figure>
<img src="resources/programmers-guide/xml_editor.png" style="max-width:622px;" title="Eclipse XML Editor and Tools" />
</figure></li>
</ol>

<h3 id="installingtheeclipseplug-in">Installing the Eclipse Plug-in</h3>

<ol>
<li><p>In the top menu, go to <em>Help &gt; Install New Software</em>:</p>
<figure>
<img src="resources/programmers-guide/install_new_software.png" style="max-width:616px;" title="The install new software window" />
</figure></li>
<li><p>Use the <em>Add&#8230;</em> button to add <em>http://developer.garmin.com/downloads/connect-iq/eclipse/</em>:</p>
<figure>
<img src="resources/programmers-guide/edit_site.png" style="max-width:489px;" title="The edit site dialog box" />
</figure></li>
<li><p>Mark the check box next to Connect IQ in the list and hit <em>Next</em>:</p>
<figure>
<img src="resources/programmers-guide/update_sites.png" style="max-width:616px;" title="The newly added Connect IQ update site" />
</figure></li>
<li><p>Dependent plug-in modules may need to be downloaded and installed. When this is complete, restart Eclipse to complete the installation.</p></li>
</ol>

<h3 id="configuringtheeclipseplug-in">Configuring the Eclipse Plug-in</h3>

<ol>
<li><p>Next, the plug-in will need to know where to find the Connect IQ SDK. To set this, go to the <em>Window &gt; Preferences</em> menu (Windows), or to <em>Eclipse &gt; Preferences</em> (Mac):</p>
<figure>
<img src="resources/programmers-guide/eclipse_prefs.png" style="max-width:735px;" title="The Eclipse Preferences window" />
</figure></li>
<li><p>Click the <em>Browse</em> button and add the path to your Connect IQ SDK directory. Make sure it is referencing the root directory of the SDK and not the <code>bin</code> subdirectory.</p></li>
<li><p>Add the Connect IQ perspective to Eclipse by selecting <em>Window &gt; Open Perspective &gt; Other&#8230;</em> and then select <em>Connect IQ</em>:</p>
<figure>
<img src="resources/programmers-guide/perspective.png" style="max-width:359px;" title="Selecting the Connect IQ persepctive" />
</figure></li>
</ol>

<h2 id="generatingadeveloperkeyciq1.3">Generating a Developer Key (CIQ 1.3)</h2>

<p>The Connect IQ compiler requires a developer key be provided to for signing when compiling and packaging apps. The required key must be a RSA 4096 bit private key.</p>

<p><strong>Note</strong>: It&#8217;s important you keep track of the key you use to sign app packages. You will need to use the same key to sign updates to an existing app on the store. If you lose your original signing key you will not be able to update your app.</p>

<h3 id="generatingakeyusingopenssl">Generating a Key Using OpenSSL</h3>

<p>If you&#8217;re working from the command line you can generate a RSA key using <a href="https://www.openssl.org/">OpenSSL</a>. The following command will generate a valid signing key.</p>

<pre><code>&gt; openssl genrsa -out developer_key.pem 4096
&gt; openssl pkcs8 -topk8 -inform PEM -outform DER -in developer_key.pem -out developer_key.der -nocrypt
</code></pre>

<p>This developer key, <code>developer_key.der</code>, is passed to the compiler using the <code>-y</code> command line option.</p>

<h3 id="generatingakeyusingtheeclipseplug-in">Generating a Key Using the Eclipse Plug-in</h3>

<p>If you&#8217;re using the Eclipse Plug-in there is a key generation utility built in. The tool can be accessed through the compiler preferences page (<em>Preferences &gt; Connect IQ &gt; Compiler</em>). Clicking the <em>Generate</em> button will open the wizard. Set the output path in the wizard and click <em>Finish</em>.</p>
<figure>
<img src="resources/programmers-guide/generate_key_wizard.png" style="max-width:814px;" title="The key generation wizard" />
</figure>

<p>The developer key specified in the Connect IQ compiler preferences will automatically be passed to the compiler when a project is compiled.</p>

<h2 id="creatingyourfirstproject">Creating Your First Project</h2>

<ol>
<li><p>Click the <em>File</em> menu, and choose <em>New &gt; Project</em></p></li>
<li><p>Select <em>Connect IQ Project</em> and click <em>Next</em> to continue:</p>
<figure>
<img src="resources/programmers-guide/new_project.png" style="max-width:525px;" title="Creating a new Connect IQ project" />
</figure></li>
<li><p>Enter a name for your project and click <em>Next</em>:</p>
<figure>
<img src="resources/programmers-guide/project_name.png" style="max-width:525px;" title="Entering the name of the project" />
</figure></li>
<li><p>Set the project type to <em>Watch Face</em></p></li>
<li><p>Check the <em>Square Watch</em> and <em>Round Watch</em> target platforms, leaving the minimum SDK version at the default, and click <em>Next</em>:</p>
<figure>
<img src="resources/programmers-guide/project_type.png" style="max-width:525px;" title="Selecting the project type" />
</figure></li>
<li><p>Select the <em>Simple</em> template, upon which the project will be based:</p>
<figure>
<img src="resources/programmers-guide/new_project_template.png" style="max-width:525px;" title="Selecting the project template" />
</figure></li>
<li><p>Select <em>English</em> as the supported language, and click <em>Finish</em>:</p>
<figure>
<img src="resources/programmers-guide/new_project_language.png" style="max-width:525px;" title="Selecting the supported languages" />
</figure>

<p>Eclipse will create the project and move to the Connect IQ perspective. Once the project is initialized, the following project elements will be created automatically:</p>
<figure>
<img src="resources/programmers-guide/new_project_structure.png" style="max-width:264px;" title="The basic structure of a new Connect IQ project" />
</figure></li>
</ol>

<dl>
<dt>bin</dt>
<dd>Contains binary and debug output from the app compilation</dd>

<dt>resources</dt>
<dd>Inputs to the resource compiler, such as layouts, images, fonts, and strings, and language-specific resources</dd>

<dt>source</dt>
<dd>Contains the Monkey C source files, initially broken into &#8216;App&#8217; and &#8216;View&#8217; files</dd>

<dt>manifest.xml</dt>
<dd>Application properties like the app id, the app type, and the targeted devices</dd>
</dl>

<h3 id="abouttheminimumsdkversionfield">About the Minimum SDK Version Field</h3>

<p>The minimum SDK version allows you to configure device compatibility by enforcing that only devices that support, at a minimum, the SDK version you&#8217;ve selected to be enabled for your app.
For example, if your app relies heavily on a feature of the <strong>2.1.x</strong> SDK, such as the <strong>Sensor History</strong> feature, you can set your minimum SDK version to <strong>2.1.x</strong> and the list of available devices will be pruned such that you cannot select an incompatible product.</p>

<h2 id="runningtheprogram">Running the Program</h2>

<p>Before running the app for the first time, you may wish to set up a <em>Run Configuration</em> in Eclipse, a pre-selected set of options with which to run a project to help speed development. For example, you may create one to execute your app as a widget on the f&emacr;nix 3. Once configured, new run configurations only need to be added if new app or device configurations are needed.</p>

<p>To add a run configuration:</p>

<ol>
<li><p>Click the <em>Run &gt; Run Configurations</em> menu</p></li>
<li><p>Right click on the <em>Connect IQ App</em> option in the list on the left side of the window, and select <em>New</em>:</p>

<p><figure>
<img src="resources/programmers-guide/run_configuration.png" style="max-width:729px;" title="Creating a Run Configuration" /></p></li>
<li><p>Give the configuration a name at the top</p></li>
<li><p>Choose the Connect IQ project that will use this configuration (It should automatically select your current project, but the Project button can be used to select a different one)</p></li>
<li><p>Choose a target device</p></li>
<li><p>Select the SDK version to target. Only SDK versions compatible with your selected device will be displayed.</p></li>
<li><p>Click <em>Apply</em> and <em>Close</em>:</p></li>
</ol>

<p>Before running your program, start the Connect IQ simulator by clicking the <em>Connect IQ</em> menu and selecting <em>Start Simulator</em>, or clicking on the start simulator icon <img src="resources/programmers-guide/sim_icon.png" style="max-width:16px;" /> in the toolbar. A blank simulator window will appear.</p>

<p>With a Run Configuration created and the simulator started, you&#8217;re ready to go! Use the down arrow next to the <em>Run &gt; Run Configurations</em> menu (or from the <em>Run Configurations</em> selector on the toolbar) to select your configuration.</p>

<p>If all goes well the following run output will appear in the console:</p>

<pre><code>Found Transport: tcp
Connecting...
Connecting to device...
Device Version 0.1.0
Device id 1 name &quot;A garmin device&quot;
Shell Version 0.1.0
Connection Finished
Closing shell and usb
</code></pre>

<p>&#8230;and the watch will appear in the simulator:</p>
<figure>
<img src="resources/programmers-guide/first_app.png" style="max-width:304px;" title="The app running in the simulator" />
</figure>

<h3 id="aboutthetargetsdkversionfield">About the Target SDK Version Field</h3>

<p>The target SDK version field is populated with the versions of the SDK that the device you&#8217;ve selected supports. When selecting a target SDK, you are telling the compiler to target that SDK&#8217;s feature set when building your app.</p>

<h2 id="importinganexample">Importing an Example</h2>

<p>To try one of the Connect IQ sample apps, import it into your Eclipse workspace:</p>

<ol>
<li><p>Click the <em>File</em> menu</p></li>
<li><p>Select <em>Import&#8230;</em></p></li>
<li><p>Choose <em>Existing Projects into Workspace</em> under the <em>General</em> section of the window, and click <em>Next</em>:</p>
<figure>
<img src="resources/programmers-guide/import_select.png" style="max-width:525px;" title="Selecting an existing project to import" />
</figure></li>
<li><p>Click the <em>Browse</em> button and select the root directory of the sample to import:</p>
<figure>
<img src="resources/programmers-guide/import_project.png" style="max-width:525px;" title="Choosing the location of the project to import" />
</figure></li>
<li><p>Check all projects to import that are listed in the Projects window (in the example above, only one project is listed)</p></li>
<li><p>If there are multiple projects in the root directory, check <em>Search for nested projects</em> to ensure that Eclipse locates all potential projects</p></li>
<li><p>If you prefer to work with a copy of the project, check <em>Copy projects into workspace</em></p></li>
<li><p>Click <em>Finish</em> to complete the import</p></li>
</ol>

<h2 id="sideloadinganapp">Side Loading an App</h2>

<p>The Eclipse plug-in provides a wizard to help developers side load an application. Here&#8217;s how to use it:</p>

<ol>
<li><p>Click the <em>Connect IQ</em> menu</p></li>
<li><p>Select <em>Build Project for Device</em> to open the wizard</p></li>
<li><p>Choose the project and device for which you wish to build from the drop down menus</p></li>
<li><p>Select the SDK version you would like to target. Only SDK versions compatible with the selected device will be displayed.</p></li>
<li><p>Set the path to the private key to use to sign your app. See <a href="#generatingakeyusingtheeclipseplug-in">Generating a Key Using the Eclipse Plug-in</a> for instructions on creating a key.</p></li>
<li><p>Set the output directory to your device&#8217;s <code>GARMIN/APPS</code> directory</p></li>
<li><p>Click the <em>Build</em> button.</p>
<figure>
<img src="resources/programmers-guide/build_for_device.png" style="max-width:525px;" title="The Build for Device Wizard" />
</figure></li>
</ol>

<p>The wizard will create an executable (PRG) of the selected project and save it to your device for testing.</p>

<p>If you are unable to choose a device for which to build (the menu appears empty), it means that there are no valid devices configured for your project. For example, the Square Watch and Round Watch device types are valid for simulation only and do not represent physical devices for which apps may be built.</p>

<p>To configure additional target platforms for your project:</p>

<ol>
<li><p>Right click on the project in the project explorer, and choose <em>Properties</em></p></li>
<li><p>Check the desired target platforms in the properties window</p>
<figure>
<img src="resources/programmers-guide/project_properties.png" style="max-width:635px;" title="Selecting the project type" />
</figure></li>
</ol>

<h1 id="hellomonkeyc">Hello Monkey C!</h1>
<figure>
<img src="resources/programmers-guide/smart-monkey.png" style="max-width:300px;" title="Code Monkey get up get coffee..." />
</figure>

<p>There is no better way to learn Monkey C than by jumping right in. Let&#8217;s take a look at the application object of a watch face.</p>

<pre><code class="java">using Toybox.Application as App;
using Toybox.System;

class MyProjectApp extends App.AppBase {

    // onStart() is called on application start up
    function onStart(state) {
    }

    // onStop() is called when your application is exiting
    function onStop(state) {
    }

    // Return the initial view of your application here
    function getInitialView() {
        return [ new MyProjectView() ];
    }
}
</code></pre>

<p>If this looks familiar and non-threatening, that&#8217;s the point. Monkey C is intended to be the language you didn&#8217;t know you already knew.</p>

<p>At the top is a using statement, which is analogous to C++&#8217;s <code>using</code> statement, or an <code>import</code> in Java&trade;, Ruby, or Python&trade;. <code>using</code> statements lexically bring modules into our name space. After a <code>using</code> clause, we can refer to a module by its shortened name (in this case <code>System</code>). <code>Toybox</code> is the root module for Monkey C system modules; all the cool toys are kept in there.</p>

<p>To print out values to the debug console, use:</p>

<pre><code class="java">System.println( &quot;Hello Monkey C!&quot; );
</code></pre>

<p><code>System</code> refers to the <code>Toybox.System</code> module we imported with the <code>using</code> statement. Unlike Java namespaces, modules in Monkey C are static objects that can contain functions, classes, and variables. The <code>println()</code> function should be familiar to Java programmers&mdash;it prints a string and automatically adds a new line. The <code>System</code> module has a number of useful functions:</p>

<pre><code class="java">// Use println() to print to the console with a line terminator.
// @param a Object or string to display
function println(a)
{
    print( a.toString() + &quot;\n&quot; );
}

// Use print() to print to the console
// @param x Object or string to display
function print( x );

// Use getTimer() to get the current millisecond timer.
// @return [Number] System millisecond timer
function getTimer();

// Get the current clock time with getClockTime().
// @return [System.ClockTime] Current clock time
function getClockTime();

// Get the current system stats with getSystemStats().
// @return [System.Stats] Current system stats
function getSystemStats();

// In future versions of the SDK trap() will break into the debugger.
function trap();

// To end execution of the current system with an error message of
// &quot;User terminated&quot;, call exit().
function exit();

// Call error() to cause an error. This will exit the system.
// @param [String] msg Error message to output
function error( msg );
</code></pre>

<h2 id="differencesfromotherlanguages">Differences From Other Languages</h2>

<p>As Italian and Spanish derive from Latin, Monkey C derives heavily from past languages. C, Java&trade;, JavaScript, Python&trade;, Lua, Ruby, and PHP all influenced the design for Monkey C. If you are familiar with any of those languages, Monkey C should be easy to pick up.</p>

<h3 id="java">Java</h3>

<p>Like Java, Monkey C compiles into byte code that is interpreted by a virtual machine. Also like Java, all objects are allocated on the heap, and the virtual machine cleans up memory (Java through garbage collection, Monkey C through reference counting). Unlike Java, Monkey C does not have primitive types&mdash;integers, floats, and chars are objects. This means primitives can have methods just like other objects.</p>

<p>While Java is a statically typed language, Monkey C is <a href="https://en.wikipedia.org/wiki/Duck_typing"><em>duck typed</em></a>. In Java, the developer must declare the types for all parameters of a function, and declare the return value type. The Java compiler checks these at compile time to ensure type safety. Duck typing is the concept of &#8220;if it walks like a duck, and quacks like a duck, then it must be a duck&#8221;<a href="#fn:1" id="fnref:1" title="see footnote" class="footnote">[1]</a>. For example:</p>

<pre><code class="java">function add( a, b ) {
    return a + b;
}

function thisFunctionUsesAdd() {
    var a = add( 1, 3 ); // Return  4
    var b = add( &quot;Hello &quot;, &quot;World&quot; ); // Returns &quot;Hello World&quot;
}
</code></pre>

<p>The Monkey C compiler does not verify type safety, and instead causes a runtime error if a function mishandles a method.</p>

<p>Monkey C modules serve a similar purpose as Java packages, but unlike packages, modules can contain variables and functions. It is common for static methods to exist in the module as opposed to a particular class.</p>

<h3 id="luajavascript">Lua/Javascript</h3>

<p>The main difference between JavaScript or Lua and Monkey C is that functions in Monkey C are not first class. In JavaScript, a function can be passed to handle a callback:</p>

<pre><code class="javascript">function wakeMeUpBeforeYouGoGo() {
    // Handle completion
}

// Do a long running thing, and pass callback to call when done.
doLongRunningTask( wakeMeUpBeforeYouGoGo );
</code></pre>

<p>In Lua, to create an object, you bind functions to a hash table:</p>

<pre><code class="lua">function doSomethingFunction( me ) {
    // Do something here
}

// Constructor for MyObject
function newMyObject() {
    local result = {};
    result[&quot;doSomething&quot;] = doSomethingFunction;
}
</code></pre>

<p>Neither of these techniques works in Monkey C, because functions are bound to the object they are created in.</p>

<p>To create a callback in Monkey C, create a <em>Method object</em>. Method objects are a combination of the function and the object instance or module they originate from. You can then call the method using <code>method()</code>:</p>

<pre><code class="java">// Handle completion of long
function wakeMeUpBeforeYouGoGo() {
    // Do something here
}

// Create a call back with the method method (jinx!)
doLongRunningTask( method( :wakeMeUpBeforeYouGoGo ) );
</code></pre>

<h3 id="rubypythonandphp">Ruby, Python, and PHP</h3>

<p>Objects in Ruby and Python are hash tables, and have many of the properties of hash tables. Functions and variables can be added to objects at run time.</p>

<p>Monkey C objects are compiled and cannot be modified at runtime. All variables have to be declared before they can be used, either in the local function, the class instance, or in the parent module.</p>

<p>When importing a module, all classes inside the module have to be referenced through their parent module. You import modules, not classes, into your namespace.</p>

<h2 id="functions">Functions</h2>

<p>Functions are the meat<a href="#fn:2" id="fnref:2" title="see footnote" class="footnote">[2]</a> of your program. Functions define discrete callable units of code.</p>

<p>Monkey C functions can take arguments, but because Monkey C is a dynamically typed language the argument types is not declared; just its name. Also, it is not necessary to declare the return value of a function, or even if a function returns a value, because all functions return values. You can specify the return value with a <code>return</code> statement, but if your function doesn&#8217;t have a <code>return</code> statement it will return the last value on the stack.</p>

<p>Functions can exist in a class or module, or appear in the global module.</p>

<h2 id="variablesexpressionsandoperators">Variables, Expressions, and Operators</h2>

<p>The basic types supported by Monkey C are:</p>

<ul>
<li><strong>Integers</strong> - 32-bit signed integers</li>
<li><strong>Floats</strong> - 32-bit floating point numbers</li>
<li><strong>Longs</strong> – 64-bit signed integers</li>
<li><strong>Doubles</strong> – 64-bit floating point numbers</li>
<li><strong>Booleans</strong> - <code>true</code> and <code>false</code></li>
<li><strong>Chars</strong> - Unicode characters</li>
<li><strong>Strings</strong> - strings of characters</li>
<li><strong>Objects</strong> – Instantiated objects (defined with the class keyword)</li>
<li><strong>Arrays</strong> - Allocated with the syntax <code>new [X]</code> where &#8216;X&#8217; is an expression computing the size of the array</li>
<li><strong>Dictionaries</strong> - Associative arrays, allocated with the syntax <code>{}</code></li>
</ul>

<h3 id="keywords">Keywords</h3>

<p>Here is a list of keywords in the Monkey C programming language. You cannot use any of the following as variables or symbols in your programs. The keywords <code>switch</code>, <code>case</code>, and <code>native</code> are reserved, even though they are not currently used. <code>true</code>, <code>false</code>, <code>null</code>, <code>NaN</code>, <code>new</code>, <code>and</code>, and <code>or</code> might seem like keywords, but they are actually literals and operators; you cannot use them as identifiers in your programs.</p>
<div id="test">

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:center;"/>
<col style="text-align:center;"/>
<col style="text-align:center;"/>
<col style="text-align:center;"/>
<col style="text-align:center;"/>
<col style="text-align:center;"/>
</colgroup>

<tbody>
<tr>
	<td style="text-align:center;">break</td>
	<td style="text-align:center;">const</td>
	<td style="text-align:center;">else</td>
	<td style="text-align:center;">for</td>
	<td style="text-align:center;">if</td>
	<td style="text-align:center;">static</td>
	<td style="text-align:center;">using</td>
</tr>
<tr>
	<td style="text-align:center;">case</td>
	<td style="text-align:center;">continue</td>
	<td style="text-align:center;">enum</td>
	<td style="text-align:center;">function</td>
	<td style="text-align:center;">instanceof</td>
	<td style="text-align:center;">switch</td>
	<td style="text-align:center;">var</td>
</tr>
<tr>
	<td style="text-align:center;">catch</td>
	<td style="text-align:center;">default</td>
	<td style="text-align:center;">extends</td>
	<td style="text-align:center;">has</td>
	<td style="text-align:center;">module</td>
	<td style="text-align:center;">throw</td>
	<td style="text-align:center;">while</td>
</tr>
<tr>
	<td style="text-align:center;">class</td>
	<td style="text-align:center;">do</td>
	<td style="text-align:center;">finally</td>
	<td style="text-align:center;">hidden</td>
	<td style="text-align:center;">return</td>
	<td style="text-align:center;">try</td>
</tr>
</tbody>
</table>
</div>

<h3 id="declaringvariables">Declaring Variables</h3>

<p>All local variables must be declared ahead of time using the <code>var</code> keyword. In the Monkey C language, all values (including numeric values) are objects.</p>

<pre><code class="java">var n = null;               // Null reference
var x = 5;                  // 32-bit signed integers
var y = 6.0;                // 32-bit floating point
var l = 5l;                 // 64-bit signed integers
var d = 4.0d;               // 64-bit floating point
var bool = true;            // Boolean (true or false)
var c = 'x';                // Unicode character
var str = &quot;Hello&quot;;          // String
var arr = new [20 + 30];    // Array of size 50
var dict = { x=&gt;y };        // Dictionary: key is 5, value is 6.0
var z = arr[2] + x;         // Null pointer waiting to happen
</code></pre>

<p>Monkey C supports the following operators:</p>
<div id="operators">

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Precedence</th>
	<th style="text-align:center;">Operator</th>
	<th style="text-align:left;">Description</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;">1</td>
	<td style="text-align:center;"><code>new</code></td>
	<td style="text-align:left;">creation</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>!</code></td>
	<td style="text-align:left;">logical NOT</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>~</code></td>
	<td style="text-align:left;">bitwise NOT</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>( )</code></td>
	<td style="text-align:left;">function invocation</td>
</tr>
<tr>
	<td style="text-align:center;">2</td>
	<td style="text-align:center;"><code>*</code></td>
	<td style="text-align:left;">multiplication</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>/</code></td>
	<td style="text-align:left;">division</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>%</code></td>
	<td style="text-align:left;">modulo</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>&amp;</code></td>
	<td style="text-align:left;">bitwise AND</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>&lt;&lt;</code></td>
	<td style="text-align:left;">left shift</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>&gt;&gt;</code></td>
	<td style="text-align:left;">right shift</td>
</tr>
<tr>
	<td style="text-align:center;">3</td>
	<td style="text-align:center;"><code>+</code></td>
	<td style="text-align:left;">addition</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>-</code></td>
	<td style="text-align:left;">subtraction</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>|</code></td>
	<td style="text-align:left;">bitwise OR</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>^</code></td>
	<td style="text-align:left;">bitwise XOR</td>
</tr>
<tr>
	<td style="text-align:center;">4</td>
	<td style="text-align:center;"><code>&lt;</code></td>
	<td style="text-align:left;">less than</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>&lt;=</code></td>
	<td style="text-align:left;">less than or equals</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>&gt;</code></td>
	<td style="text-align:left;">greater than</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>&gt;=</code></td>
	<td style="text-align:left;">greater than or equals</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>==</code></td>
	<td style="text-align:left;">equals</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>!=</code></td>
	<td style="text-align:left;">not equals</td>
</tr>
<tr>
	<td style="text-align:center;">5</td>
	<td style="text-align:center;"><code>&amp;&amp;</code></td>
	<td style="text-align:left;">logical AND</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>and</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;">6</td>
	<td style="text-align:center;"><code>||</code></td>
	<td style="text-align:left;">logical OR</td>
</tr>
<tr>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"><code>or</code></td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>
</div>

<h3 id="arrays">Arrays</h3>

<p>Arrays in Monkey C, like variables, are typeless, it is not necessary to declare a data type. There are two forms for creating a new array. To create an empty array of a fixed <code>size</code>, use this:</p>

<pre><code class="java">var array = new [size];
</code></pre>

<p>To pre-initialize an array, this syntax can be used:</p>

<pre><code class="java">var array = [1, 2, 3, 4, 5];
</code></pre>

<p>Elements are expressions, so multidimensional arrays can be created using this syntax:</p>

<pre><code class="java">var array = [ [1,2], [3,4] ];
</code></pre>

<p>Monkey C does not have a direct way of creating an empty two-dimensional array, one may be initialized with this syntax:</p>

<pre><code class="java">// Shout out to all the Java programmers in the house
var array = new [first_dimension_size];

// Initialize the sub-arrays
for( var i = 0; i &lt; first_dimension_size; i += 1 ) {
    array[i] = new [second_dimension_size];
}
</code></pre>

<h3 id="dictionaries">Dictionaries</h3>

<p>Dictionaries, or associative arrays, are a built-in data structure in Monkey C:</p>

<pre><code class="java">var dict = { &quot;a&quot; =&gt; 1, &quot;b&quot; =&gt; 2 };  // Creates a dictionary
System.println( dict[&quot;a&quot;] );        // Prints &quot;1&quot;
System.println( dict[&quot;b&quot;] );        // Prints &quot;2&quot;
System.println( dict[&quot;c&quot;] );        // Prints &quot;null&quot;
</code></pre>

<p>To initialize an empty dictionary, use the following syntax:</p>

<pre><code class="java">var x = {};                         // Empty dictionary
</code></pre>

<p>By default, objects hash on their reference value. Classes should override the <code>hashCode()</code> method in <code>Toybox.Lang.Object</code> to change the hashing function for their type:</p>

<pre><code class="java">class Person
{
    // Return a number as the hash code. Remember that the hash code must be
    // the same for two objects that are equal.
    // @return Hash code value
    function hashCode() {
        // Using the unique person id for the hash code
        return mPersonId;
    }
}
</code></pre>

<p>Dictionaries automatically resize and rehash as the contents grow or shrink. This makes them extremely flexible, but it comes at a cost. Insertion and removal of the contents can cause performance problems if there is accidental or excessive resizing and rehashing. Also, because hash tables require extra space for allocation, they are not as space-efficient as either objects or arrays.</p>

<h3 id="symbols">Symbols</h3>

<p>Symbols are lightweight constant identifiers. When the Monkey C compiler finds a new symbol, it will assign it a new unique value. This allows symbols to be used as keys or constants without explicitly declaring a const or enum:</p>

<pre><code class="java">var a = :symbol_1;
var b = :symbol_1;
var c = :symbol_2;
Sys.println( a == b );  // Prints true
Sys.println( a == c );  // Prints false
</code></pre>

<p>Symbols can be useful when wanting to create keys without having to declare an enum:</p>

<pre><code class="java">var person = { :firstName=&gt;&quot;Bob&quot;, :lastName=&gt;&quot;Jones&quot; };
</code></pre>

<h3 id="constants">Constants</h3>

<p>Constants are named, immutable values declared with the <code>const</code> keyword. These are useful for storing unchanging values that may be used repeatedly throughout code. Constants must be declared at the module or class level; they cannot be declared within a function.</p>

<p>Constants support the same types as <a href="#declaringvariables">listed for variables</a>. It is important to note that with data structures like arrays, <code>const</code> functions similar to Java&#8217;s <code>final</code> keyword. For example, a <code>const</code> array prevents the array from being replaced by a new instance, but the elements of the array may be modified.</p>

<pre><code class="java">const PI = 3.14;
const EAT_BANANAS = true;
const BANANA_YELLOW = &quot;#FFE135&quot;;
</code></pre>

<h3 id="enumerations">Enumerations</h3>

<p>Enumerations are explicit or auto-incrementing constant mappings from symbol to integer. Unless explicity set (see the second example), each proceeding symbol is automatically assigned the value of its predecessor plus one, starting with <code>0</code>. So, in the following example, the symbol Monday is automatically assigned the value <code>0</code>, Tuesday is assigned <code>1</code>, and so on. These symbols can be used just like constant variables (which is essentially what they are). Enums must be declared at the module or class level; they cannot be declared within a function.</p>

<pre><code class="java">enum {
    Monday,   // Monday = 0
    Tuesday,  // Tuesday = 1
    Wednesday // Wednesday = 2
    // ...and so on
}
</code></pre>

<pre><code class="java">enum {
    x = 1337, // x = 1337
    y,        // y = 1338
    z,        // z = 1339
    a = 0,    // a = 0
    b,        // b = 1
    c         // c = 2
}
</code></pre>

<p>Note that assigning anything other than an integer will cause an error.</p>

<h3 id="callingmethodsandfunctions">Calling Methods and Functions</h3>

<p>To call a method within your own class or module, simply use the function call syntax:</p>

<pre><code class="java">function foo( a ) {
    //Assume foo does something really impressive
}

function bar() {
    foo( &quot;hello&quot; );
}
</code></pre>

<p>If calling on an instance of an object, precede the call with the object and a &#8216;<code>.</code>&#8217;.</p>

<h3 id="ifstatements">If Statements</h3>

<p><code>if</code> statements allow branch points in your code:</p>

<pre><code class="java">myInstance.methodToCall( parameter );

if ( a == true ) {
    // Do something
} else if ( b == true ) {
    // Do something else
} else {
    // If all else fails
}

// Monkey C also supports the ternary operator
var result = a ? 1 : 2;
</code></pre>

<p>The expression inside the <code>if</code> statement is required to be an expression; assignments are not allowed. Things that will evaluate to true are:</p>

<ul>
<li><code>true</code></li>
<li>A non-zero integer</li>
<li>A non-null object</li>
</ul>

<h3 id="loops">Loops</h3>

<p>Monkey C supports <code>for</code> loops, <code>while</code> loops, and <code>do/while</code> loops. <code>while</code> and <code>do/while</code> loops have a familiar syntax:</p>

<pre><code class="java">// do/while loop
do {
    // Code to do in a loop
}
while( expression );

// while loop
while( expression ) {
    // Code to do in a loop
}
</code></pre>

<p>Loops must have braces around them because single-line loops are not supported:</p>

<pre><code class="java">// Monkey C does allow for variable declaration in for loops
for( var i = 0; i &lt; array.size(); i++ ) {
    // Code to do in a loop
}
</code></pre>

<p>Control within loops can be managed by using the <code>break</code> and <code>continue</code> statements. These should also have familiar behavior:</p>

<pre><code class="java">// This for loop should only print 5, 6, and 7.
for (var i = 0; i &lt; 10; i += 1) {
    if (i &lt; 5) {
        continue;
    }
    System.println(i);
    if (7 == i) {
        break;
    }
}
</code></pre>

<h3 id="returningvaluesfromfunctions">Returning Values From Functions</h3>

<p>All functions return values in Monkey C. You can explicitly set the return value by using the <code>return</code> keyword:</p>

<pre><code class="java">return expression;
</code></pre>

<p>The expression is optional. Functions without a return statement automatically return the last value operated on.</p>

<h3 id="instanceofandhas">Instanceof and Has</h3>

<p>As a duck-typed language, Monkey C gives the programmer great flexibility, but the trade off is that the compiler cannot perform the type checking like in C, C++ or Java. Monkey C provides two tools to do runtime type checking&mdash;<code>instanceof</code> and <code>has</code>.</p>

<p>The <code>instanceof</code> operator offers the ability to check if an object instance inherits from a given class. The second argument is the class name to check against:</p>

<pre><code class="java">var value = 5;
// Check to see if value is a number
if ( value instanceof Toybox.Lang.Number )
{
    System.println( &quot;Value is a number&quot; );
}
</code></pre>

<p>The <code>has</code> operator lets you check if a given object has a symbol, which may be a public method, instance variable, or even a class definition or module. The second argument is the symbol to check for. For example, assume we have magnetometer libraries in <code>Toybox.Sensor.Magnetometer</code>, but not all products have a magnetometer. Here is an example of changing your implementation based on those criteria:</p>

<pre><code class="java">var impl;
// Check to see if the Magnetometer module exists in Toybox
if ( Toybox has :Magnetometer )
{
    impl = new ImplementationWithMagnetometer();
}
else
{
    impl = new ImplementationWithoutMagnetometer();
}
</code></pre>

<p>Monkey C&#8217;s object-oriented design patterns in conjunction with the <code>has</code> and <code>instanceof</code> operator enables software that has implementations for many devices in one code base.</p>

<h2 id="errors">Errors</h2>

<p>Because Monkey C uses dynamic typing, there are many errors for which the compiler cannot check. If the error is of high enough severity, it will raise an fatal API error and cause your app to terminate at runtime. These errors cannot be caught. At this time all of these errors are fatal and there is no way to trap them, though this may be addressed in future updates.</p>

<dl>
<dt>Array Out Of Bounds</dt>
<dd>An attempt is being made to reference an array outside of its allocated bounds</dd>

<dt>Circular Dependency</dt>
<dd>There is a loop in the dependency graph of a module or object that prevents a module or object from being constructed</dd>

<dt>Communications Error</dt>
<dd>An error has occurred in <a href="https://en.wikipedia.org/wiki/Bluetooth_low_energy" title="Bluetooth low energy">BLE</a> communications</dd>

<dt>File Not Found</dt>
<dd>The app file could not be found, which is usually caused when trying to load a resource from the app file</dd>

<dt>Illegal Frame</dt>
<dd>The return address on the stack is corrupted</dd>

<dt>Initializer Error</dt>
<dd>An error occured in an initializer</dd>

<dt>Invalid Value</dt>
<dd>An argument passed to a function or method is invalid</dd>

<dt>Null Reference</dt>
<dd>A value is being requested from a null value</dd>

<dt>Out of Memory</dt>
<dd>Indicates no more system memory is available for allocation</dd>

<dt>Permission Required</dt>
<dd>An attempt was made to use a restricted API without permission</dd>

<dt>Stack Underflow</dt>
<dd>The stack pointer went past the bottom of the stack memory limit</dd>

<dt>Stack Overflow</dt>
<dd>The stack pointer went past the top of the stack memory limit</dd>

<dt>Symbol Not Found</dt>
<dd>An attempt was made to access a variable or method that does not exist in the specified object or method</dd>

<dt>System Error</dt>
<dd>A generic error used by the Toybox APIs for fatal errors</dd>

<dt>Too Many Arguments</dt>
<dd>Too many arguments used by a method, which are currently limited to 10 arguments</dd>

<dt>Too Many Timers</dt>
<dd>Too many <code>Timer::Timer</code> objects for the target device were started</dd>

<dt>Unexpected Type</dt>
<dd>Indicates an operation being done on a variable that is unsupported by the type; for example, trying to perform a bitwise OR on two string</dd>

<dt>Unhandled Exception</dt>
<dd>An <code>Exception</code> was thrown but was not caught by an exception handler</dd>

<dt>Watchdog Tripped</dt>
<dd>A Monkey C function has executed for too long; watchdogs prevent a Monkey C program from hanging the system via an infinite loop</dd>
</dl>

<h3 id="structuredexceptionhandling">Structured Exception Handling</h3>

<p>Monkey C supports structured exception handling for non-fatal errors from which there can be recovery. The syntax should be familiar for Java and Javascript developers:</p>

<pre><code class="java">try {
    // Code to execute
}
catch( ex instanceof AnExceptionClass ) {
    // Code to handle the throw of AnExceptionClass
}
catch( ex ) {
    // Code to catch all execeptions
}
finally {
    // Code to execute when
}
</code></pre>

<p>You can use the <code>throw</code> keyword to throw an exception.</p>

<h2 id="objects">Objects</h2>

<p>Objects are created with the <code>class</code> keyword. Classes allow data and operations to be bound together on an object.</p>

<h3 id="constructors">Constructors</h3>

<p>When an object is instantiated with the <code>new</code> keyword, the memory is allocated and the <code>initialize</code> method is called:</p>

<pre><code class="java">class Circle
{
    hidden var mRadius;
    function initialize( aRadius ) {
      mRadius = aRadius;
    }
}

function createCircle() {
    var c = new Circle( 1.5 );
}
</code></pre>

<p>Within a method implementation you can refer to your current instance using either the <code>self</code> or <code>me</code> keywords.</p>

<pre><code class="java">class A
{
    var x;
    var y;
    function initialize() {
        me.x = &quot;Hello&quot;; // Set current instance x variable
        self.y = &quot;Hello&quot;; // Set current instance y variable
    }
}
</code></pre>

<h3 id="inheritance">Inheritance</h3>

<p>Monkey C uses the <code>extends</code> keyword to support class inheritance:</p>

<pre><code class="java">using Toybox.System as Sys;

class A
{
    function print() {
        Sys.print( &quot;Hello!&quot; );
    }
}

class B extends A
{

}

function usageSample() {
    var inst = new B();
    inst.print();           // Prints &quot;Hello!&quot;
}
</code></pre>

<p>You can call superclass methods by using the super class’s symbol:</p>

<pre><code class="java">using Toybox.System;

class A
{
    function print() {
        System.print( &quot;Hello!&quot; );
    }
}

class B extends A
{
    function print() {
        // Call the super class implementation
        A.print();

        // Amend the output
        System.println( &quot;Hola!&quot; );
    }
}

function usageSample() {
    var inst = new B();
    inst.print();           // Prints &quot;Hello! Hola!&quot;
}
</code></pre>

<h3 id="datahiding">Data Hiding</h3>

<p>Classes have two levels of access&mdash;public and hidden. Public is the default. Hidden is the same as &#8220;protected&#8221;; it says that a variable or function is only accessible to a class or its subclasses:</p>

<pre><code class="java">class Foo
{
    hidden var mVar;
}
function usageSample() {
    var v = new Foo();
    Toybox.System.println( v.mVar ); // Runtime Error
}
</code></pre>

<h3 id="callbacks">Callbacks</h3>

<p>Functions in Monkey C are not first class, meaning you cannot pass them as objects directly. On a class instance, you can get a Method object. This object allows you to store a method in a variable for later invocation.</p>

<pre><code class="java">class Foo
{
    function operation(a, b) {
        // The code here is really amazing. Like mind blowing amazing. You wish this method was in your program.
    }
}
function usageSample() {
    var v = new Foo();
    // Get the callback for the operation method.
    var m = v.method(:operation);
    // Invoke v's operation method.
    m.invoke(1,2);
}
</code></pre>

<p>A Method object will invoke a method on the instance of an object it came from. It keeps a strong reference to the source object.</p>

<p>Using hashtables and method objects, you can implement a [switch/case pattern][^SwitchCase].</p>

<pre><code class="java">class Foo
{
    // Switch based on 'input'
    function doSomethingNext(input) {
        var choices = {
            1=&gt;:operation1,
            2=&gt;:operation2,
            3=&gt;:operation3
        };
        var choice = choice[input];
        if( choice != null ) {
            self.method(choices[input]).invoke();
        } else {
            operationDefault();
        }
    }
    // What to do on input 1
    function operation1() {
    }
    // What to do on input 2
    function operation2() {
    }
    // What to do on input 3
    function operation3() {
    }
    // On all other input
    function operationDefault() {
    }
}
</code></pre>

<p>Modules do not inherit from Object, and do not have access to the method object.</p>

<h3 id="weakreferencesciq1.2">Weak References (CIQ 1.2)</h3>

<p>Monkey C is reference counted, which means the runtime system will free memory when the number of objects referencing that memory decrements to zero. Reference counting allows memory to become available very quickly which is important in low memory environments. The kryptonite of reference counting are <em>circular references</em>. A circular reference happens when a cycle is formed in the reference chain. For example, imagine object C references object A, object A references object B, <em>and</em> object B references object A.</p>
<figure>
<img src="resources/programmers-guide/weak-reference-1.png" style="max-width:153px;" />
</figure>

<p>Now C gets invited to sit at the cool-kid table, so it dereferences A so it can hang out with its <em>real</em> friends.<a href="#fn:3" id="fnref:3" title="see footnote" class="footnote">[3]</a></p>
<figure>
<img src="resources/programmers-guide/weak-reference-2.png" style="max-width:153px;" />
</figure>

<p>This forms a roundabout to nowhere. The memory for A and B should be freed at this point, but A and B both have a reference count of one because they reference each other. The memory used by A and B are now unavailable to objects from the cool-kids table.</p>

<p>Sometimes B really does need to reference A. In these cases, you can use a <em>weak reference</em>. A weak reference is an object that keeps a reference to an object but does not increment the reference count. This means the object reference can be destroyed, and is a case that should be handled.</p>
<figure>
<img src="resources/programmers-guide/weak-reference-3.png" style="max-width:153px;" />
</figure>

<p>To create a weak reference you use the <code>weak()</code> method. Weak is a method in <code>Lang.Object</code> and is available to all Monkey C objects.</p>

<pre><code class="java">// I would make a &quot;Hans and Franz&quot; reference but I
// think certain advertising has made them uncool.
var weakRef = obj.weak()
</code></pre>

<p>If you are calling <code>weak</code> on one of the immutable types (<code>Number</code>, <code>Float</code>, <code>Char</code>, <code>Long</code>, <code>Double</code>, <code>String</code>), then it returns the object itself. Otherwise it will return a WeakReference instance.</p>

<pre><code class="java">//! A weak reference is a loosely bound reference to
//! another object. If all strong references have been
//! freed, the get() method will return null.
//! This allows the developer to avoid circular references.
//! @since 1.2.0
class WeakReference
{
    //! Return if the reference is still alive.
    //! @return true if object is still alive, false otherwise.
    //!    When you are dead I will be STILL ALIVE
    //!    I feel fantastic and I am STILL ALIVE
    function stillAlive();

    //! Get the object referenced.
    //! @return Object referenced, or null if object is no
    //!         longer alive.
    function get();
}
</code></pre>

<p>You can use the <code>stillAlive</code> method to check if the reference has been cleaned up. Use <code>get</code> to create a strong reference to the object. Only keep the strong reference during the scope you need it!</p>

<pre><code class="java">// This is a triumph...
if( weakRef.stillAlive() ) {
    var strongRef = weakRef.get();
    strongRef.doTheThing();
}
</code></pre>

<h2 id="modules">Modules</h2>

<p>Modules in Monkey C allow for the scoping of classes and functions. Unlike Java packages, Monkey C modules have many of the same properties as classes. You can have variables, functions, and classes at the module level:</p>

<pre><code class="java">module MyModule
{
    class Foo
    {
        var mValue;
    }
    var moduleVariable;
}

function usageSample() {
    MyModule.moduleVariable = new MyModule.Foo();
}
</code></pre>

<h3 id="usingstatements">Using Statements</h3>

<p>You can bring a module into your scoping level with the <code>using</code> keyword. <code>using</code> allows a module to be imported into another class or module by a symbol:</p>

<pre><code class="java">using Toybox.System;

function foo() {
    System.print( &quot;Hello&quot; );
}
</code></pre>

<p>The <code>as</code> clause provides a wat to assumed a module with a different name within scope. This is useful for shortening module names or when you simply disagree with our naming scheme<a href="#fn:4" id="fnref:4" title="see footnote" class="footnote">[4]</a>:</p>

<pre><code class="java">using Toybox.System as Sys;

function foo() {
    Sys.print( &quot;Hello&quot; );
}
</code></pre>

<p><code>using</code> statements are scoped to the class or module in which they are defined.</p>

<h2 id="apisandapptypes">APIs and App Types</h2>

<p>The app type defines the user context of an app. Watch faces, for example, have many constraints because they operate in low power mode. To enforce these limits, the Connect IQ Virtual Machine will limit your available APIs based on your app type.</p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:center;"/>
<col style="text-align:center;"/>
<col style="text-align:center;"/>
<col style="text-align:center;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Module Name</th>
	<th style="text-align:center;">Data Field</th>
	<th style="text-align:center;">Watch Face</th>
	<th style="text-align:center;">Widget</th>
	<th style="text-align:center;">App</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">Activity</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">ActivityMonitor*</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">Ant*</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">Application</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">Attention</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">ActivityRecording*</td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">Communications*</td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">FitContributor*</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">Graphics</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">Lang</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">Math</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">PersistedLocations*</td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">Positioning*</td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">Sensor*</td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">Sensor History*</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">System</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">Time</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">Timer</td>
	<td style="text-align:center;"></td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">UserProfile*</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
<tr>
	<td style="text-align:left;">WatchUi</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
	<td style="text-align:center;">&#x02713;</td>
</tr>
</tbody>
</table>
<p class="disclaimer">
*Requires app permission<br />
Ant available in data fields and widgets since Connect IQ version 1.2.0
</p>

<p>A Toybox module requested for your app type that is outside this list will result in a <em>Symbol Not Found</em> error.</p>

<h2 id="scoping">Scoping</h2>

<p>Monkey C is a message-passed language. When a function is called, the virtual machine does a look up operation at runtime to find the function being called. Here is the hierarchy that it will search:</p>

<ol>
<li>Instance members of the class</li>
<li>Members of the superclass</li>
<li>Static members of the class</li>
<li>Members of the parent module, and the parent modules up to the global namespace</li>
<li>Members of the superclass’s parent module up to the global namespace</li>
</ol>

<p>For exmaple, if function <code>a()</code> is called on an instance of <code>Child()</code>, it will be able to access non-member functions <code>b()</code>, <code>c()</code>, and <code>d()</code> when:</p>

<ul>
<li><code>b()</code> is a member of the parent module of the object</li>
<li><code>c()</code> is a static member of the object</li>
<li><code>d()</code> is the parent module of the parent module, also known as the globals module</li>
</ul>

<p>The code below tries to clarify:</p>

<pre><code class="java">using Toybox.System as Sys;

// A globally visible function
function d() {
    Sys.print( &quot;this is D!&quot; );
}

module Parent
{
    // A module function.
    function b() {
        Sys.print( &quot;This is B!&quot; );
        d(); // Call a globally visible function
    }

    // A child class of a Parent module
    class Child
    {
        // An instance method of Child
        function a() {
            Sys.print( &quot;This is A!&quot; );
            b(); // Call a function in our parent module
            c(); // Call a static function within the class.
            d(); // Call a globally visible function.
        }

        // A static function of Child.
        // Note that static methods can't call instance method but still have
        // access to parent modules.
        static function c() {
            Sys.print( &quot;This is C!&quot; );
            b(); // Call a method in the parent module.
            d(); // Call a globally visible function
        }
    }
}
</code></pre>

<p>Sometimes you want to run your search from the global namespace instead of your current scope. You can do this using the bling symbol <code>$</code>. The bling symbol refers to global scope:</p>

<pre><code class="java">function helloFunction() {
    System.println(&quot;Hello Hello&quot;);
}

class A {
     function helloFunction() {
        System.println(&quot;Every time I say goodbye you say hello&quot;);
     }

    function b() {
        // Call global helloFunction
        $.helloFunction();
        // Call instance helloFunction
        helloFunction();
    }
}
</code></pre>

<p>If you are referring to a global variable, using bling can improve runtime performance<a href="#fn:5" id="fnref:5" title="see footnote" class="footnote">[5]</a>:</p>

<pre><code class="java">var globalScopedVariable = &quot;Global String&quot;;

module A
{
    class B
    {
        function c() {
            // To find globalScopedVariable, the VM will search at runtime:
            //     instance B
            //     instance B's superclass Toybox.Lang.Object
            //     Module A
            //     Module A's parent globals
            // and finally find globalScopedVariable.
            System.println(globalScopedVariable);
            // This will search only the global namespace for globalScopedVariable.
            // Thanks bling!
            System.println($.globalScopedVariable);
        }
    }
}
</code></pre>

<p>Because Monkey C is dynamically typed, referencing a global variable will search your Object&#8217;s inheritance structure and the module hierarchy before it will eventually find the global variable. Using the bling symbol we can search globals directly.</p>

<h3 id="annotations">Annotations</h3>

<p>Monkey C allows associating symbols with class or module methods and variables. These symbols are currently written into the <code>debug.xml</code> file generated by the compiler, but may be used in the future to add new features without changing the Monkey C grammar:</p>

<pre><code class="java">(:debugOnly) class TestMethods
{
    (:test) static function testThisClass( x )
}
</code></pre>

<h1 id="resourcecompiler">Resource Compiler</h1>
<figure>
<img src="resources/programmers-guide/sculptor-monkey.png" style="max-width:300px;" title="It is my finest work." />
</figure>

<p>The resource compiler compiles images, text, and static data into a resource database that the application can access at run time. The resource compiler is tied into the Monkey C compiler. Its input is an XML file:</p>

<pre><code class="xml">&lt;resources&gt;
    &lt;bitmap id=&quot;bitmap_id&quot; filename=&quot;path/for/image&quot; /&gt;
    &lt;font id=&quot;font_id&quot; filename=&quot;path/to/fnt&quot; /&gt;
    &lt;string id=&quot;string_id&quot;&gt;Hello World!&lt;/string&gt;
&lt;/resources&gt;
</code></pre>

<p><em>Note:</em> In order for the Eclipse plug-in to recognize a resource file its path must include a folder with the word resource in it.</p>

<h2 id="theresourcemodulea.k.a.rez">The Resource Module (a.k.a. Rez)</h2>

<p>The resource compiler auto-generates a Monkey C module named <code>Rez</code> that contains the resource IDs for the resource file. These identifiers are used to refer to your resources:</p>

<pre><code class="java">module Rez
{
    module Drawables
    {
        var bitmap_id = 123;
    }
    module Strings
    {
       var hello_id = 456;
    }
    module Fonts
    {
       var font_id = 789;
    }
}
</code></pre>

<p>The code can use the <code>Rez</code> class to reference the resources at run time. For example, let&#8217;s say you have a bitmap you want to use in your view. Before it can be used by the app, it must be loaded from the resource file:</p>

<pre><code class="java">image = Ui.loadResource( Rez.Drawables.id_monkey );
</code></pre>

<p>Now the bitmap can be drawn in the update handler:</p>

<pre><code class="java">dc.drawBitmap( 50, 50, image );
</code></pre>

<p>Resources are reference counted just like other Monkey C objects. Loading a resource can be an expensive operation, so do not load resources when handling screen updates.</p>

<h3 id="referencingresourceswithinresourcefiles">Referencing Resources Within Resource Files</h3>

<p>Resources can also be referenced from within another resource file. To do this use the syntax <code>@&lt;module&gt;.&lt;id&gt;</code>. For example, you could reference a String resource within a menu definition using the following code.</p>

<pre><code class="xml">&lt;string id=&quot;menu_item_1_label&quot;&gt;Item 1&lt;/string&gt;

&lt;menu id=&quot;MainMenu&quot;&gt;
    &lt;menu-item id=&quot;item_1&quot;&gt;@Strings.menu_item_1_label&lt;/menu-item&gt;
&lt;/menu&gt;
</code></pre>

<p>This code would use the string defined with an ID of <code>menu_item_1_label</code> as the label for the menu item.</p>

<h2 id="bitmaps">Bitmaps</h2>

<p>Garmin devices have different form factors, screen sizes, and screen technologies, so bitmaps need to be explicitly converted for every device. The resource compiler will generate resources for every intended product, which allows the developer to have one set of resources for black and white products, one set for color products, one for larger screen sizes, etc. The resource compiler supports <code>JPG/JPEG</code>, <code>BMP/WBMP</code>, <code>GIF</code> and <code>PNG</code> file formats.</p>

<p>While each device has a unique palette, the developer can specify a palette to use for an image. The resource compiler will map the colors that are defined in the developer&#8217;s palette to the closest match in the device palette and use only those colors. A palette can be defined using the following syntax:</p>

<pre><code class="xml">&lt;resources&gt;
    &lt;bitmap id=&quot;bitmap_id&quot; filename=&quot;path/for/image&quot;&gt;
        &lt;palette disableTransparency=&quot;false&quot;&gt;
            &lt;color&gt;FF0000&lt;/color&gt;
            &lt;color&gt;FFFFFF&lt;/color&gt;
            &lt;color&gt;0000FF&lt;/color&gt;
        &lt;/palette&gt;
    &lt;/bitmap&gt;
&lt;/resources&gt;
</code></pre>

<p>The table below shows all of the valid attributes for a <code>&lt;bitmap&gt;</code> definition.</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The handle for the layout, which is used to reference the layout in the Rez module</td>
	<td style="text-align:left;">Any value that starts with a letter</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>filename</code></td>
	<td style="text-align:left;">The relative path to the image file</td>
	<td style="text-align:left;">A valid, resolvable path to an image file</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>dithering</code></td>
	<td style="text-align:left;">The type of dithering to use when compiling the image</td>
	<td style="text-align:left;"><code>floyd_steinberg</code> or <code>none</code></td>
	<td style="text-align:left;"><code>floyd_steinberg</code></td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<p>The valid attributes for a <code>&lt;palette&gt;</code> definition are in the table below.</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>disableTransparency</code></td>
	<td style="text-align:left;">Should the compiler allow transparent pixels in the image? Disabling transparency may save memory</td>
	<td style="text-align:left;"><code>true</code> or <code>false</code></td>
	<td style="text-align:left;"><code>false</code></td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<h2 id="fonts">Fonts</h2>

<p>The resource compiler reads fonts in <code>TXT</code> or <code>PNG</code> format. You can use the BMFont tool (available at <a href="http://www.angelcode.com/products/bmfont/">http://www.angelcode.com/products/bmfont/</a>) to convert a font from many different formats to a compatible format. Prior to export, ensure that BMFont&#8217;s <em>Font Settings</em> specify the Unicode charset. Recommended export options are shown in the image below:</p>
<div class="center">
<figure>
<img src="resources/programmers-guide/bmfont_options.png" style="max-width:298px;" alt="The BMFont Export Options" title="The BMFont export options window" />
<figcaption>The BMFont Export Options</figcaption>
</figure>
</div>

<p>The color can be set using <code>dc.setColor()</code>. Since bitmap fonts can take a lot of runtime memory, the font converter defaults to non-antialiased 1-bit fonts to save memory. If you know you will have the runtime RAM available, you can turn on font antialiasing with the <code>antialias</code> option.</p>

<pre><code class="xml">&lt;!-- Domo arigato mister font --&gt;
&lt;font id=&quot;font_id&quot; filename=&quot;roboto.fnt&quot; antialias=&quot;true&quot; /&gt;
</code></pre>

<p>If you are creating a large font, sometimes, only particular glyphs need to be large-sized (like numbers for a watch face). Use the filter attribute to specify the particular glyphs to include:</p>

<pre><code class="xml">&lt;!-- Only include digits from this large font --&gt;
&lt;font id=&quot;font_id&quot; filename=&quot;big_font.fnt&quot; filter=&quot;0123456789:&quot;/&gt;
</code></pre>

<h2 id="appsettings">App Settings</h2>

<p>The app settings framework enables app developers to present options to end users for their apps within Garmin Connect Mobile and Garmin Express. This will allow app customization and setup, especially for watch faces and data field which have no way to receive user input.</p>

<h3 id="defininganappsetting">Defining an App Setting</h3>

<p>An app setting is composed of a property and an associated setting. The property is used to store the underlying value. The setting is used to describe how the property should displayed to the end user. You can define a property as a default value and not define an associated setting but you cannot define a setting without tying it to a property.</p>

<h4 id="properties">Properties</h4>

<p>Properties are considered a resource and are defined within a resource file. This means you can <a href="#overridingresources">override</a> them like any other resource file. To define a property use the <code>&lt;property&gt;</code> tag.</p>

<pre><code class="xml">&lt;properties&gt;
    &lt;property id=&quot;appVersion&quot; type=&quot;string&quot;&gt;1.0.3&lt;/property&gt;
    &lt;property id=&quot;myString&quot; type=&quot;number&quot;&gt;0&lt;/property&gt;
    &lt;property id=&quot;myNumber&quot; type=&quot;number&quot;&gt;500&lt;/property&gt;
    &lt;property id=&quot;screenSleep&quot; type=&quot;boolean&quot;&gt;true&lt;/property&gt;
    &lt;property id=&quot;username&quot; type=&quot;string&quot;&gt;&lt;/property&gt;
&lt;/properties&gt;
</code></pre>

<p>The property tag supports two attributes: <code>id</code> and <code>type</code>. Both of these attributes are required.</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The ID of the preference to set.</td>
	<td style="text-align:left;">Any string starting with a letter.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>type</code></td>
	<td style="text-align:left;">The type of the value being set. A string value is the literal string value and not an ID or reference to a string resource.</td>
	<td style="text-align:left;"><code>string</code>, <code>number</code>, <code>float</code> or <code>boolean</code></td>
</tr>
</tbody>
</table>

<h4 id="settings">Settings</h4>

<p>Settings are also defined as a resource. Use the <code>&lt;setting&gt;</code> tag to define a setting.</p>

<pre><code class="xml">&lt;settings&gt;

    &lt;setting propertyKey=&quot;@Properties.appVersion&quot; title=&quot;@Strings.AppVersionTitle&quot;&gt;
        &lt;settingConfig type=&quot;alphaNumeric&quot; readonly=&quot;true&quot; /&gt;
    &lt;/setting&gt;

    &lt;setting propertyKey=&quot;@Properties.myString&quot; title=&quot;@Strings.MyStringTitle&quot; prompt=&quot;@Strings.MyStringPrompt&quot;&gt;
        &lt;settingConfig type=&quot;list&quot;&gt;
            &lt;listEntry value=&quot;0&quot;&gt;@Strings.HelloWorld&lt;/listEntry&gt;
            &lt;listEntry value=&quot;1&quot;&gt;@Strings.Ackbar&lt;/listEntry&gt;
            &lt;listEntry value=&quot;2&quot;&gt;@Strings.Garmin&lt;/listEntry&gt;
        &lt;/settingConfig&gt;
    &lt;/setting&gt;

    &lt;setting propertyKey=&quot;@Properties.myNumber&quot; title=&quot;@Strings.MyNumberTitle&quot; prompt=&quot;@Strings.MyNumberPrompt&quot;&gt;
        &lt;settingConfig type=&quot;numeric&quot; errorMessage=&quot;@Strings.MyNumberError&quot; /&gt;
    &lt;/setting&gt;

    &lt;setting propertyKey=&quot;@Properties.screenSleep&quot; title=&quot;@Strings.ScreenSleepTitle&quot;&gt;
        &lt;settingConfig type=&quot;boolean&quot; /&gt;
    &lt;/setting&gt;

    &lt;setting propertyKey=&quot;@Properties.username&quot; title=&quot;@Strings.UsernameTitle&quot;&gt;
        &lt;settingConfig type=&quot;alphaNumeric&quot; required=&quot;true&quot; /&gt;
    &lt;/setting&gt;

&lt;/settings&gt;
</code></pre>

<p>The table below shows all of the valid attributes for a setting.</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>propertyKey</code></td>
	<td style="text-align:left;">The key of the property that this setting will manage. An error will be thrown at compile time if the property key can&#8217;t be found.</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>title</code></td>
	<td style="text-align:left;">The title to display in Garmin Connect Mobile/Garmin Express when displaying the list of settings/value of the setting. This must reference a string resource ID.</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>prompt</code></td>
	<td style="text-align:left;">The message to display when prompting the user to set the value. This must reference a string resource ID.</td>
	<td style="text-align:left;">Optional. Some settings will not display a prompt even if it&#8217;s provided (for example, <code>readonly</code> or <code>boolean</code> settings displayed as an on/off switch).</td>
</tr>
<tr>
	<td style="text-align:center;"><code>helpUrl</code></td>
	<td style="text-align:left;">A URL to a webpage which will provide help for the user.</td>
	<td style="text-align:left;">Optional</td>
</tr>
</tbody>
</table>

<p>A <code>&lt;settingConfig&gt;</code>, a child element of a <code>&lt;setting&gt;</code>, provides additional details about the setting. The valid attributes are given in the table below.</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Value</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>type</code></td>
	<td style="text-align:left;">The display type of the setting.</td>
	<td style="text-align:left;"><code>list</code>, <code>boolean</code>, <code>numeric</code>, <code>alphaNumeric</code>, <code>phone</code>, <code>email</code>, <code>url</code>, <code>date</code> or <code>password</code></td>
	<td style="text-align:left;">A value of <code>list</code> will require child <code>&lt;listEntry&gt;</code> elements to define the options which should be available within the list.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>readonly</code></td>
	<td style="text-align:left;">If the setting is read only or not. This attribute is valid for all types except <code>list</code> and <code>password</code>.</td>
	<td style="text-align:left;"><code>true</code> or <code>false</code></td>
	<td style="text-align:left;">Optional. Defaults to <code>false</code>.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>required</code></td>
	<td style="text-align:left;">If the field is required.</td>
	<td style="text-align:left;"><code>true</code> or <code>false</code></td>
	<td style="text-align:left;">Optional. Defaults to <code>false</code>.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>min</code></td>
	<td style="text-align:left;">The minimum value to allow.</td>
	<td style="text-align:left;">An integer value</td>
	<td style="text-align:left;">Optional. Only valid for a <code>type</code> value of <code>numeric</code> or <code>date</code>.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>max</code></td>
	<td style="text-align:left;">The maximum value to allow.</td>
	<td style="text-align:left;">An integer value</td>
	<td style="text-align:left;">Optional. Only valid for a <code>type</code> value of <code>numeric</code> or <code>date</code>.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>maxLength</code></td>
	<td style="text-align:left;">The maximum allowed value length.</td>
	<td style="text-align:left;">An integer value</td>
	<td style="text-align:left;">Optional. Only valid for settings whose associated property&#8217;s type is <code>string</code>.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>errorMessage</code></td>
	<td style="text-align:left;">An error message to display if the value a user enters isn&#8217;t valid based on the <code>type</code>, <code>min</code>, <code>max</code> and <code>maxLength</code> values.</td>
	<td style="text-align:left;">A reference to a string resource.</td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<p><code>&lt;settingConfig&gt;</code> types are only valid for certain property types:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Property Type</th>
	<th style="text-align:left;">Valid settingsConfig Types</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>string</code></td>
	<td style="text-align:left;"><code>alphaNumeric</code>, <code>phone</code>, <code>email</code>, <code>url</code>, <code>password</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>number</code></td>
	<td style="text-align:left;"><code>list</code>, <code>numeric</code>, <code>date</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>float</code></td>
	<td style="text-align:left;"><code>numeric</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>boolean</code></td>
	<td style="text-align:left;"><code>boolean</code></td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<p>The <code>&lt;listEntry&gt;</code> element is defined in the table below. Its value must be a reference to a string resource.</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>value</code></td>
	<td style="text-align:left;">The value to save if this item is selected by the user.</td>
	<td style="text-align:left;">The type of the value should match the property it&#8217;s being saved to. If it doesn&#8217;t match a compile time error is thrown.</td>
</tr>
</tbody>
</table>

<h3 id="accessingappsettingvalues">Accessing App Setting Values</h3>

<p>App properties are accessed the same way Object Store values are accessed. To get or set a property value use the <code>AppBase.getProperty(key)</code> or <code>AppBase.setProperty(key)</code> functions respectively.</p>

<pre><code class="java">// Get an app setting value
var mySetting = Application.getApp().getProperty(&quot;mySetting&quot;);

// Set an app setting from code
Application.getApp().setProperty(&quot;mySetting&quot;, mySetting);
</code></pre>

<h3 id="changingsettingswithingarminconnectmobilegarminexpress">Changing Settings Within Garmin Connect Mobile/Garmin Express</h3>

<p>End users will be able to view the settings you define within the Garmin Connect Mobile or Garmin Express UI. When app settings are changed while an app is running the <code>AppBase.onSettingsChanged()</code> function is called. Apps can override this function and update accordingly. When dealing with date type settings that are set by Garmin Express or Connect Mobile, one should note that times are stored in UTC and that <code>Gregorian.utcInfo()</code> should be used in place of <code>Gregorian.info()</code> when working with such values to prevent unneeded local time conversion.</p>

<h4 id="testingappsettings">Testing App Settings</h4>

<p>An app settings editor tool is available within the Eclipse plug-in. This tool will allow you to view the defined settings for a project in Eclipse, select values for each setting and send them to the simulator for testing.</p>
<figure>
<img src="resources/programmers-guide/app_settings_editor.png" style="max-width:400px;" title="The App Settings Editor" />
</figure>

<h2 id="overridingresources">Overriding Resources</h2>

<p>Resources can be overridden using qualifiers. A resource with the same ID but a more specific qualifier will replace the resource with less specific qualifiers when the app is compiled. Resource qualifiers are applied to the base resources folder and all resources found within that folder will inherit the qualifiers of the base folder. Qualifiers are added to a resources folder by adding a hyphen (<code>-</code>) followed by a valid qualifier value. Multiple qualifiers may be used on a single folder but they must be separated by hyphens and given in the order they are found in the tables below. All qualifiers are case insensitive.</p>

<h3 id="device-basedqualifiers">Device-based Qualifiers</h3>

<p>The device-based qualifier format allows for resources to target specific devices and locales. Any resource folder name that carries a device qualifier always takes precedent over any less specific form of qualifier, such a family qualifier. Additionally, device qualifiers are <em>not allowed</em> to co-exist with family qualfiers in the same folder name (resources-round-fenix3 for example), and will be skipped by the resource compiler if they are encountered.</p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Qualifier Type</th>
	<th style="text-align:left;">Qualifier Values Examples</th>
	<th style="text-align:left;">Description</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">Device</td>
	<td style="text-align:left;"><code>square_watch</code> or <code>fr920xt</code></td>
	<td style="text-align:left;">A device code. Resources included in a folder with a device qualifier will override the resources with the same ID that are defined in the base resource folder when building for that specific device.</td>
</tr>
<tr>
	<td style="text-align:left;">Language and Region</td>
	<td style="text-align:left;"><code>fre</code>, <code>fre_FRA</code>, and <code>fre_CAN</code></td>
	<td style="text-align:left;">ISO 639&#8211;2 language code followed by an optional <a href="http://www.iso.org/iso/home/standards/country_codes.htm">ISO 3166&#8211;1</a> <a href="https://www.iso.org/obp/ui/#search/code/">3-letter country code</a>. To include a region code, append it after the language code with an underscore (<code>_</code>) separating the two. A region cannot be specified alone. These qualifiers are <em>only</em> applied to string resources.</td>
</tr>
</tbody>
</table>

<h3 id="family-basedqualfiers">Family-based Qualfiers</h3>

<p>Connect IQ supports what are referred to as &#8220;device families&#8221; for the purpose of resource overrides. A device family is a grouping of devices based on the screen characteristics of shape and size. The following table describes the family qualifier format. Note that you <em>cannot</em> define an actual device qualifier such as <code>fr620</code> in addition to family qualifiers. Additionally, any resource folders containing device qualifiers will always take priority over folders containing family qualifiers.</p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Qualifier Type</th>
	<th style="text-align:left;">Qualifier Values Examples</th>
	<th style="text-align:left;">Description</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">Screen Shape</td>
	<td style="text-align:left;"><code>round</code>, <code>semiround</code>, <code>rectangle</code>, etc..</td>
	<td style="text-align:left;">The shape of the screen. Examples of round screens include the Fenix3 and D2 Bravo.</td>
</tr>
<tr>
	<td style="text-align:left;">Screen Size</td>
	<td style="text-align:left;"><code>218x218</code>, <code>148x205</code>, etc..</td>
	<td style="text-align:left;">The physical size of the screen in pixels</td>
</tr>
<tr>
	<td style="text-align:left;">Language and Region</td>
	<td style="text-align:left;"><code>fre</code>, <code>fre_FRA</code>, and <code>fre_CAN</code></td>
	<td style="text-align:left;">ISO 639&#8211;2 language code followed by an optional <a href="http://www.iso.org/iso/home/standards/country_codes.htm">ISO 3166&#8211;1</a> <a href="https://www.iso.org/obp/ui/#search/code/">3-letter country code</a>. To include a region code, append it after the language code with an underscore (<code>_</code>) separating the two. A region cannot be specified alone. These qualifiers are <em>only</em> applied to string resources.</td>
</tr>
</tbody>
</table>

<h2 id="buildfileexclusions">Build File Exclusions</h2>

<p>The resource compiler supports excluding files, directories or annotations as part of the build process using the <code>&lt;build&gt;</code> tag:</p>

<pre><code class="xml">&lt;build&gt;
  &lt;exclude file=&quot;filename.mc&quot;/&gt;
  &lt;exclude dir=&quot;source-excluded&quot; /&gt;
  &lt;exclude annotation=&quot;roundImpl&quot;/&gt;
&lt;/build&gt;
</code></pre>

<p>The <code>&lt;build&gt;</code> tag can be defined in the resource directory of any device or family based qualifier. Only the single most detailed and relevant <code>&lt;build&gt;</code> resource defined will be used when compiling an application. This feature is extremely useful when needing to add specific files or features for one device / family and not another, saving memory that would otherwise be wasted for non-shareable code.</p>

<h1 id="entrypointsandthemanifestfile">Entry Points And The Manifest File</h1>
<figure>
<img src="resources/programmers-guide/wizard-monkey.png" style="max-width:300px;" title="Sometimes fixing bugs requires a little magic." />
</figure>

<p>All Connect IQ apps require a manifest file. The manifest file is an XML file that specifies application properties like the application type and the supported products. The manifest file is created automatically by the Eclipse plug-in, but it can be created hand as well:</p>

<pre><code class="xml">&lt;iq:manifest version=&quot;1&quot;&gt;
    &lt;iq:application entry=&quot;CommExample&quot; id=&quot;a3421feed289106a538cb9547ab12095&quot;
        name=&quot;AppName&quot; launcherIcon=&quot;LauncherIcon&quot; type=&quot;widget&quot; minSdkVersion=&quot;1.3.1&quot;&gt;

        &lt;iq:products&gt;
            &lt;iq:product id=&quot;square_watch&quot;/&gt;
        &lt;/iq:products&gt;

        &lt;iq:permissions&gt;
            &lt;iq:uses-permission id=&quot;Communications&quot;/&gt;
        &lt;/iq:permissions&gt;

    &lt;/iq:application&gt;
&lt;/iq:manifest&gt;
</code></pre>

<h2 id="applicationattributes">Application Attributes</h2>

<p>The <code>application</code> element has a number of important attributes. The <code>id</code> field is a 128-bit UUID identifier. Unique identifiers can be generated with the <a href="http://www.uuidgenerator.net/version4">UUID Generator</a> or with standard tools.</p>

<p>The <code>entry</code> attribute must specify the <code>Toybox.Application.AppBase</code> object for your application.</p>

<p>The <code>name</code> and <code>launcherIcon</code> attributes must specify a resource ID that is defined in the app resources. If a <code>launcherIcon</code> isn’t specified a default icon will be compiled into the application.</p>

<p>The <code>type</code> field specifies what kind of application you are developing. Currently Connect IQ supports four types of apps:</p>

<ol>
<li><code>watchface</code></li>
<li><code>datafield</code></li>
<li><code>widget</code></li>
<li><code>watch-app</code></li>
</ol>

<p>The app type specified in the manifest file determines where your app appears on the device and which APIs the app can use.</p>

<p>The <code>minSdkVersion</code> field specifies the minimum Connect IQ SDK version that your app is compatible with, and serves to prevent you from targeting incompatible devices. The Eclipse plug-in allows you to select a minimum SDK version when creating a new app, or editing the properties of an existing one. Currently, the following versions are selectable when configuring your app:</p>

<ol>
<li><code>1.2.x</code></li>
<li><code>1.3.x</code></li>
<li><code>2.1.x</code></li>
</ol>

<p>The micro version is written out to the manifest at version 1 (1.2.1 for example), but only the major and minor versions are considered when determining device support.</p>

<p>Every application must include an <code>Application</code> object, which serves as the entry point for your application:</p>

<pre><code class="java">// AppBase is the base class for an app. All apps shall inherit from this
// class. It is used to manage the lifecycle of an app. For widgets and
// watch-apps, the functions are called in the following order: onStart(),
// getInitialView() and onStop(). For watchfaces and datafields, only
// getInitialView() is called. Every AppBase object has access to an object
// store to persist data.
class AppBase
{
    // Before the initial WatchUi.View is retrieved, onStart() is called.
    // This is where app level settings can be initialized or retrieved from
    // the object store before the initial View is created.
    function onStart(state);

    // To retrieve the initial WatchUi.View and WatchUi.InputDelegate
    // of the application, call getInitialView(). Providing a
    // WatchUi.InputDelegate is optional for widgets and watch-apps. For
    // watchfaces and datafields, an array containing just a WatchUi.View
    // should be returned as input is not available for these app types.
    // @return [Array] An array containing
    //     [ WatchUi.View, WatchUi.InputDelegate (optional) ]
    function getInitialView();

    // When the system is going to terminate an application, onStop() is called.
    // If the application needs to save state to the object store it should be
    // done in this function.
    function onStop(state);

    // To get the data associated with the given key from the object store,
    // use getProperty().
    // @param key Key of the value to retrieve from the object store
    //     (cannot be a Symbol)
    // @return [Object] Content associated with the key, or null if the key
    //     is not in the object store
    function getProperty( key );

    // Using a key, store the given data in the object by calling setProperty().
    // @param key The key used to store and retrieve the value from the object
    //     store (cannot be a Symbol)
    // @param [String] value The value to put into the object store
    function setProperty( key, value );

    // The GOAL_TYPE enum defines the different goal types that can be triggered.
    enum
    {
        // @since 1.3.0
        GOAL_TYPE_STEPS             = 0,
        // @since 1.3.0
        GOAL_TYPE_FLOORS_CLIMBED    = 1,
        // @since 1.3.0
        GOAL_TYPE_ACTIVE_MINUTES    = 2
    }

    // Retrieves the WatchUi.View for a goal that has triggered within a watchface.
    // If a goal is reached when a watchface is running, this function will be triggered.
    // The type of goal that was met will be provided, and the AppBase should return
    // a View that displays a goal reached message and/or animations for that goal.
    // If a View is returned from this function, the main watchface view will be
    // shutdown, and then new View will pushed. If this method is not overridden
    // in the AppBase, or if it returns null, the native goal screens will be shown.
    // @param goalType [Number] The goal type that has triggered from. From the GOAL_TYPE_??? enumeration.
    // @return [Array] An array containing [ WatchUi.View ]
    // @since 1.3.0
    function getGoalView(goalType);
}
</code></pre>

<p>The Eclipse plug-in will generate an <code>Application</code> object when a project is created.</p>

<p>An <code>Application</code> object should override <code>getInitialView()</code> to provide the view object to initially push. An array must be returned with either a view and a delegate, or just a one element array with the <code>View</code> object:</p>

<pre><code class="java">return [ new MyView(), new MyDelegate() ];
</code></pre>

<h3 id="goalviewsciq1.3">Goal Views (CIQ 1.3)</h3>

<p>Watchfaces can define additional entry points, which are triggered when a activity goal is reached. These can include a goal for reaching a threshold of steps, floors climbed, or minutes of exercise. Watchfaces can return a view to display a goal screen or animation for some, all, or none of these goal types. If a goal view is not provided, the device will display a default goal animation. This feature is available only in devices running the 1.3.0 or 2.1.0 SDK or later.</p>

<h2 id="products">Products</h2>

<p>Garmin makes a wide variety of products for many use cases, and Monkey C makes it easy to write for all our Connect IQ compatible devices. Monkey C asks the developer which Connect IQ devices they choose to support because it is impossible to know whether a future product may be incompatible with your app. As new Connect IQ compatible products appear on the market, the simulator will be updated to support them so developers can decide whether to support them.</p>

<p>The SDK currently supports two imaginary products designed for general prototyping&mdash;a <code>round-watch</code> and a <code>square-watch</code>&mdash;along with all currently supported production devices (e.g. Forerunner 920XT, f&emacr;nix 3, etc.). The round watch is button only, and the square watch is a touch screen product with fewer buttons.</p>

<p>Products supported by an app are listed in the <code>products</code> block of the manifest file:</p>

<pre><code class="xml">&lt;iq:products&gt;
    &lt;iq:product id=&quot;round-watch&quot;/&gt;
&lt;/iq:products&gt;
</code></pre>

<h2 id="permissions">Permissions</h2>

<p>Certain modules expose personal information about the user or expose communication to the internet. To use these modules, permission must be requested from the user at installation time. To request permission, the module name must be added to the permissions list of the manifest file. The following modules require permission:</p>

<ul>
<li>ActivityRecording</li>
<li>Communications</li>
<li>Positioning</li>
<li>Sensor</li>
<li>UserProfile</li>
</ul>

<p>More modules may be added to this list as modules are added to the API. To request permission, use the following syntax in the manifest file:</p>

<pre><code class="xml">&lt;iq:permissions&gt;
    &lt;iq:uses-permission id=&quot;Sensor&quot;/&gt;
&lt;/iq:permissions&gt;
</code></pre>

<h2 id="intents2.2">Intents (2.2)</h2>

<p>Intents allow a Connect IQ watch-app or widget to launch another Connect IQ watch-app, Connect IQ widget, or native application (e.g. built in activities like Run, Bike, etc.) by calling <code>System.exitTo()</code>:</p>

<pre><code class="java">//! Exit the current app and launch a new app. This is an asynchronous request.
//! If the user chooses to launch the Intent then the app will be shut down. Otherwise
//! the app will continue to run. This can only be called by watch-apps and widgets.
//! @param [Intent] content The Intent to trigger
//! @raise [UnexpectedAppTypeException] If the app requested is not a watch-app or widget
//! @raise [AppNotInstalledException] If the application requested is not installed
//! @raise [PreviousOperationNotCompleteException] If exitTo is called a second time before completing
//! @since 2.2.0
native function exitTo(content);
</code></pre>

<p>Calling <code>System.exitTo()</code> will cause a confirmation view to be displayed asking the user whether to exit to the intended app. If the user chooses &#8216;No&#8217; then the app that called <code>System.exit()</code> will continue to run. If the user chooses &#8216;Yes&#8217; then the app will exit and the new app will launch. While the confirmation view is shown, originating app will continue to run.</p>

<h3 id="exitingtoconnectiqapps">Exiting to Connect IQ Apps</h3>

<p>In order to exit to another Connect IQ app, a <code>System.Intent</code> must be created, which contains a target app identifier and any arguments you wish to pass to the target app. The target app identifier must be specified using one of two supported URI schemes:</p>

<ul>
<li><code>manifest-id://</code> followed by a valid UUID from the app&#8217;s manifest.xml</li>
<li><code>store-id://</code> followed by a valid app store UUID</li>
</ul>

<p>Arguments are passsed to the target app as a dictionary, which may be empty or <code>null</code>, and are received by the target app&#8217;s <code>onStart()</code> method as a <code>Dictionary</code> object.</p>

<pre><code class="java">using Toybox.System as Sys;
...
var intent = new Sys.Intent(&quot;manifest-id://01234567-89AB-CDEF-0123-456789ABCDEF&quot;, {&quot;lat&quot;=&gt;38.856419, &quot;lon&quot;=&gt;-94.801369});
Sys.exitTo(intent);
</code></pre>

<p>Assuming the target app is installed on the device, this example launches the app with manifest ID &#8220;01234567&#8211;89AB-CDEF&#8211;0123&#8211;456789ABCDEF&#8221; and passes it the &#8220;lat&#8221; and &#8220;lon&#8221; arguments.</p>

<h3 id="exitingtonativeapps">Exiting to Native Apps</h3>

<p><code>Intents</code> to launch native apps deal exclusively with <code>PersistedContent</code> objects, such as Waypoints, Routes, and Tracks. Connect IQ handles most of the <code>Intent</code> functionality for native apps behind the scenes, automatically embedding the appropriate native app identifier in the <code>PersistedContent</code> object, which is accesible via the <code>toIntent()</code> method. See the <a href="#persistedcontent2.2">Persisted Content</a> section for more information.</p>

<h3 id="intentexceptions">Intent Exceptions</h3>

<p>Connect IQ includes three exception types related to <code>Intents</code>:</p>

<ul>
<li><code>System.UnexpectedAppTypeException</code> is thrown if your app tries to exit to a Connect IQ app type other than watch-app or widget</li>
<li><code>System.AppNotInstalledException</code> is thrown if your app tries to exit to an app that is not installed</li>
<li><code>System.PreviousOperationNotCompleteException</code> is thrown if <code>System.exitTo()</code> is called a while a confirmation view from a previous <code>System.exitTo()</code> call has not been acknowledged by the user</li>
</ul>

<h1 id="userinterface">User Interface</h1>
<figure>
<img src="resources/programmers-guide/artsy-monkey.png" style="max-width:300px;" title="We're going to put a happy semicolon over here. Happy semicolon..." />
</figure>

<p>Making a user interface toolkit that can adapt to multiple products is hard, but it is even harder in the Garmin ecosystem. The mechanical designs of these products may be very different depending on the use case the product is designed for. As a result, the user interfaces of Garmin devices also vary by product: some have physical buttons, some have coordinate touch screens, and some provide up, down, and action buttons.</p>

<p>Rather than design a user interface toolkit that adapts to what device the UI is running on, the Connect IQ SDK makes it easier to port the user interface to different products. At the resource compiler level, we include a way to define a page in XML as well as specify page definitions per product. These tools make it easy to support multiple devices with a single app.</p>

<h2 id="drawablesviewsandlayouts">Drawables, Views, And Layouts</h2>

<p>Watch faces and apps have a page stack. A <code>View</code> is an object that represents a page. Views can be pushed onto and popped off of the page stack, or a view can replace another view on the page stack with a transition. Below is a closer look at the general <code>View</code> structure:</p>

<pre><code class="java">// View is the base class for a drawable page. It handles the lifecycle of each
// View in an app. For widgets and watch-apps the lifecyle is onStart(),
// onLayout(), onShow(), onUpdate() and onHide(). For watchfaces and datafields
// the lifecycle is onLayout(), onShow() and onUpdate().
class View
{
    // The entry point for the View is onLayout(). This is called before the
    // View is shown to load resources and set up the layout of the View.
    // @param [Graphics.Dc] dc The drawing context
    // @return [Boolean] true if handled, false otherwise
    function onLayout( dc );

    // When the View is brought into the foreground, onShow() is called.
    // @return [Boolean] true if handled, false otherwise
    function onShow();

    // When a View is active, onUpdate() is used to update dynamic content.
    // This function is called when the View is brought to the foreground.
    // For widgets and watch-apps it is also called when WatchUi.requestUpdate()
    // is called. For watchfaces it is called once a minute and for datafields
    // it is called once a second. If a class that extends View does not
    // implement this function then any Drawables contained in the View will
    // automatically be drawn.
    // @param [Graphics.Dc] dc The drawing context
    // @return [Boolean] true if handled, false otherwise
    function onUpdate( dc );

    // Before the View is removed from the foreground, onHide() is called.
    function onHide();

    // Use setLayout() to set the layout for the View. If the extending class
    // does not override onUpdate(), then all Drawables contained in layout
    // will automatically be drawn by the View.
    // @param [Array] layout An array of Drawables
    function setLayout(layout);
}
</code></pre>

<p>Each <code>View</code> contains a layout. A layout is an array of drawable objects, called <code>Drawables</code>, where each <code>Drawable</code> is positioned in the <code>View</code>. A <code>Drawable</code> can draw itself to a device context through the <code>draw( dc )</code> method.</p>
<div class="center">
<figure>
<img src="resources/programmers-guide/layout.png" style="max-width:534px;" alt="An illustration of Layouts, Views, and Drawables" title="An illustration of Layouts, Views, and Drawables" />
<figcaption>An illustration of Layouts, Views, and Drawables</figcaption>
</figure>
</div>

<p>Any object that extends <code>Drawable</code> is a drawable object, expose their properties publicly. (This will become useful when we discuss the animation system.) Monkey C provides the basic drawables <code>Text</code> and <code>Bitmap</code>, allowing text and bitmap resources to be included in layouts.</p>

<h3 id="defininglayoutsanddrawablesinresources">Defining Layouts And Drawables In Resources</h3>

<p>The resource compiler allows page layouts to be customized to a particular device without changing any Monkey C code. In addition, <code>DrawableList</code> objects can also be defined, which are <code>Drawable</code> objects that can draw a number of graphics primitives.</p>

<h3 id="usingalayout">Using a Layout</h3>

<p>When defining a layout in XML, simply list the drawable objects to include in your layout inside a set of layout tags. Each drawable listed will be turned into Monkey C <code>Drawable</code> objects and drawn one after the other. Because of this, if two drawables in your layout overlap each other the drawable that is defined second will draw on top of the drawable that is defined first. Here is an example of a basic layout:</p>

<pre><code class="xml">&lt;resources&gt;
    &lt;layout id=&quot;MainLayout&quot;&gt;
        &lt;drawable id=&quot;MainBackground&quot; /&gt;
        &lt;label text=&quot;Page Heading&quot; x=&quot;10&quot; y=&quot;5&quot; font=&quot;Gfx.FONT_LARGE&quot; color=&quot;Gfx.COLOR_BLACK&quot; /&gt;
        &lt;label text=&quot;Your information goes here.&quot; x=&quot;10&quot; y=&quot;25&quot; font=&quot;Gfx.FONT_MEDIUM&quot; color=&quot;Gfx.COLOR_DK_GRAY&quot; /&gt;
    &lt;/layout&gt;
&lt;/resources&gt;
</code></pre>

<p>To use this layout in your code simply call <code>setLayout()</code> inside the <code>onLayout(dc)</code> function. Call the View’s <code>onUpdate(dc)</code> if you plan on using the <code>onUpdate(dc)</code> function to update dynamic values on the screen. For example:</p>

<pre><code class="java">class MainView {
    function onLayout( dc ) {
        setLayout( Rez.Layouts.MainLayout( dc ) );
    }

    function onUpdate( dc ) {
        // Call parent’s onUpdate(dc) to redraw the layout
        View.onUpdate( dc );

        // Include anything that needs to be updated here
    }
}
</code></pre>

<p>The following attributes are supported by the <code>layout</code> tag:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The handle for the layout. This is used to reference the layout in the Rez module</td>
	<td style="text-align:left;">Any value that starts with a letter</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<p>Drawables (both bitmaps and drawable XML resources) can be included in a Layout using the <code>drawable</code> tag. The following attributes are supported by the <code>drawable</code> tag:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The handle for the drawable. The ID provided here references the drawable defined in the resource XML file</td>
	<td style="text-align:left;">Any value that starts with a letter</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required; the drawable must also be defined in a resource XML file</td>
</tr>
</tbody>
</table>

<p>Text can also be included in layouts. To inlude text use the <code>label</code> tag, which supports the following attributes:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>text</code></td>
	<td style="text-align:left;">The text to be displayed</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">An empty string</td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>font</code></td>
	<td style="text-align:left;">The font to be used when drawing the text</td>
	<td style="text-align:left;"><code>Graphics</code> font constant or the ID of a user-defined font</td>
	<td style="text-align:left;"><code>Graphics.FONT_MEDIUM</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>x</code></td>
	<td style="text-align:left;">The X coordinate of the point that the text will be justified against</td>
	<td style="text-align:left;">pixel value or <code>center</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>y</code></td>
	<td style="text-align:left;">The Y coordinate of the point that the text will be justified against</td>
	<td style="text-align:left;">pixel value or <code>center</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>justification</code></td>
	<td style="text-align:left;">How the text should be justified in relation to the X &amp; Y location</td>
	<td style="text-align:left;">Graphics text justify constant</td>
	<td style="text-align:left;"><code>Graphics.TEXT_JUSTIFY_LEFT</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>color</code></td>
	<td style="text-align:left;">The color of the text</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;">The current draw context&#8217;s foreground color</td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<h3 id="drawables">Drawables</h3>

<p>Drawable XML resources consist of a list of basic drawables: bitmaps and shapes. To create an XML drawable, define a <code>&lt;drawable-list&gt;</code> in an XML resource file. Both <code>&lt;bitmap&gt;</code> and <code>&lt;shape&gt;</code> tags should be be placed as child nodes inside the <code>&lt;drawable-list&gt;</code>. An example drawable-list:</p>

<pre><code class="xml">&lt;resources&gt;
    &lt;drawable-list id=&quot;Smiley&quot; background=&quot;Gfx.COLOR_YELLOW&quot;&gt;
        &lt;shape type=&quot;circle&quot; x=&quot;10&quot; y=&quot;10&quot; radius=&quot;5&quot; color=&quot;Gfx.COLOR_BLACK&quot; /&gt;
        &lt;shape type=&quot;circle&quot; x=&quot;30&quot; y=&quot;10&quot; radius=&quot;5&quot; color=&quot;Gfx.COLOR_BLACK&quot; /&gt;
        &lt;bitmap id=&quot;mouth&quot; x=&quot;15&quot; y=&quot;25&quot; filename=&quot;../bitmaps/mouth.png&quot; /&gt;
    &lt;/drawable-list&gt;
&lt;/resources&gt;
</code></pre>

<p>To use this drawable in code do the following:</p>

<pre><code class="java">function onUpdate( dc ) {
    var mySmiley = new Rez.Drawables.Smiley();
    mySmiley.draw( dc );
}
</code></pre>

<p>The <code>&lt;drawable-list&gt;</code> tag supports the following attributes:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The ID of the drawable</td>
	<td style="text-align:left;">Any string that starts with a character</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>x</code></td>
	<td style="text-align:left;">The X coordinate of the top left corner in relation to the parent element</td>
	<td style="text-align:left;">pixel value or <code>center</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>y</code></td>
	<td style="text-align:left;">The Y coordinate of the top left corner in relation to the parent element</td>
	<td style="text-align:left;">pixel value or <code>center</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>width</code></td>
	<td style="text-align:left;">The width of the drawable list.</td>
	<td style="text-align:left;">pixel value or <code>fill</code></td>
	<td style="text-align:left;"><code>fill</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>height</code></td>
	<td style="text-align:left;">The height of the drawable list.</td>
	<td style="text-align:left;">pixel value of <code>fill</code></td>
	<td style="text-align:left;"><code>fill</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>foreground</code></td>
	<td style="text-align:left;">The color of elements (shapes and text) drawn in this layout</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;">The current draw context&#8217;s foreground color</td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>background</code></td>
	<td style="text-align:left;">The background color of this layout</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;"><code>Gfx.COLOR_TRANSPARENT</code></td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<p>The <code>&lt;shape&gt;</code> tag supports the following attributes:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>type</code></td>
	<td style="text-align:left;">The type of the shape to be drawn</td>
	<td style="text-align:left;"><code>rectangle</code>, <code>ellipse</code>, <code>circle</code>, or <code>polygon</code></td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>x</code></td>
	<td style="text-align:left;">For circles and ellipses: X coordinate of the center of the shape in relation to the parent; for everything else: the X coordinate of the top left corner in relation to the parent element.</td>
	<td style="text-align:left;">pixel value or <code>center</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>y</code></td>
	<td style="text-align:left;">For circles and ellipses: Y coordinate of the center of the shape in relation to the parent; for everything else: the Y coordinate of the top left corner in relation to the parent element</td>
	<td style="text-align:left;">pixel value or <code>center</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>points</code></td>
	<td style="text-align:left;">A list of points which defines the <code>polygon</code></td>
	<td style="text-align:left;"><code>[[x1, y1], [x2, y2], ... , [xN, yN]]</code></td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required for <code>polygon</code>; must have at least 3 points</td>
</tr>
<tr>
	<td style="text-align:center;"><code>width</code></td>
	<td style="text-align:left;">The width of the shape to be drawn</td>
	<td style="text-align:left;">pixel value or <code>fill</code></td>
	<td style="text-align:left;"><code>fill</code></td>
	<td style="text-align:left;">Only valid for <code>rectangle</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>height</code></td>
	<td style="text-align:left;">The height of the shape to be drawn</td>
	<td style="text-align:left;">pixel value or <code>fill</code></td>
	<td style="text-align:left;"><code>fill</code></td>
	<td style="text-align:left;">Only valid for <code>rectangle</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>a</code></td>
	<td style="text-align:left;">The a value of the ellipse to be drawn</td>
	<td style="text-align:left;">pixel value or <code>fill</code></td>
	<td style="text-align:left;"><code>fill</code></td>
	<td style="text-align:left;">Only valid for <code>ellipse</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>b</code></td>
	<td style="text-align:left;">The b value of the ellipse to be drawn</td>
	<td style="text-align:left;">pixel value or <code>fill</code></td>
	<td style="text-align:left;"><code>fill</code></td>
	<td style="text-align:left;">Only valid for <code>ellipse</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>color</code></td>
	<td style="text-align:left;">The color of the shape to be drawn</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;">The current draw context&#8217;s foreground color</td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>corner_radius</code></td>
	<td style="text-align:left;">The radius of the rounded corners of the <code>rectangle</code></td>
	<td style="text-align:left;">pixel value</td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;">Only valid for <code>rectangle</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>radius</code></td>
	<td style="text-align:left;">The radius of the <code>circle</code></td>
	<td style="text-align:left;">pixel value</td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;">Required for <code>circle</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>border_width</code></td>
	<td style="text-align:left;">The width of the border around the shape</td>
	<td style="text-align:left;">pixel value</td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;">Only valid for <code>rectangle</code>, <code>ellipse</code>, and <code>circle</code></td>
</tr>
<tr>
	<td style="text-align:center;"><code>border_color</code></td>
	<td style="text-align:left;">The color of the border around the shape</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;">The current draw context&#8217;s foreground color</td>
	<td style="text-align:left;">Only valid for <code>rectangle</code>, <code>ellipse</code>, and <code>circle</code></td>
</tr>
</tbody>
</table>

<p>The <code>&lt;bitmap&gt;</code> tag supports the following attributes:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The ID of the drawable</td>
	<td style="text-align:left;">Any string that starts with a character</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>x</code></td>
	<td style="text-align:left;">The X coordinate of the top left corner in relation to the parent element</td>
	<td style="text-align:left;">pixel value or <code>center</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>y</code></td>
	<td style="text-align:left;">The Y coordinate of the top left corner in relation to the parent element</td>
	<td style="text-align:left;">pixel value or <code>center</code></td>
	<td style="text-align:left;"><code>0</code></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:center;"><code>filename</code></td>
	<td style="text-align:left;">The relative path to the image that should be shown</td>
	<td style="text-align:left;">A valid, relative path</td>
	<td style="text-align:left;">NA</td>
	<td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<h3 id="customdrawables">Custom Drawables</h3>

<p>In some cases it is useful to have a drawable entry within a layout point to a custom defined class which extends <code>Toybox.WatchUi.Drawable</code>. This is possible by using the <code>class</code> attribute of the <code>&lt;drawable&gt;</code> tag.</p>

<pre><code class="xml">&lt;layout&gt;
    &lt;drawable id=&quot;MoveBar&quot; class=&quot;CustomMoveBar&quot; /&gt;
&lt;/layout&gt;
</code></pre>

<p>The drawable entry above will add a new instance of the <code>CustomMoveBar</code> class to the layout. You can then define how the <code>CustomMoveBar</code> is drawn by overriding the <code>draw(dc)</code> function.</p>

<pre><code class="java">using Toybox.WatchUi as Ui;

class CustomMoveBar extends Ui.Drawable {
    function draw(dc) {
        // Draw the move bar here
    }
}
</code></pre>

<h4 id="passingparameterstocustomdrawables">Passing Parameters to Custom Drawables</h4>

<p>If may be useful to pass values into a custom Drawable. To do this you define <code>&lt;param&gt;</code> children within the <code>&lt;drawable&gt;</code> tag. The <code>&lt;param&gt;</code> tag should define the name of the parameter using the <code>name</code> attribute and the value as it&#8217;s content. The content value is passed as is to the custom Drawable. This means if you want to pass a string you must wrap the content in quotes.</p>

<pre><code class="xml">&lt;layout&gt;
    &lt;drawable id=&quot;MoveBar&quot; class=&quot;CustomMoveBar&quot;&gt;
        &lt;param name=&quot;color&quot;&gt;Gfx.COLOR_RED&lt;/param&gt;
        &lt;param name=&quot;string&quot;&gt;&quot;Hello Custom Drawable!&quot;&lt;/param&gt;
    &lt;/drawable&gt;
&lt;/layout&gt;
</code></pre>

<p>The parameters defined in XML are passed to the custom Drawable&#8217;s initialize function as a dictionary. The names are passed as symbols and the values are passed as they appear in the XML.</p>

<pre><code class="java">using Toybox.WatchUi as Ui;

class CustomMoveBar extends Ui.Drawable {

    hidden var mColor, mString;

    function initialize(params) {
        // You should always call the parent's initializer and
        // in this case you should pass the params along as size
        // and location values may be defined.
        Drawable.initialize(params);

        // Get any extra values you wish to use out of the params Dictionary
        mColor = params.get(:color);
        mString = params.get(:string);
    }
}
</code></pre>

<h2 id="goalviewsciq1.3">Goal Views (CIQ 1.3)</h2>

<p>The screen displayed when activity tracking goals are reached can be overridden by the active watchface. This is done by implementing the <code>getGoalView()</code> function in the application&#8217;s <code>AppBase</code> class.</p>

<pre><code class="java">class AppBase {
    function getGoalView(goalType);
}
</code></pre>

<p>The &#8216;getGoalView()&#8217; function is passed one of the supported goal view types: &#8216;GOAL_TYPE_STEPS&#8217;, &#8216;GOAL_TYPE_FLOORS_CLIMBED&#8217;, or &#8216;GOAL_TYPE_ACTIVE_MINUTES&#8217;. Not all types are supported on every product. The application can return a view to be displayed from this function, or null to allow the system to display the default goal display. Goal Views can start animations, similar to the main WatchFace view when onExitSleep() is triggered. Goal Views are displayed for approximately 10 seconds. When they expire, the system will call &#8216;getInitialView()&#8217; to switch back to the main WatchFace view.</p>

<h2 id="inputhandling">Input Handling</h2>

<p>As if input handling wasn&#8217;t already one of the most important and complicated pieces of a UI toolkit, Garmin devices take the complication up a level. Unlike those touchable glowing rectangles that are modern smart phones, Garmin devices come in lots of shapes and sizes. Touch screens are not always ideal for all watch products, so there is a mix of input styles and screen technologies. It&#8217;s the job of the UI toolkit to make this coherent to the developer.</p>

<h3 id="inputandapptypes">Input and App Types</h3>

<p>Not all app types have access to input. Watch faces and data fields cannot handle input, though widgets can receive input (may be limited on some devices) and watch-apps will have the most input capability.</p>

<h3 id="inputdelegates">Input Delegates</h3>

<p>The <code>Delegate</code> object is an object that implements a certain interface specific to input handling. Monkey C provides a low level <code>InputDelegate</code> that allows handling of events at a basic level. This is good when the app needs to handle button presses or screen presses in a particular way.</p>

<pre><code class="java">module WatchUi
{
    // This class implements basic input handling. A developer needs to override
    // the events they want to handle.
    class InputDelegate
    {
        // Key event
        // @param evt KEY_XXX enum value
        // @return true if handled, false otherwise
        function onKey( evt );

        // Click event
        // @param evt Event object with click information
        // @return true if handled, false otherwise
        function onTap( evt );

        // Screen hold event. Sent if user is touching
        // the screen
        // @param evt Event object with hold information
        // @return true if handled, false otherwise
        function onHold( evt );

        // Screen release. Sent after an onHold
        // @param evt Event object with hold information
        // @return true if handled, false otherwise
        function onRelease( evt );

        // Screen swipe event
        // @param evt Event
        function onSwipe( evt );
    }
}
</code></pre>

<h2 id="behaviors">Behaviors</h2>

<p>Garmin makes products with a purpose, and that purpose can alter the design of one product line over another. Deciding whether a product has a touch screen or has buttons can depend on the environment in which the user will take. For instance, if the product is intended to be used in water (swimming, canoeing, on a boat), it may not have a touch screen. These decisions make for superior products, but also add to developer frustration due to device fragmentation.</p>

<p>Most products will support common behaviors (next page, back a page), but how they are executed by the user may differ based on the available input types. To help with this dilemma, Monkey C exposes events at a behavior level. Behaviors separate high-level intentions from the actual input type&mdash;next page versus screen press. The <code>BehaviorDelegate</code> is a super class of <code>InputDelegate</code> and maps its low level inputs to common operations across multiple products. Using the <code>BehaviorDelegate</code> can lead to much more portable code.</p>

<pre><code class="java">// BehaviorDelegate handles behavior inputs. A BehaviorDelegate differs from
// an InputDelegate in that it acts upon device independent behaviours such as
// next page and previous page. On touch screen devices these behaviors might be
// mapped to the basic swipe left and right inputs, while on non-touch screen
// devices these behaviors might be mapped to actual keys.
// BehaviorDelegate extends InputDelegate so it can also act on basic inputs as
// well. If a BehaviorDelegate does return true for a function, indicating that
// the input was used, then the InputDelegate function that corresponds to the
// behavior will be called.
// @see InputDelegate
class BehaviorDelegate extends InputDelegate
{
    // When a next page behavior occurs, onNextPage() is called.
    // @return [Boolean] true if handled, false otherwise
    function onNextPage();

    // When a previous page behavior occurs, onPreviousPage() is called.
    // @return [Boolean] true if handled, false otherwise
    function onPreviousPage();

    // When a menu behavior occurs, onMenu() is called.
    // @return [Boolean] true if handled, false otherwise
    function onMenu();

    // When a back behavior occurs, onBack() is called.
    // @return [Boolean] true if handled, false otherwise
    function onBack();

    // When a next mode behavior occurs, onNextMode() is called.
    // @return [Boolean] true if handled, false otherwise
    function onNextMode();

    // When a previous mode behavior occurs, onPreviousMode() is called.
    // @return [Boolean] true if handled, false otherwise
    function onPreviousMode();
}
</code></pre>

<h2 id="builtinhandlers">Built In Handlers</h2>

<p>In general, complicated input from users and feedback to users should not be done on a wearable device, but should instead be done via a phone app or web page. However, sometimes the device needs to get some form of user input or provide confirmation to the user.</p>

<p><code>WatchUi</code> provides three widgets to handle input: menus, the generic picker, and the number picker (the number picker has been deprecated in favor of the generic picker).</p>

<p>Two additional handlers provided by <code>WatchUi</code> can be used to give feedback to the user: the confirmation dialog and progress dialog.</p>

<h3 id="menu">Menu</h3>

<p>A menu is a list of options for the user. The options are displayed in a list that matches the device the app is running on. A menu can be defined in the resource XML file using the following format:</p>

<pre><code class="xml">&lt;menu id=&quot;MainMenu&quot;&gt;
    &lt;menu-item id=&quot;item_1&quot;&gt;Item 1&lt;/menu-item&gt;
    &lt;menu-item id=&quot;item_2&quot;&gt;Item 2&lt;/menu-item&gt;
&lt;/menu&gt;
</code></pre>

<p>The resource compiler will then take this XML and generate a <code>Menu</code> object in the <code>Rez</code> module. In order to use this menu, a developer simply needs to push the menu and a delegate for the menu using <code>Ui.pushView()</code>:</p>

<pre><code class="java">class MyClass extends Ui.View {
    function openTheMenu() {
        Ui.pushView( new Rez.Menus.MainMenu(), new MyMenuDelegate(), Ui.SLIDE_UP );
    }
}

class MyMenuDelegate extends Ui.MenuInputDelegate {
    function onMenuItem(item) {
        if ( item == :item_1 ) {
            // Do something here
        } else if ( item == :item_2 ) {
            // Do something else here
        }
    }
}
</code></pre>

<h3 id="genericpicker">Generic Picker</h3>

<p>The <code>Picker</code> class, along with the <code>PickerDelegate</code> and <code>PickerFactory</code> classes, provides applications with the ability to create onscreen lists of user-selectable objects. A picker consists of one or more choosable objects, a title, a next and previous arrow, and a confirm button. The next and previous arrows and the confirm button are device specific but can be overwritten if desired. Pickers are pushed using <code>WatchUi.pushView()</code>, providing a <code>PickerDelegate</code> for the input delegate. A <code>PickerFactory</code> is required to indicate what should be displayed for each pickable value.</p>

<p>Sample picker implementations can be found in the Picker sample project, inside the <code>samples/Picker</code> directory.</p>

<h4 id="userinterface">User Interface</h4>
<figure>
<img src="resources/programmers-guide/picker-layout.png" style="max-width:205px;" title="Main components of a generic picker layout" >
</figure>

<p>The above image is a representation of the general structure of what a picker should look like on a square screen. Other screen formats should have the same layout with some size differences to account for the screen and button layout.</p>

<ul>
<li>The top red bar represents where the title of the picker is displayed.</li>
<li>Up and down arrows to scroll through the available options are placed where the green boxes are.</li>
<li>The leftmost blue box is where the last item you selected is shown if the picker has multiple selectable items.</li>
<li>The center blue box is the item you are currently selecting.</li>
<li>The white box will either be the next selectable item in the list or the button to confirm your selection.</li>
</ul>

<h4 id="developmentinterface">Development Interface</h4>

<pre><code class="java">// A Picker uses a PickerFactory to decide what to display to the user. It is
// capable of displaying any number of entries for the user to choose from.
// For instance, if the PickerFactory was [new NumberFactory(), new Ui.Text({:text=&gt;&quot;-&quot;}), new NumberFactory()]
// then the Picker will have three entries: a choosable number, a non-choosable &quot;-&quot;, and another choosable number.
class Picker extends Toybox.WatchUi.View
{
    // Constructor
    // @param [Dictionary] options @see Picker#setOptions
    function initialize( options );

    // Set the options for the Picker.
    // @param [Dictionary] options the options for the Picker
    // @option options [Drawable] :title the title for the Picker. Required.
    // @option options [Array] :pattern an Array of [Object] for the Picker to display. If the Array entry is a PickerFactory then it is presented to the user to make a choice. If it is a Drawable then it is display only. Required.
    // @option options [Array] :defaults an Array of [Number] indicating the starting index for each entry in :pattern. Optional.
    // @option options [Drawable] :nextArrow a custom next icon for the Picker. Optional.
    // @option options [Drawable] :previousArrow a custom previous icon for the Picker. Optional.
    // @option options [Drawable] :confirm a custom confirm icon for the Picker. Optional.
    function setOptions( options );
}

// PickerDelegate responds to a confirm or cancel. The
// Picker does not automatically call popView.
// event from a [Picker].
class PickerDelegate
{
    // Handle a confirm event from a [Picker]
    // @param [Array] values The chosen values from the Picker. For [Drawable] entries, null will be returned for that value.
    function onAccept( values );

    // Handle a cancel event from a [Picker]
    function onCancel();
}

// A PickerFactory is used by a Picker to display Drawables to
// be chosen.
class PickerFactory
{
    // Generate a Drawable instance for a given item
    // @param [Number] item Item index
    // @param [Boolean] isSelected true if the current item is the selected item, false otherwise
    // @return [Drawable] object to be rendered
    function getDrawable( item, isSelected );

    // Return a representative value for this item
    // @param [Number] item Item index
    // @return [Object] Representative item for the given index
    function getValue( item );

    // Get the number of items in the factory
    // @return [Number] number of items in the factory
    function getSize();
}
</code></pre>

<h3 id="numberpicker-deprecated">Number Picker - <em>DEPRECATED</em></h3>

<p>To allow the user to pick or adjust numerical data, the number picker widget is your best bet. The number picker widget allows for editing or adjusting of common numerical types. Here&#8217;s an example of number picker use:</p>

<pre><code class="java">enum
{
    NUMBER_PICKER_DISTANCE,     // A Float in meters
    NUMBER_PICKER_TIME,         // A Duration
    NUMBER_PICKER_TIME_MIN_SEC, // A Duration
    NUMBER_PICKER_TIME_OF_DAY,  // A Duration representing the number of seconds since midnight
    NUMBER_PICKER_WEIGHT,       // A Float in kilograms
    NUMBER_PICKER_HEIGHT,       // A Float in meters
    NUMBER_PICKER_CALORIES,     // A Number
    NUMBER_PICKER_BIRTH_YEAR    // A Number
}

// This is the on-screen representation of number picker. The look-and-feel
// will be device specific. NumberPickers are pushed using WatchUi.pushView(),
// providing a NumberPickerDelegate for the input delegate. There are minimum
// and maximum values enforced by the product for each mode. The initial value
// will be modified to be within these bounds.
class NumberPicker
{
    // Constructor
    // @param mode An enum value of type NUMBER_PICKER_*
    // @param initialValue The initial value for the Number Picker, type
    //       depends on mode
    function initialize( mode, initialValue );
}

// NumberPickerDelegate responds to a number being chosen. This class should be
// extended to get the chosen number.
class NumberPickerDelegate
{
    // When a number is chosen, onNumberPicked() is called, passing the
    // chosen value.
    // @param value The chosen number, type depends on the NumberPicker mode
    function onNumberPicked( value );
}
</code></pre>

<h3 id="confirmationdialog">Confirmation Dialog</h3>

<p>The confirmation dialog provides a simple yes/no dialog. This is useful when presenting a simple selection.</p>

<pre><code class="java">enum
{
    CONFIRM_NO,
    CONFIRM_YES
}

// This is the on-screen representation of the confirmation dialog.
// The look-and-feel will be device specific. Confirmations
// are pushed using WatchUi.pushView(), providing a ConfirmationDelegate
// for the input delegate.
class Confirmation
{
    // Constructor
    // @param [String] message A textual confirmation message
    function initialize( message );
}

// ConfirmationDelegate handles a response being chosen in the Confirmation.
class ConfirmationDelegate
{
    // When a response is chosen, onResponse() is called, passing
    // the response of CONFIRM_NO or CONFIRM_YES
    // @param response The response of the confirmation of CONFIRM_NO or CONFIRM_YES
    function onResponse( response );
}
</code></pre>

<h3 id="progressbar">Progress Bar</h3>

<p>The progress dialog gives a standard wait dialog. It has two modes&mdash;one that shows the completion of some process, and a second that acts a wait timer displaying an indeterminate amount of progress. The look and feel of the progress bar will be device-specific.</p>

<pre><code class="java">// This is the on-screen representation of a progress bar.
// The look-and-feel will be device specific. ProgressBars are pushed
// using WatchUi.pushView(), providing either null or an input delegate.
// This can display a string and either a progress bar from 0-100%
// or a busy bar.
class ProgressBar
{
    // Constructor
    // @param [String] displayString The string to display on the progress bar view
    // @param [Float] startValue The initial value for the progress bar (0-100), null for &quot;busy&quot;
    function initialize( displayString, startValue );

    // Use setProgress() to set the value of the progress bar.
    // @param [Float] progressValue The value for the progress bar (0-100), null for &quot;busy&quot;
    function setProgress( progressValue );

    // Use setDisplayString() to set the string displayed on the progress bar view.
    // @param [String] displayString The string to display on the progress bar view
    function setDisplayString( displayString );
}
</code></pre>

<h3 id="datafield">Data Field</h3>

<p>On Devices with touch screen support, an input delegate can be used to accept input. Only the onTap() behavior is supported and will be triggered when the user touches a point inside the data field when it is active on the screen. The behavior delegate should be the second element of the array that is returned from getInitialView as with other app types.</p>

<pre><code class="java">// This data field accepts touch input
class DataFieldApp extends App.AppBase {
    // Data field view with associated behavior delegate
    function getInitialView() {
        return [ new DataFieldView(), new DataFieldDelegate() ];
    }
}

class DataFieldDelegate extends Ui.InputDelegate {
    // Handle touch events
    function onTap(evt) {
        // Process the touch event
    }
</code></pre>

<h2 id="selectablesandbuttonsciq2.1">Selectables and Buttons (CIQ 2.1)</h2>

<h3 id="selectables">Selectables</h3>

<p>Monkey C provides an interface for products with large touch screens (and few buttons) to easily define touchable objects on-screen known as a <code>WatchUi.Selectable</code>:</p>

<pre><code class="java">//! Selectable is the class representation of an on-screen
//! selectable object with defined states depending on selection mode
//! @see Drawable
//! @since 2.1.0
class Selectable extends Toybox.WatchUi.Drawable
{
    //! Default state Drawable, Graphics.COLOR_* constant, or 24-bit integer of the form 0xRRGGBB
    //! @return [Object]
    //! @since 2.1.0
    (:property) var stateDefault;

    //! Highlighted state Drawable, Graphics.COLOR_* constant, or 24-bit integer of the form 0xRRGGBB
    //! @return [Object]
    //! @since 2.1.0
    (:property) var stateHighlighted;

    //! Selected state Drawable, Graphics.COLOR_* constant, or 24-bit integer of the form 0xRRGGBB
    //! @return [Object]
    //! @since 2.1.0
    (:property) var stateSelected;

    //! Disabled state Drawable, Graphics.COLOR_* constant, or 24-bit integer of the form 0xRRGGBB
    //! @return [Object]
    //! @since 2.1.0
    (:property) var stateDisabled;

    //! Constructor
    //! @param [Dictionary] options Parameters to specify in Selectable creation
    //! @option options [Number] :locX @see Drawable#initialize. Required.
    //! @option options [Number] :locY @see Drawable#initialize. Required.
    //! @option options [Number] :width @see Drawable#initialize. Required.
    //! @option options [Number] :height @see Drawable#initialize. Required.
    //! @option options [Object] :stateDefault Drawable to display in default state. Optional.
    //! @option options [Object] :stateHighlighted Drawable to display in disable state. Optional.
    //! @option options [Object] :stateSelected Drawable to display in highlight state. Optional.
    //! @option options [Object] :stateDisabled Drawable to display in selected state. Optional.
    //! @since 2.1.0
    function initialize(options);

    //! Get the current state.
    //! @return [Symbol] The current state (:stateDefault, :stateHighlighted, etc).
    //! @since 2.1.0
    function getState();

    //! Set the current state.
    //! @param [Symbol] state The desired state (:stateDefault, :stateHighlighted, etc) to make current.
    //! @since 2.1.0
    function setState(state);

    //! Draw the object to the display context with draw(). Assume that the
    //! device context has already been configured to the proper settings.
    //! @param [Graphics.Dc] dc The device context
    //! @since 2.1.0
    function draw(dc);
}

//! SelectableEvent is an object sent to InputDelegate when the user
//! manipulates a Selectable using hard-keys or the touchscreen.
//! @since 2.1.0
class SelectableEvent
{
    //! Constructor
    //! @param [Selectable] instance The Selectable that generated the event
    //! @param [Symbol] previousState The previous Selectable state (stateDefault, stateHighlighted, etc)
    //! @since 2.1.0
    function initialize(instance, previousState);

    //! Get the previous state of the Selectable that generated the event.
    //! @return [Symbol] The previous Selectable state (stateDefault, stateHighlighted, etc)
    //! @since 2.1.0
    function getPreviousState();

    //! Get the instance of the manipulated Selectable.
    //! @return The Reference to the Selectable manipulated
    //! @since 2.1.0
    function getInstance();
}

//! InputDelegate handles basic input events. There are three types of basic
//! inputs: key, touch, and swipe.
//! @since 1.0.0
class InputDelegate
{
    //! When the state of a Selectable changes, onSelectable() is called. The instance of the
    //! associated Selectable is passed so that its current state may be determined.
    //! @param [Selectable] instance The Selectable that generated the event
    //! @param [Symbol] previousState The previous Selectable state (stateDefault, stateHighlighted, etc)
    //! @return [Boolean] true if handled, false otherwise
    //! @since 2.1.0
    function onSelectable(instance, previousState);
}
</code></pre>

<p>A <code>Selectable</code> is a state driven object that supports four optional built-in states which are set based on touch interaction:</p>

<ul>
<li>Default (:stateDefault) - Initial state</li>
<li>Highlighted (:stateHighlighted) - Selectable is currently being pressed</li>
<li>Selected (:stateSelected) - Selectable was pressed and released (i.e. tapped)</li>
<li>Disabled (:stateDisabled) - Selectable has been disabled</li>
</ul>

<p>Once a state change occurs, a <code>SelectableEvent</code> is sent which results in a call to <code>WatchUi.InputDelegate.onSelectable()</code>, which passes both the instance of the current Selectable and the symbol of the previous state for comparison, and allows for custom actions as a result of the state change. Selectables <em>must</em> be registered as part of the View&#8217;s layout via the <code>WatchUi.View.setLayout()</code> call in order to for the View to know about them and direct touch events to the object. Stacked instances of Selectables will have input directed to them depending on their order as passed to <code>setLayout()</code> (last in, first drawn / selected).</p>

<p>A new method for the <code>View</code> class is defined to enable compatiblity mode with button-only products:</p>

<pre><code class="java">//! Set the state of the keys to Selectable interaction mode. In this mode the
//! keys are used to cycle through the on screen Selectable objects. The first
//! registered Selectable in the current layout will be highlighted.
//! @param [Boolean] enabled If the mode should be enabled
//! @since 2.1.0
function setKeyToSelectableInteraction(enabled);
</code></pre>

<p>The above routine may be called to enable the up/down keys to cycle through the list of Selectables registered via the View&#8217;s <code>setLayout()</code> call, which sets the highlighted state on a <code>Selectable</code> until it is put in the Selected state via the enter key.</p>

<p>Each of the four states must be mapped to a <code>Drawable</code>, Graphics.COLOR_* constant, or 24-bit integer of the form 0xRRGGBB. States are optionally defined and be specified in the <code>Selectable</code> constructor, or manually modified as members of the instance. Each <code>Selectable</code> will draw the current state using the defined <code>locX</code> and <code>locY</code> coordinates as an offset if it has been defined. Extending <code>Selectable</code> with additional states is encouraged and the <code>getState()</code> and <code>setState()</code> routines may used to alter the default state machine (see Selectable sample application for a demonstration of check boxes).</p>

<h3 id="buttons">Buttons</h3>

<p>A <code>WatchUi.Button</code> is derived from <code>Selectable</code> and adds the ability to define a background and map interaction to an existing or new custom method (i.e. <code>onMenu()</code>) within <code>WatchUi.BehaviorDelegate</code>:</p>

<pre><code class="java">//! Button is the class representation of a Selectable that is mappable
//! is to a BehaviorDelegate method on selection.
//! @see Selectable
//! @since 2.1.0
class Button extends Toybox.WatchUi.Selectable {

    //! Background Drawable, Graphics.COLOR_* constant, or 24-bit integer of the form 0xRRGGBB to be
    //! drawn before the current Selectable state is drawn.
    //! @return [Object]
    //! @since 2.1.0
    (:property) var background;

    //! Behavior method executed when button is selected. This method must be a member of the active
    //! View's registered BehaviorDelegate, such as :onBack, but may also be a method of an extended
    //! class. If the method returns false, or is not specified (null), then a SelectableEvent will be
    //! issued.
    //! @return [Method]
    //! @since 2.1.0
    (:property) var behavior;

    //! Constructor
    //! Initialize the Button foreground, background, and behavior. The Button must be registered via a
    //! setLayout() call in order to be usable. Accepts the standard Selectable symbols and
    //! also includes its requirements.
    //! @param options [Dictionary] Parameters to specify in Button creation
    //! @option options [Method] :behavior Method object to call when selected, or null to use a SelectableEvent. Optional.
    //! @option options [Object] :background Drawable, Graphics.COLOR_* constant, or 24-bit integer of the form 0xRRGGBB. Optional.
    function initialize(options);

    //! Draw the object to the display context with draw(). Assume that the
    //! device context has already been configured to the proper settings.
    //! @param [Graphics.Dc] dc The device context
    //! @since 2.1.0
    function draw(dc);
}
</code></pre>

<h3 id="definingselectablesandbuttonsinlayouts">Defining Selectables And Buttons In Layouts</h3>

<p>Much like their parent <code>Drawable</code>, Selectables and Buttons both support the layout system. Selectable and Button XML resources consist of a list of state ID&#8217;s and optional parameters. To create an XML Selectable, define a <code>&lt;selectable&gt;</code> in an XML resource file:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>x</code></td>
	<td style="text-align:left;">The X coordinate of the top left corner of the Selectable region</td>
	<td style="text-align:left;">Pixel value, <code>center</code>, <code>left</code>, or <code>right</code></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>y</code></td>
	<td style="text-align:left;">The Y coordinate of the top left corner of the Selectable region</td>
	<td style="text-align:left;">Pixel value, <code>center</code>, <code>top</code>, or <code>bottom</code></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>width</code></td>
	<td style="text-align:left;">The width of the Selectable region</td>
	<td style="text-align:left;">pixel value</td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>height</code></td>
	<td style="text-align:left;">The height of the Selectable region</td>
	<td style="text-align:left;">pixel value</td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<p>The <code>&lt;button&gt;</code> resource expands the definition of <code>&lt;selectable&gt;</code> and adds the following:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>behavior</code></td>
	<td style="text-align:left;">A method existing within a View&#8217;s registered BehaviorDelegate</td>
	<td style="text-align:left;">Method symbol</td>
	<td style="text-align:left;"><code>null</code></td>
	<td style="text-align:left;">Optional / Param</td>
</tr>
<tr>
	<td style="text-align:center;"><code>background</code></td>
	<td style="text-align:left;">The background color of the Button</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;"><code>Gfx.COLOR_TRANSPARENT</code></td>
	<td style="text-align:left;">Optional / Param</td>
</tr>
</tbody>
</table>

<p>Both <code>&lt;selectable&gt;</code> and <code>&lt;button&gt;</code> tags use <code>&lt;state&gt;</code> as child nodes to define their states at construction. Each state is defined optionally but is defined as the following:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Definition</th>
	<th style="text-align:left;">Valid Values</th>
	<th style="text-align:left;">Default Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">The state ID for the Button / Selectable</td>
	<td style="text-align:left;"><code>stateDefault</code>, <code>stateHighlighted</code>, <code>stateSelected</code>, or <code>stateDisabled</code></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Required</td>
</tr>
<tr>
	<td style="text-align:center;"><code>bitmap</code></td>
	<td style="text-align:left;">A bitmap resource in the layout drawn at the Selectable / Button origin</td>
	<td style="text-align:left;">WatchUi.Bitmap objects</td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Required or <code>color</code> must be specified</td>
</tr>
<tr>
	<td style="text-align:center;"><code>color</code></td>
	<td style="text-align:left;">A color fill applied to the Selectable / Button region</td>
	<td style="text-align:left;"><code>Graphics</code> color constant or a 24-bit integer of the form <code>0xRRGGBB</code></td>
	<td style="text-align:left;"><code>Gfx.COLOR_TRANSPARENT</code></td>
	<td style="text-align:left;">Required or <code>bitmap</code> must be specified</td>
</tr>
</tbody>
</table>

<p>An example layout containing two a menu and back button:</p>

<pre><code class="xml">&lt;layout id=&quot;ButtonLayout&quot;&gt;
    &lt;button x=&quot;40&quot; y=&quot;center&quot; width=&quot;50&quot; height=&quot;50&quot; background=&quot;Gfx.COLOR_BLACK&quot; behavior=&quot;onBack&quot;&gt;
        &lt;state id=&quot;stateDefault&quot; bitmap=&quot;@Drawables.DefaultBackButton&quot; /&gt;
        &lt;state id=&quot;stateHighlighted&quot; bitmap=&quot;@Drawables.PressedBackButton&quot; /&gt;
        &lt;state id=&quot;stateSelected&quot; bitmap=&quot;@Drawables.PressedBackButton&quot; /&gt;
        &lt;state id=&quot;stateDisabled&quot; color=&quot;Gfx.COLOR_BLACK&quot; /&gt;
    &lt;/button&gt;
    &lt;button x=&quot;115&quot; y=&quot;center&quot; width=&quot;50&quot; height=&quot;50&quot;&gt;
        &lt;state id=&quot;stateDefault&quot; bitmap=&quot;@Drawables.DefaultMenuButton&quot; /&gt;
        &lt;state id=&quot;stateHighlighted&quot; bitmap=&quot;@Drawables.PressedMenuButton&quot; /&gt;
        &lt;state id=&quot;stateSelected&quot; bitmap=&quot;@Drawables.PressedMenuButton&quot; /&gt;
        &lt;state id=&quot;stateDisabled&quot; color=&quot;Gfx.COLOR_BLACK&quot; /&gt;
        &lt;param name=&quot;background&quot;&gt;Gfx.COLOR_BLACK&lt;/param&gt;
        &lt;param name=&quot;behavior&quot;&gt;onMenu&lt;/param&gt;
    &lt;/button&gt;
&lt;/layout&gt;
</code></pre>

<h1 id="positioningandsensors">Positioning and Sensors</h1>
<figure>
<img src="resources/programmers-guide/archy-monkey.png" style="max-width:300px;" title="Geocache Jones remembered to stop at three movies." />
</figure>

<p>Monkey C provides access to the wearable&#8217;s available sensors, which may include the GPS, altimeter, thermometer, and supported ANT sensors.</p>

<h2 id="location">Location</h2>

<p>A <code>Location</code> is an abstraction of a coordinate. It exposes the ability to retrieve the coordinates in radians or decimal degrees and then provides a method to convert to coordinate formats supported by the Garmin system. The <code>Position</code> module also exposes string parsing interface to convert from various coordinate formats to a <code>Location</code> object.</p>
<!-- TODO: Talk about the difference between a position and a location -->

<pre><code class="java">// The GEO enum is used to retrieve coordinates in various String representations.
enum
{
    GEO_DEG,    // Degree Format, ddd.dddddd: 38.278652
    GEO_DM,     // Degree/Minute Format, dddmm.mmm: 38 27.865'
    GEO_DMS,    // Degree/Minute/Seconds Format, dddmmss: 38 27' 8&quot;
    GEO_MGRS    // Military Grid Reference System (MGRS): 4QFJ12345678
}

// The Location object represents a position. It provides accessor
// methods for retrieving the coordinates in various formats.
class Location
{
    // Constructor: create a coordinate based off an options hash table
    // @param [Dictionary] options Hash table of options
    // @option options [Number] :latitude The latitude
    // @option options [Number] :longitude The longitude
    // @option options [Symbol] :format The format of lat/long (possible
    //        values are :degrees, :radians, or :semicircles)
    function initialize( options );

    // Use toDegrees() to retrieve the coordinate back as an Array of degree values.
    // @return [Array] An Array of the latitude and the longitude in degree format
    function toDegrees();

    // Use toRadians() to retrieve the coordinate back as an Array of radian values.
    // @return [Array] An Array of the latitude and the longitude in radian format
    function toRadians();

    // Use toGeoString() to get a String representation of the coordinate.
    // @param format Coordinate format to which coordinate should be
    //      converted (GEO constant)
    // @return [String] Formatted coordinate String
    function toGeoString( format );
}
</code></pre>

<h2 id="locationevents">Location Events</h2>

<p>To enable the GPS call the <code>enableLocationEvents()</code> method. The parameters are outlined below:</p>

<pre><code class="java">enum
{
    LOCATION_ONE_SHOT,      // One-time retrieval of Location
    LOCATION_CONTINUOUS,    // Register for Location updates
    LOCATION_DISABLE        // Unregister for Location updates
}

// Request a location event with enableLocationEvents().
// @param type LOCATION_ONE_SHOT for a single location request,
//       LOCATION_CONTINUOUS to enable location tracking, and
//       LOCATION_DISABLE to turn off location tracking
// @param [Method] listener Method object to call with location updates
function enableLocationEvents( type, listener );
</code></pre>

<p>To register a position listener, use the <code>method()</code> call to create a <code>Method</code> callback:</p>

<pre><code class="java">function onPosition( info ) {
    Sys.println( &quot;Position &quot; + info.position.toGeoString( Position.GEO_DM ) );
}

function initializeListener() {
    Position.enableLocationEvents( Position.LOCATION_CONTINUOUS, method( :onPosition ) );
}
</code></pre>

<p>All of the location information will be sent in an <code>Info</code> object:</p>

<pre><code class="java">// The Location.Info class contains all information necessary for the Location.
// It can be passed on the update or it can be retrieved on demand.
class Info
{
    var position;   // Lat/lon
    var speed;      // Speed in meters per second
    var altitude;   // Altitude in meters, mean sea level
    var accuracy;   // Accuracy - good, usable, poor, not available
    var heading;    // Heading in radians
    var when;       // Moment Object: GPS time stamp of fix
}

// Use getInfo() to retrieve the current Location.Info
// @return [Location.Info] The Info object containing the current information
function getInfo();
</code></pre>

<h2 id="sensors">Sensors</h2>

<p>The <code>Sensor</code> module allows the app to enable and receive information from Garmin ANT+ sensors. To receive information, a listener method must be assigned and the sensors enabled:</p>

<pre><code class="java">function initialize() {
    Sensor.setEnabledSensors( [Sensor.SENSOR_HEARTRATE] );
    Sensor.enableSensorEvents( method( :onSensor ) );
}

function onSensor(sensorInfo) {
    System.println( &quot;Heart Rate: &quot; + sensorInfo.heartRate );
}
</code></pre>

<p>Sensor information is packaged in the <code>Sensor.Info</code> object:</p>

<pre><code class="java">// The Sensor.Info class contains all information necessary for the Sensor.
// It can be passed on the update or it can be retrieved on demand.
class Info
{
    var speed;          // Speed in meters per second
    var cadence;        // Cadence in revolutions per minute
    var heartRate;      // HR in beats per minute
    var temperature;    // Temperature in degrees Centigrade
    var altitude;       // Altitude in meters
    var pressure;       // Pressure in Pa
    var heading;        // Heading in Radians
}
</code></pre>

<p>The simulator can simulate sensor data via the <em>Simulation</em> menu by selecting <em>Fit Data</em> &gt; <em>Simulate Data</em>. This generates valid but random values that can be read in via the sensor interface. For more acuate simulation, the simulator can play back a FIT file and feed the input into the <code>Sensor</code> module. To do this, select <em>Simulation</em> &gt; <em>Fit Data</em> &gt; <em>Playback File</em> and choose a FIT file from the dialog.</p>

<h2 id="sensorhistory2.1">Sensor History (2.1)</h2>

<p>The <code>SensorHistory</code> module allows the app to access saved sensor history on the device. Data from sensors can be accessed by getting an iterator.</p>

<pre><code class="java">function getHeartRateHistory(options);
function getTemperatureHistory(options);
function getPressureHistory(options);
function getElevationHistory(options);
</code></pre>

<p>All Sensor History types are not available on all devices. Capabilities should be validated using the &#8216;has&#8217; operator. The get functions will return a SensorHistoryIterator type.</p>

<pre><code class="java">class SensorHistoryIterator {
    function next();
    function getMax();
    function getMin();
    function getNewestSampleTime();
    function getOldestSampleTime();
}
</code></pre>

<p>Calling the next() function will iterate through the history values until the end of the data is reached. When there is no more data the iterator will return null. This function returns a <code>SensorSample</code>:</p>

<pre><code class="java">class SensorSample {

    var data; // Sample data. Can be null if not valuid
    var when; // The time this sample occurred
}
</code></pre>

<p>The iterator can be adjusted to provide the newest data values first or the oldest values first by using the enumeration values <code>ORDER_NEWEST_FIRST</code> and <code>ORDER_OLDEST_FIRST</code></p>

<h2 id="fitfilerecording">Fit File Recording</h2>

<p>Imagine you are trying to create a Yoga app. You&#8217;d like the app to record heart rate and calories burned during your Yoga workout, just like other Garmin apps. You&#8217;d also like the recording to be represented on <a href="http://connect.garmin.com" title="Visit Garmin Connect">Garmin Connect</a>. Monkey C allows for apps to start and stop recording of FIT files. Controlling the FIT file recording requires a few steps:</p>

<ol>
<li>Enable the sensors to be recorded</li>
<li>Use <code>Fit.createSession(options)</code> to create a session object</li>
<li>Use the <code>start()</code> method of the FIT session to begin recording. Data from the enabled sensors will be recorded into the FIT file.</li>
<li>Use <code>stop()</code> to pause the recording</li>
<li>Use <code>save()</code> to save the recording, or <code>discard()</code> to delete the recording</li>
</ol>

<p>The FIT file will sync with <a href="http://connect.garmin.com" title="Visit Garmin Connect">Garmin Connect</a>. You can use the <a href="http://developer.garmin.com/garmin-connect-api/overview/" title="Find out more about the Garmin Connect API">Garmin Connect API</a> to process the FIT file from a web service.</p>

<h3 id="recordingfitfilesciq1.3">Recording FIT Files (CIQ 1.3)</h3>

<p>In addition to being able to play back existing FIT files, the simulator can also record files using data obtained via the <em>Fit Data</em>&gt;<em>Simulate Data</em> menu option. To begin recording a session you must start the timer; this can be done via the <em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Start Activity</em> menu option, or by clicking the corresponding start button on the device you have selected. The following table describes the different options available for activity recording and provides instructions for how to access them via the menu bar, or the device buttons (where available).</p>

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Option</th>
	<th style="text-align:left;">Menu Button</th>
	<th style="text-align:left;">Device Button</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">Start Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Start Activity</em></td>
	<td style="text-align:left;">Start Button</td>
	<td style="text-align:left;">The device start button starts and stops an activity.</td>
</tr>
<tr>
	<td style="text-align:left;">Stop Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Stop Activity</em></td>
	<td style="text-align:left;">Start Button</td>
	<td style="text-align:left;">The device start button starts and stops an activity, and the <em>Start Activity</em> menu item is renamed to <em>Stop Activity</em> when recording is active.</td>
</tr>
<tr>
	<td style="text-align:left;">Lap Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Lap Activity</em></td>
	<td style="text-align:left;">Back Button</td>
	<td style="text-align:left;">Records a lap record in the FIT file.</td>
</tr>
<tr>
	<td style="text-align:left;">Pause Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Pause Activity</em></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Pauses activity recording. Note this option is only available when FIT data simulation is enabled.</td>
</tr>
<tr>
	<td style="text-align:left;">Resume Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Resume Activity</em></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Resumes activity recording. Note this option is only available when FIT data simulation is enabled and activity recording is paused.</td>
</tr>
<tr>
	<td style="text-align:left;">Discard Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Discard Activity</em></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Discards the current recording and deletes the corresponding .fit file. Note this is only enabled if activity recording has been started and subsequently stopped.</td>
</tr>
<tr>
	<td style="text-align:left;">Save Activity</td>
	<td style="text-align:left;"><em>Data Fields</em>&gt;<em>Timer</em>&gt;<em>Save Activity</em></td>
	<td style="text-align:left;">N/A</td>
	<td style="text-align:left;">Saves the recorded activity into a .fit file and resets the timer state. Note this is only enabled if activity recording has been started and subsequently stopped.</td>
</tr>
</tbody>
</table>

<p>Note: the device simulator will not automatically start activity recording when a data field is being run. You must excplitily start and stop activity recording via the menu options described here.</p>

<h3 id="fitdeveloperfieldsciq1.3">FIT Developer Fields (CIQ 1.3)</h3>

<p>Now imagine you want to add a new metric - Namastes - to the Yoga app<a href="#fn:6" id="fnref:6" title="see footnote" class="footnote">[6]</a>. This metric will combine heart rate, accelerometer, and other sensor data into a single value, and does not have an analog in any Garmin recording metric. To do this we need the <code>FitContributor</code> API, which allows you to add new metrics to a FIT recording and display it on <a href="http://connect.garmin.com" title="Visit Garmin Connect">Garmin Connect</a>.</p>

<p>First, you must enable the <code>FitContributor</code> permission in the manifest file. Next, you need to add your field definitions in your resources using the <code>fitContributions</code> block:</p>

<pre><code class="xml">    &lt;strings&gt;
        &lt;string id=&quot;namaste_label&quot;&gt;Namastes&lt;/string&gt;
        &lt;string id=&quot;namaste_graph_label&quot;&gt;Namastes&lt;/string&gt;
        &lt;string id=&quot;namaste_units&quot;&gt;N(s)&lt;/string&gt;
    &lt;/strings&gt;
    &lt;fitContributions&gt;
        &lt;fitField id=&quot;0&quot; displayInChart=&quot;true&quot; sortOrder = &quot;0&quot; precision=&quot;2&quot;
        chartTitle=&quot;@Strings.namaste_graph_label&quot; dataLabel=&quot;@Strings.namaste_label&quot;
        unitLabel=&quot;@Strings.namaste_units&quot; fillColor=&quot;#FF0000&quot; /&gt;
    &lt;/fitContributions&gt;
</code></pre>

<p>The <code>fitField</code> block has a number of configurable options:</p>

<table>
<colgroup>
<col style="text-align:center;"/>
<col style="text-align:left;"/>
<col style="text-align:left;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:center;">Attribute</th>
	<th style="text-align:left;">Value</th>
	<th style="text-align:left;">Notes</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:center;"><code>id</code></td>
	<td style="text-align:left;">A numeric value from 0 to 255 used to refer to your field</td>
	<td style="text-align:left;">No duplicates within an app are allowed</td>
</tr>
<tr>
	<td style="text-align:center;"><code>displayInChart</code></td>
	<td style="text-align:left;">Indicates whether or not record level connect IQ data should be rendered in a chart</td>
	<td style="text-align:left;"><code>true</code> if you want this entry to be displayed as a chart, <code>false</code> otherwise. Graph fields can only support numeric data.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>displayInActivityLaps</code></td>
	<td style="text-align:left;">Indicates whether or not lap level connect IQ data should be rendered in the Activity Laps section in the Garmin Connect Activity Details page</td>
	<td style="text-align:left;"><code>true</code> if you want this entry to be displayed in the activity laps, <code>false</code> otherwise</td>
</tr>
<tr>
	<td style="text-align:center;"><code>displayInActivitySummary</code></td>
	<td style="text-align:left;">Indicates whether or not activity (fit session) level connect IQ data should be rendered in the Activity Summary section in the Garmin Connect Activity Details page</td>
	<td style="text-align:left;"><code>true</code> if you want this entry to be displayed in the activity summary data, <code>false</code> otherwise</td>
</tr>
<tr>
	<td style="text-align:center;"><code>sortOrder</code></td>
	<td style="text-align:left;">Determines the order in which the Connect IQ data will appear in the Summary or Lap Sections of the Activity Details page and what order charts will be displayed on the Activity Details page</td>
	<td style="text-align:left;">No duplicates are allowed</td>
</tr>
<tr>
	<td style="text-align:center;"><code>precision</code></td>
	<td style="text-align:left;">Decimal point precision for numeric data</td>
	<td style="text-align:left;">0 for integer, 1 for one decimal point, 2 for two decimal points. Without this attribute the default is no rounding</td>
</tr>
<tr>
	<td style="text-align:center;"><code>chartTitle</code></td>
	<td style="text-align:left;">This is the resources string key to use to render the title of the chart</td>
	<td style="text-align:left;">Optional if <code>displayInChart</code> is <code>false</code>. Must be a string resource.</td>
</tr>
<tr>
	<td style="text-align:center;"><code>dataLabel</code></td>
	<td style="text-align:left;">This is the resources string key to use to render the label of the data field in the Activity Summary or Activity Laps section of the Activity Details page (ex. Cadence, or Heart Rate).</td>
	<td style="text-align:left;">Must be a string resource</td>
</tr>
<tr>
	<td style="text-align:center;"><code>unitLabel</code></td>
	<td style="text-align:left;">This is the key to use to render the unit of the data field in the Activity Summary or Activity Laps section of the Activity Details page (ex. kph, or miles).</td>
	<td style="text-align:left;">Must be a string resource</td>
</tr>
<tr>
	<td style="text-align:center;"><code>fillColor</code></td>
	<td style="text-align:left;">RRGGBB value of color to use for chart</td>
	<td style="text-align:left;">Optional if <code>displayInChart</code> is <code>false</code></td>
</tr>
</tbody>
</table>

<p>This will communicate the metadata to display our chart to <a href="http://connect.garmin.com" title="Visit Garmin Connect">Garmin Connect</a>. Now we need to create our Field in the code. You do this by using the <code>createField</code> method of the <code>Session</code> object within your source:</p>

<pre><code class="java">// Field ID from resources.
const NAMASTE_FIELD_ID = 0;
hidden var mNamasteField;

// Initializes the new Namaste field in the activity file
function setupField(session) {
    // Create a new field in the session.
    // Current namastes provides an file internal definition of the field
    // Field id _must_ match the fitField id in resources or your data will not display!
    // The field type specifies the kind of data we are going to store. For Record data this must be numeric, for others it can also be a string.
    // The mesgType allows us to say what kind of FIT record we are writing.
    //    FitContributor.MESG_TYPE_RECORD for graph information
    //    FitContributor.MESG_TYPE_LAP for lap information
    //    FitContributor.MESG_TYPE_SESSION` for summary information.
    // Units provides a file internal units field.
    mNamasteField = session.createField(&quot;current_namastes&quot;, NAMASTE_FIELD_ID, FitContributor.DATA_TYPE_FLOAT, { :mesgType=&gt;Fit.MESG_TYPE_RECORD, :units=&gt;&quot;N&quot; });
}
</code></pre>

<p>Now when you call <code>setData</code> on <code>mNamasteField</code> the value will be recorded into either the Record, Lap, or Session information of the FIT file based on the message type specified when calling <code>createField</code>. If you are creating a Record (graph), you should update this value once a second. For lap and summary, you should provide constant updates to the current lap or workout value for the metric.</p>

<p>After setting this all up, you will want to preview how this will look on <a href="http://connect.garmin.com" title="Visit Garmin Connect">Garmin Connect</a>. We can use the monkeygraph tool to create a preview. You can start the monkeygraph tool with following from the command line:</p>

<pre><code class="bash">$ monkeygraph
</code></pre>

<p>The monkeygraph tool requires the following: a FIT file with the recorded developer data, and an IQ file of the app. The tool will allow you to test how charts will look before uploading your app for review.</p>

<h2 id="communicatingwithantantsensors">Communicating With ANT/ANT+ Sensors</h2>

<h3 id="genericantchannels">Generic ANT channels</h3>

<p>Connect IQ provides a low level interface for communication with ANT and ANT+ sensors. With this interface, an ANT channel can be created to send and receive ANT packets. The MO2Display sample provides a sample application that implements the Muscle Oxygen ANT profile. The ANT Generic interface is not available to watch faces. Low and High priority search timeout for sensors differs from the basic ANT radio specification to allow for interoperation with native ANT behavior on devices. These are limited to a maximum timeout of 30 seconds and 5 seconds respectively.</p>

<h4 id="burstdataciq2.2">Burst Data (CIQ 2.2)</h4>

<p>Burst data transmission provides a mechanism for large amounts of data to be sent between devices over an ANT Generic Channel. Developers are notified through a listener of the success/failure of burst transmit/receive events. Burst data transmission is limited to up to 8Kb of data at a time.</p>

<p>Common use cases for this include passkey authentication or sending/receiving configuration data between devices.</p>

<p>The GenericChannelBurst sample provides a demonstration of transmitting and receiving burst data.</p>

<h3 id="antprofilesciq2.2">ANT+ Profiles (CIQ 2.2)</h3>

<p>The <code>AntPlus</code> module allows access to information about ANT+ sensors that are paired to a user&#8217;s device without requiring you to set up and manage the ANT channel yourself. All management of ANT+ sensors such as adding, removing, enabling, disabling, and calibrating is managed by the user via the device&#8217;s regular sensor menus.</p>

<p>An extension of a sensor-specific listener is passed into the constructor for a sensor-specific extension of <code>Device</code>. If there is a sensor of the given type paired to the user&#8217;s device, information about that sensor can be retrieved using the sensor-specific getters, or through the common data getters such as <code>GetBatteryStatus(identifier)</code>. Null can be passed in as the identifier for sensor types (like most) that do not support multi-components.</p>

<p>Callbacks in the <code>DeviceListener</code> and extensions of it will be called automatically if a sensor of the given type is paired and the corresponding information is updated via ANT. For example, <code>onDeviceStateUpdate()</code> will be called if a sensor&#8217;s ANT channel goes from connected to searching, or if the user switches the sensor ID of a given type that their device is connected to. Callbacks like <code>onCalculatedPowerUpdate()</code> will be called when new pieces of information about a power sensor are received via ANT.</p>

<p>Certain ANT+ sensors, such as bike lights, have special callbacks. For example, the <code>onLightNetworkStateUpdate()</code> callback should be used to understand the light network&#8217;s state rather than <code>onDeviceStateUpdate()</code>. The <code>LightNetwork</code> class will allow you to make changes to bike light modes, given there are bike lights paired to the user&#8217;s device and a light network is fully formed.</p>

<p>Not all ANT+ profiles provisioned by Monkey C will be supported by every Connect IQ-compatible device.</p>

<h1 id="communication">Communication</h1>
<figure>
<img src="resources/programmers-guide/string-monkey.png" style="max-width:300px;" title="I am getting a StringNotTautException." />
</figure>

<p>Widgets and apps can communicate with a mobile phone via <a href="https://en.wikipedia.org/wiki/Bluetooth_low_energy" title="Bluetooth low energy">Bluetooth Low Energy</a> (BLE). The mobile phone may be sharing data with the device, or it may act as a bridge between the app and the Internet. This allows the mobile phone to become part of the wearable web.</p>

<p>There are a few complications with device-to-phone communication. For example, the watch app may be killed during the time communication happens, or a phone app may try to send information while the app is not active. In order to simplify these cases for the developer, Monkey C does not expose a low-level interface, but instead exposes a very high-level approach: the API exposes a mailbox metaphor instead of using a socket metaphor. Messages are constructed as a parcel of information and sent back and forth between devices. Each app will have a mailbox where messages are received, and an event that fires when new messages arrive.</p>

<p>There will also be a high-level interface for making JSON and image requests. This will allow developers the option of developing a wearable web app without having to write their own companion phone app.</p>

<h2 id="approaches">Approaches</h2>

<p>Monkey C exposes two approaches for communicating with the mobile phone: Garmin Connect Mobile and Direct Messaging.</p>

<h3 id="garminconnectmobile">Garmin Connect Mobile</h3>

<p>Monkey C exposes a high level APIs to allow calls to basic web services through Garmin Connect Mobile:</p>

<pre><code class="java">module Communications
{
    //! To use Garmin Connect Mobile as a proxy to the web, use makeWebRequest().
    //! The request is asynchronous; the responseCallback will be called when the request returns.
    //! @param [String] url The URL being requested
    //! @param [Dictionary] parameters Dictionary of keys and values, appended to the URL as a GET request or set as the body for a POST request. These values
    //!                                should not be URL encoded. Can be null.
    //! @param [Dictionary] options Dictionary of options. Can be null.
    //! @option options [Number] :method The HTTP method of the request. Should be a HTTP_REQUEST_METHOD_* value.
    //! @option options [Dictionary] :headers A Dictionary of HTTP headers to include in the request. The &quot;Content-Type&quot;
    //!                                       header can be specified using a REQUEST_CONTENT_TYPE_* value. If the content
    //!                                       type is not specified, it will default to &quot;application/json&quot; for GET and
    //!                                       DELETE requests, and will default to &quot;application/x-www-form-urlencoded&quot; for
    //!                                       POST and PUT requests.
    //! @option options [Number] :responseType The format of the response. Should be a HTTP_RESPONSE_CONTENT_TYPE_* value. If not given, the system will attempt
    //!                                        to first parse the response as JSON, then as URL ENCODED.
    //! @param [Method] responseCallback This is a callback in the format function responseCallback(responseCode, data);
    //!                                  responseCode has the server response code or a BLE_* error type, and data contains a Dictionary of content if the request was successful.
    //! @since 1.3.0
    function makeWebRequest( url, parameters, options, responseCallback );

    // These are the supported HTTP methods
    enum {
        HTTP_REQUEST_METHOD_GET = 1,
        HTTP_REQUEST_METHOD_PUT = 2,
        HTTP_REQUEST_METHOD_POST = 3,
        HTTP_REQUEST_METHOD_DELETE = 4
    }

    //! The expected response from making a web request
    enum {
        //! @since 1.3.0
        HTTP_RESPONSE_CONTENT_TYPE_JSON = 0,
        //! @since 1.3.0
        HTTP_RESPONSE_CONTENT_TYPE_URL_ENCODED,
        //! @since 2.2.0
        HTTP_RESPONSE_CONTENT_TYPE_GPX,
        //! @since 2.2.0
        HTTP_RESPONSE_CONTENT_TYPE_FIT
    }

    //! To request an image through Garmin Connect Mobile, call makeImageRequest(). GCM
    //! will scale and dither the image based on the capabilities of the device, but
    //! the user will be able to pass additional options (like dithering it down to a
    //! one color image)
    //! @param [String] url URL of image to request
    //! @param [Dictionary] parameters Dictionary of keys and values, appended to the URL. Can be null.
    //! @param [Dictionary] options Additional image options
    //! @option options [Array] :palette The color palette to restrict the image dithering to. Using a smaller palette can reduce the size of the image data to speed up transfers.
    //! @option options [Number] :maxWidth The maximum width an image should be scaled to
    //! @option options [Number] :maxHeight The maximum height an image should be scaled to
    //! @option options [Number] :dithering The type of dithering to use when processing the image. Defaults to Floyd-Steinberg.
    //! @param [Method] responseCallback This is a callback in the format function responseCallback(responseCode, data);
    //!      responseCode has the server response code, and data contains a WatchUi.BitmapResource if it was successful.
    //! @since 1.2.0
    function makeImageRequest( url, parameters, options, responseCallback );

    enum
    {
        IMAGE_DITHERING_NONE = 1,
        IMAGE_DITHERING_FLOYD_STEINBERG = 2
    }
}
</code></pre>

<p>These APIs expose JSON requests and image requests as very straightforward APIs for making REST API calls. The JSON calls are converted to serialized Monkey C data and sent across the BLE pipe.</p>

<p>Note: The original HTTP method <code>makeJsonRequest</code> has been deprecated in Connect IQ 1.3.</p>

<h4 id="authenticationciq1.3">Authentication (CIQ 1.3)</h4>

<p>Many web services require the user to log in in order to provide API access. This log in step requires a handoff to an authorization endpoint for credential entry. Upon successful entry, the authorization endpoint redirects to the caller with the proper tokens to enable API calls.</p>

<p>Credential entry can be difficult on devices with limited input. Rather than add a web browser to the wearable<a href="#fn:7" id="fnref:7" title="see footnote" class="footnote">[7]</a>, Connect IQ provides a mechanism to hand off credential entry to the phone.</p>

<pre><code class="java">module Communications
{
    //! Request an OAuth sign-in on Garmin Connect Mobile. A notification will trigger on the phone, that when clicked,
    //! provides a webview that shows initialUrl. If the user grants permission to the app the function given to
    //! registerForOAuthMessages() will be called with a Dictionary of keys from the OAuth process.
    //! @param [String] requestUrl The URL to load in the web view to begin authentication.
    //! @param [Dictionary] requestParams A dictionary of non-URL encoded parameters for the initial url.
    //! @param [String] resultUrl The URL of the final page of authentication that contains the resultKeys.
    //! @param [Number] resultType What format the result will be in. Should be a OAUTH_RESULT_TYPE_XXX value.
    //! @param [Dictionary] resultKeys A dictionary of the keys Garmin Connect Mobile will need to pull out of the OAuth response and given to the
    //!                     registered callback in registerForOAuthMessages().
    //! @since 1.3.0
    function makeOAuthRequest(requestUrl, requestParams, resultUrl, resultType, resultKeys);

    //! Register a callback for receiving OAuth messages. The callback will be called once for
    //! each received OAuth message. If there are messages waiting for the app when this
    //! function is called, the callback will immediately be called once for each
    //! waiting message.
    //! @param method [Method] The callback with the signature callback(data). data will be of
    //!                        type OAuthMessage
    //! @since 1.3.0
    function registerForOAuthMessages(method);
}
</code></pre>

<p>The <code>makeOAuthRequest</code> call is intended for implementing credential entry. When called, the user will receive a phone notification that your app wants to log into a web service. Clicking on this notification will take the user to a web view within Garmin Connect Mobile, where they can enter their log in information. During this time, the device should display a page directing the user to open Garmin Connect Mobile. Connect Mobile will send back the tokens specified in the <code>resultKeys</code> option.</p>

<p>Your app should call <code>registerForOAuthMessages</code> to receive the result of the log in process. Logging in can take a long time, and a widget may time out before the user completes the log in step. If your app closes before the log in process completes, the result will be cached on the device until the next time your app calls <code>registerForOAuthMessages</code>, at which point the result will be passed to your callback immediately.</p>

<h4 id="directinguserstowebcontentciq1.3">Directing Users to Web Content (CIQ 1.3)</h4>

<p>The <code>openWebPage</code> call can be used to direct the user to a specific web page on the phone. When called, the specified web page should be fetched and displayed in the phones default browser. There is no callback for this function and the watch app has no method for checking if the call was completed on the phone successfully.</p>

<pre><code class="java">module Communications
{
    //! Request that GCM issue a phone notification that will open a web page.
    //! @param url [String] The URL to open.
    //! @param params [Dictionary] The request parameters. Parameters should not be URL encoded.
    //! @param options [Dictionary] Additional options for the request. (TBD)
    //! @since 1.3.0
    function openWebPage(url, params, options);
}
</code></pre>

<h4 id="downloadablecontent2.2">Downloadable Content (2.2)</h4>

<p>The makeWebRequest API has additional expected response types for GPX and FIT files. These new content types can be used to download GPX or FIT files containing Waypoints, Workouts, Courses, Tracks, or Routes to the device. When files are downloaded to the device, the elements in that file will be added to the system storage for their respective types (see <a href="#persistedcontent2.2">Persisted Content</a>).</p>

<p>There are three possible cases once the content is sent to the device:</p>

<ol>
<li><strong>Data import is successful</strong> - A <code>PersistedContent.Iterator</code> will be returned, which contains the elements that were downloaded.</li>
<li><strong>The system does not have enough space</strong> - The <code>STORAGE_FULL</code> response will be returned to the <code>responseCallback</code>.</li>
<li><strong>The system does not support the file type</strong> (i.e. a running workout is sent to a cycling device) - The <code>responseCallback</code> will return an empty iterator or <code>null</code> value.</li>
</ol>

<h3 id="directmessaging">Direct Messaging</h3>

<p>Some watch apps will want to communicate directly with a phone app instead of routing through Garmin Connect Mobile. For these cases Monkey C exposes a concept of a mailbox. Each app will have its own mailbox that it can retrieve messages from and it can subscribe to an event that fires when a new message comes in.</p>

<pre><code class="java">//! The MailboxIterator is used to get the messages out of the Mailbox.
class MailboxIterator
{
    //! Call next() to get the next message from the mailbox.
    //! @return Message content, or null if no messages
    function next();
}

//! Call getMailbox() to get the MailboxIterator for this App's mailbox.
//! @return [MailboxIterator] Iterator for the mailbox
function getMailbox();

//! Add a listener for mailbox events.  The listener method is called whenever a
//! new message is received
//! @param [Method] listener Callback in the format function listener(iterator).
//!       iterator is the mailbox iterator for the app.
function setMailboxListener( listener );

//! To clear the contents of the mailbox, call emptyMailbox().
function emptyMailbox();

//! Send data across the the BLE link.
//! @param [Object] The object to be sent
//! @param [Dictionary] options Additional transmit options (TBD)
//! @param [ConnectionListener] listener An extension of the
//!       ConnectionListener class.
function transmit( content, options, listener );

//! Listener class for transmit
class ConnectionListener
{
    //! Callback when a communications operation error occurs.
    function onError();

    //! Callback when a communications operation completes.
    function onComplete();
}
</code></pre>

<h2 id="persistedcontent2.2">Persisted Content (2.2)</h2>

<p>The <code>PersistedContent</code> module allows access to the saved Tracks, Courses, Waypoints, Workouts, and Routes that the user has on their device. These content types contain a name and a unique identifier, which can be used by <code>System.exitTo()</code> as an <code>Intent</code> to launch into a native app and present the content to the user in some way. See the <a href="#intents2.2">Intents</a> section for more details about <code>Intents</code>.</p>

<p>Calling <code>System.exitTo()</code> with a <code>PersistedContent</code> object prompts the user to choose which native app to launch. For example, if an app calls <code>System.exitTo()</code> with a <code>PersistedContent.Waypoint</code> object, the dialog will ask whether to launch the waypoint with one of either the Run or Bike native apps.</p>

<p>When retreiving the list of stored content on the device, a <code>PersistedContent.Iterator</code> will be returned. The <code>next()</code> function must be called to get the first entry, and <code>null</code> is returned when there are no more entries:</p>

<pre><code class="java">// This will launch the first waypooint stored on the device
using Toybox.PersistedContent as Content;
using Toybox.System as Sys;

var waypoints = Content.getWaypoints();
var waypoint = routes.next();

if(waypoint != null) {
    Sys.exitTo(waypoint.toIntent());
}
</code></pre>

<p>Access to <code>PersistedContent</code> requires the &#8216;Persisted Content&#8217; permission.</p>

<h3 id="persistedcontentinthesimulator">Persisted Content in the Simulator</h3>

<p>Because native apps are not simulated in Connect IQ simulator, an <em>Intent Launched</em> feature has been added that is useful for testing with <code>PersistedContent</code>. This feature displays three critical pieces of information about the <code>PersistedContent</code> object supplied via <code>Intent</code> in the simulator window:</p>

<ol>
<li>The object type</li>
<li>The unique serializable ID of the object</li>
<li>The name of the object</li>
</ol>

<p>For example, the sample code above may display a picture of an activity with &#8220;Intent Launched&#8221;, a type, and ID number, and its Name displayed.</p>
<figure>
<img src="resources/programmers-guide/intent-launched.png" style="max-width:635px;" title="Launched Intent in the Simulator" />
</figure>

<h2 id="mobilesdkdownloads">Mobile SDK Downloads</h2>

<p>The Connect IQ Mobile SDKs are released separately from the Connect IQ Developer SDK and is available for iOS and Android. There are several editions of the Mobile SDK available:</p>

<ul>
<li>Android BLE</li>
<li>iOS BLE</li>
<li>Android ADB</li>
</ul>

<p>The <a href="https://en.wikipedia.org/wiki/Bluetooth_low_energy" title="Bluetooth low energy">BLE</a> edition supports development of communication-enabled applications on an iOS or Android target device while the <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">Android Debug Bridge</a> (ADB) edition is used for testing with the Connect IQ Simulator.</p>

<p>More information on how to download the correct version for your mobile platform may be found on the <a href="http://developer.garmin.com/connect-iq/developer-tools/communication">Garmin Developer site</a>.</p>

<h2 id="blesimulationoverandroiddebugbridge">BLE Simulation Over Android Debug Bridge</h2>

<p>When using the Connect IQ Simulator, it is possible to communicate with a companion app running on an Android device using <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">ADB</a>. This will simulate actual <a href="https://en.wikipedia.org/wiki/Bluetooth_low_energy" title="Bluetooth low energy">BLE</a> speeds to better approximate performance of your application.</p>

<p>The <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">ADB</a> edition of the Android Mobile SDK and companion app is required to use <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">ADB</a> for testing. Here&#8217;s how to enable the companion to communicate over <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">ADB</a>:</p>

<ol>
<li>Connect the phone to the PC running the simulator via USB</li>
<li>Have USB debugging enabled on the Android handset</li>
<li>Obtain an instance of ConnectIQ using <code>getInstance( IQCommProtocol.ADB_SIMULATOR )</code></li>
<li>Optionally call <code>setAdbPort( int port )</code> to set a specific port to use for communication (the default port is 7381)</li>
<li>Call <code>initialize()</code></li>
</ol>

<p>To allow the simulator to communicate over <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">ADB</a>, forward the TCP port to the Android device in a terminal or console:</p>

<pre><code class="bash">adb forward tcp:7381 tcp:7381
</code></pre>

<p>Note that this command will need to be reissued for each connected Android device, or if a device is disconnected and re-connected.</p>

<p>Once your app is started on the phone, connect it to the simulator by clicking the <em>Connection</em> menu and selecting <em>Start</em> (CTRL-F1). The Connect IQ apps in the simulator will now be able to communicate with your device via the Communications APIs over <a href="http://developer.android.com/tools/help/adb.html" title="Android Debug Bridge">ADB</a>.</p>

<h1 id="dynamicdatafields">Dynamic Data Fields</h1>
<figure>
<img src="resources/programmers-guide/cyclist-monkey.png" style="max-width:300px;" title="He's going for top banana." />
</figure>

<p>Dynamic Data Fields allow customers and third party developers to write data fields for Garmin activities. The goal is to make a system that not only makes it easy for a user to make a quick data field based off our workout data, but gives the developer the the power to customize the presentation.</p>

<h2 id="datafieldandsimpledatafield">Datafield and SimpleDataField</h2>

<p>The base class for data fields is <code>WatchUi.DataField</code>. This class extends <code>WatchUi.View</code>, and in many ways behaves similarly to other <code>WatchUi</code> View objects. The <code>onUpdate()</code> method call will be made every time the watch needs to update.</p>

<p>In Garmin activities, the user controls the data page layout; specifically, whether it displays one, two, three, or more fields. The Connect IQ data field must handle displaying in all of those layouts, and the developer can use the simulator to test their field in all layouts supported by devices.</p>

<p>Many developers will only want to display a single value and not want to handle all the complexity of the drawing of a data field. In those instances, they can use a <code>SimpleDataField</code> object. A simple data field handles the drawing of the field in multiple sizes, and only requires the developer to implement a <code>compute()</code> method. The <code>compute()</code> method is passed an <code>Activity.Info</code> object, which contains all current workout information.</p>

<p>The following is an example of a &#8220;Beers Earned&#8221; data field, which displays how many beers you have &#8220;earned&#8221; during your workout:</p>

<pre><code class="java">using Toybox.Application;
using Toybox.WatchUi;

class BeerView extends WatchUi.SimpleField
{
    function initialize() {
        units = &quot;beers&quot;;
    }

    function compute(info) {
        return info.calories / 150; // Calories in average bottle of beer
    }
}

class BeersEarned extends Application.AppBase
{
    function getInitialView() {
        return new BeerView();
    }
}
</code></pre>

<h2 id="activityinfo">Activity Info</h2>

<p>The <code>compute()</code> method will be called before update in a data field. This method allows the developer to run a computation based on the workout information. The workout information is passed in as a <code>Toybox.Activity.Info</code> object. This object contains all the info about the workout that is computed by the system:</p>

<pre><code class="java">module Activity
{
    class Info
    {
        var startLocation;              // Starting location of the activity, a Location object
        var startTime;                  // Starting time of activity, a Moment object
        var elapsedTime;                // Elapsed time of the activity in ms
        var timerTime;                  // Timer time in milliseconds
        var elapsedDistance;            // Distance in meters
        var currentLocationAccuracy;    // GPS Accuracy - See location constant
        var currentLocation;            // Current location, a Location object
        var calories;                   // Calories in kcal
        var currentSpeed;               // Speed in meters per second
        var averageSpeed;               // Average speed in meters per second
        var maxSpeed;                   // Maximum speed in meters per second
        var currentPace;                // Current pace in meters per second
        var currentPower;               // Current power in watts
        var averagePower;               // Average power in watts
        var maxPower;                   // Maximum power in watts
        var totalAscent;                // Total ascent in meters
        var totalDescent;               // Total descent in meters
        var currentHeartRate;           // Current heart rate in beats per minute
        var averageHeartRate;           // Average heart rate in beats per minute
        var maxHeartRate;               // Maximum heart rate in beats per minute
        var currentCadence;             // Current cadence in revolutions per minute
        var averageCadence;             // Average cadence in revolutions per minute
        var maximumCadence;             // Maximum cadence in revolutions per minute
        var swimStrokeType;             // Swim stroke type
        var swimSwolf;                  // Swim SWOLF
        var swimEfficency;              // Swim efficence
        var averageDistance;            // Swim stroke average distance
        var currentHeading;             // Current heading in radians
    }
}
</code></pre>

<p>The following is the API for the data fields:</p>

<pre><code class="java">// The DataField class is used for creating data fields. In a DataField, the
// developer will implement a compute method, which is called by the system once
// per second, with an Activity.Info object. The system will call the onUpdate()
// method inherited from View when the field is displayed by the system.
class DataField extends View
{
    // To retrieve Activity.Info data for DataFields, it is necessary to override compute().
    // This is the method that is called to update the field information.
    // @param [Activity.Info] info The updated Activity.Info object
    function compute( info );
}

// The SimpleDataField class is used for creating simple data fields.
// In a SimpleDataField, the developer is only required to implement a compute
// method. The compute method is passed an Activity.Info object, which contains
// all current workout information. The compute method should return a value to
// be displayed.  Allowed types are Number, Float, Long, Double, and String.
// The SimpleDataField also contains a variable &quot;label&quot;.  This variable should
// be assigned to a String label for the field.
class SimpleDataField extends DataField
{
    //! Constructor
    function initialize();

    //! To retrieve Activity.Info data for DataFields, it is necessary to override compute().
    //! This is the method that is called to update the field information.
    //! @param [Activity.Info] info The updated Activity.Info object
    function compute( info );
}
</code></pre>

<h2 id="simulatingaworkout">Simulating a Workout</h2>

<p>To test your data field in the simulator, feed your data field simulated databy clicking the <em>Simulation</em> menu, choose <em>FIT Data</em> and then <em>Simulate</em>. This will generate random but valid data. You can also use <em>Simulation</em> &gt; <em>FIT Data</em> &gt; <em>Playback File&#8230;</em> to simulate a workout by using a pre-recorded FIT file.</p>

<h1 id="howtotest">How To Test</h1>
<figure>
<img src="resources/programmers-guide/chopper-monkey.png" style="max-width:300px;" title="Gotta look this world in the eye, gotta live this life till you die" />
</figure>

<p>Connect IQ has a couple of different methods for testing and debugging your apps:</p>

<ol>
<li>Basic debugging with println() statements</li>
<li>Run No Evil unit test framework</li>
</ol>

<h2 id="basicdebugging">Basic Debugging</h2>

<p>One way to test Connect IQ apps is to include <code>System.println()</code> statements at strategic points in your app. Within Eclipse, these <code>println()</code> statements will output to the console. On a device, <code>println()</code> statements write to an <code>&lt;APPNAME&gt;.TXT file</code> in the <code>/GARMIN/APPS/LOGS</code> directory in the device file system.</p>

<p>These log files are not automatically created, so must be manually created on the device and named to match the name of the app&#8217;s corresponding <code>PRG</code> file. For example, to log output from <code>/GARMIN/APPS/MYAPP.PRG</code>, you must create <code>/GARMIN/APPS/LOGS/MYAPP.TXT</code>.</p>

<h2 id="runnoevil">Run No Evil</h2>

<p>For more advanced testing and degubbing capabilities, Connect IQ has <em>Run No Evil</em>, an automated unit testing framework found in the <code>Test</code> module. Run No Evil provides the ability to add asserts and unit test methods to your app. The unit tests include a handy logger with different logging levels for more meaningful error reporting.</p>

<p>Run No Evil operates only within the Connect IQ simulator. Asserts will always execute when an app is launched in the simulator, while unit test code will not execute unless the compiler is explicitly told to run unit tests. All test code is automatically removed at compile time when your app is exported for use on devices.</p>

<h3 id="asserts">Asserts</h3>

<p>Asserts are a useful way to check for conditions at critical points in your code. For example, if your app always expects the value of <code>x</code> and <code>y</code> to not be equal:</p>

<pre><code class="xml">function onShow() {
    var x = 1;
    var y = 1;
    // Prints an error to the console when x and y are equal
    Test.assertNotEqualMessage(x, y, &quot;x and y are equal!&quot;);
}
</code></pre>

<p>The code above produces the following output in the console when the app is run in the Simulator:</p>

<pre><code class="bash">Device Version 0.1.0
Device id 1 name &quot;A garmin device&quot;
Shell Version 0.1.0
ASSERTION FAILED: x and y are equal!
</code></pre>

<p>Assert code requires no special compiler commands to execute within the simulator, and are removed by the compiler when building release code. Run No Evil has four different assert flavors:</p>

<pre><code class="java">//! Assert throws an exception if the test is false
//! @param [Boolean] test Expression to test for true.
function assert(test);

//! Assert throws an exception if the test is false
//! @param [Boolean] test Expression to test for true.
//! @param [String] the identifying message for the assert.
function assertMessage(test, message);

//! Throws an exception if value1 and value2 are not equal
//! @param [Object] Value to test for equality
//! @param [Object] Value to test for equality
function assertNotEqual(value1, value2);

//! Throws an exception if value1 and value2 are not equal
//! @param [Object] Value to test for equality
//! @param [Object] Value to test for equality
//! @param [String] the identifying message for the assert.
function assertNotEqualMessage(value1, value2, message);
</code></pre>

<h3 id="unittests">Unit Tests</h3>

<p>Unit tests are a great way to check discrete pieces of your app for pass/fail criteria. Each test is run independently, so if a test fails or causes a crash, the test will be marked as a failed test and the next test will automatically be executed. This allows an entire suite of tests to be run with a single command in an automated fashion.</p>

<p>Unit tests are written mostly like any other class, module, or function in Monkey C, but have the following requirements:</p>

<ol>
<li>Tests methods must be marked with the <code>:test</code> annotation</li>
<li>Test methods must take a Logger object</li>
<li>Tests methods that are not global (part of a test class or custom test module) must be static methods</li>
</ol>

<p>Here is a simple example of a unit test method:</p>

<pre><code class="java">// Unit test to check if 2 + 2 == 4
(:test)
function myUnitTest(logger) {
    var x = 2 + 2; logger.debug(&quot;x = &quot; + x);
    return (x == 4); // returning true indicates pass, false indicates failure
}
</code></pre>

<p>The sample code above uses a &#8220;debug&#8221; logging level, but the Logger contains a total of three logging levels that can be used to distinguish between different types of errors in your unit test output:</p>

<pre><code class="java">//! Write a debug string to the output stream. The String is prefixed with [DEBUG] and time stamp
//! @param [String] Output string
function debug(str);

//! Write a warning string to the output stream. The String is prefixed with [WARNING] and time stamp
//! @param [String] Output string
function warning(str);

//! Write an error string to the output stream. The String is prefixed with [ERROR] and time stamp
//! @param [String] Error string
function error(str);
</code></pre>

<h3 id="runningunittests">Running Unit Tests</h3>

<p>Unlike asserts, which always execute in the simulator, unit tests only run when the compiler is told to run them. Unit tests must be executed from the terminal and are not currently available in the Eclipse plug-in. Fortunately, it&#8217;s a straight-forward, three-step process:</p>

<ol>
<li><strong>Build the Project:</strong> Use the <code>--unit-test</code> flag on the build command to compile with unit tests. It&#8217;s usually easiest to copy and paste the build command from the Eclipse console and add the unit test flag.</li>
<li><strong>Launch the Simulator</strong>: You must use the <code>connectiq</code> script in your SDK&#8217;s bin directory to launch the simulator from the terminal (no arguments required).</li>
<li><strong>Run the App</strong>: Use the <code>monkeydo</code> script in your SDK&#8217;s bin directory with the <code>-t</code> flag to run the app with unit tests enabled:</li>
</ol>

<pre><code class="bash">monkeydo.bat path\to\projects\bin\MyApp.prg -t
</code></pre>

<p>You may also supply a function name after <code>-t</code> to run the test associated with a single function. The sample unit test above produces the following output in the console:</p>

<pre><code class="bash">Device Version 0.1.0
Device id 1 name &quot;A garmin device&quot;
Shell Version 0.1.0
------------------------------------------------------------------------------
Executing test myUnitTest...
DEBUG (14:16): x = 4
Pass
==============================================================================
RESULTS
Test:                           Status:
myUnitTest                      Pass
Ran 1 test

PASSED (failures=0, errors=0)
Connection Finished
Closing shell and port
</code></pre>

<h2 id="handlingcrashes">Handling Crashes</h2>

<p>Despite the best debugging efforts, crashes will sometimes happen. There are two general types of on-device crash that can occur related to Connect IQ, which each generate log files: <em>app crashes</em> and <em>device crashes</em>.</p>

<h3 id="appcrashes">App Crashes</h3>

<p>App crashes typically result in an app quitting unexpectedly or displaying an &#8216;IQ!&#8217; icon, but does not cause the entire device to crash or reboot. This kind of crash is most commonly due to a bug in an app, though it can also be due to a bug in Connect IQ itself. Whenever an app crash occurs, a <code>CIQ_LOG.txt</code> file is written or updated to <code>/GARMIN/APPS/LOGS</code> on the device, and contains information related to the crash that app developers may use to address the problem.</p>

<h3 id="devicecrashes">Device Crashes</h3>

<p>Device crashes typically cause the device to reboot or freeze. These indicate a Connect IQ or device firmware bug, and should be much less common than app crashes. When a device crash occurs, an <code>ERR_LOG.txt</code> file is written to <code>/GARMIN</code> on the device, containing stack trace information related to the crash. Please provide this file when reporting a crash on our developer forum. Garmin&#8217;s device teams can take a look at the device crash logs to determine the cause of the crash and will typically provide a fix in a future firmware release.</p>

<h3 id="anoteaboutlogfiles">A Note About Log Files</h3>

<p>When any log file on a device exceeds 5kb in size, it will automatically be archived to <code>&lt;LOGNAME&gt;.BAK</code>, and a new log will be started. Any old <code>.BAK</code> files will be overwritten when the archive occurs, so the max space a log can reach is around 10kb.</p>

<h1 id="howtopublish">How To Publish</h1>
<figure>
<img src="resources/programmers-guide/captain-monkey.png" style="max-width:300px;" title="Just sit back now and you'll hear a tale; a tale of a fateful trip..." />
</figure>

<p>We&#8217;re glad you want to develop for Garmin devices, and we want you to be successful. Here are some guidelines to keep in mind as you develop your apps. These guidelines will help you speed through the approval process:</p>

<ul>
<li>We will reject submissions for any content or behavior that we believe is inappropriate</li>
<li>If your submission doesn&#8217;t function or crashes frequently, it may not be accepted</li>
<li>Your submission cannot use GPS data in a way that violates our developer terms of use</li>
<li>Do not use trademarked or copyrighted content without permission</li>
<li>These guidelines may change at any time</li>
</ul>

<p>Once your apps are fully tested and ready to go, you can publish and promote your apps to the Garmin Connect IQ App Store. Here&#8217;s how to prepare your apps for submission.</p>

<ol>
<li>Make sure the manifest file specifies all products supported by the app</li>
<li>Use the App Export Wizard to generate an IQ file, which will contain binaries for each supported device</li>
<li>Upload the app to the App Store</li>
</ol>

<h2 id="checksupportedproducts">Check Supported Products</h2>

<p>It is easy to quickly check the products supported by an app by viewing the manifest XML file in the project root:</p>

<pre><code class="xml">&lt;iq:products&gt;
    &lt;iq:product id=&quot;round_watch&quot;/&gt;
    &lt;iq:product id=&quot;vivoactive&quot;/&gt;
    &lt;iq:product id=&quot;fr920xt&quot;/&gt;
    &lt;iq:product id=&quot;epix&quot;/&gt;
&lt;/iq:products&gt;
</code></pre>

<p>Alternatively, right-click the project in the Eclipse Project Explorer, and choose <em>Properties</em>. The Properties window provides an easy way to edit targeted platforms and permissions:</p>
<figure>
<img src="resources/programmers-guide/app_properties.png" style="max-width:635px;" title="The App Properties Windows in Eclipse" />
</figure>

<h2 id="exportingtheapp">Exporting the App</h2>

<p>Launch the App Export Wizard in Eclipse by clicking the <em>Connect IQ</em> menu and selecting <em>App Export Wizard</em>:</p>
<figure>
<img src="resources/programmers-guide/export_wizard.png" style="max-width:525px;" title="The App Export Device Wizard" />
</figure>

<p>If needed, click <em>Next</em> to select supported languages, and then click <em>Finish</em> to generate an app package (a .iq file). If there are no errors your app is ready to publish!</p>

<h2 id="publishingthefirstversion">Publishing the First Version</h2>

<p>To upload the IQ file to your developer account, start by visiting the <a href="http://developer.garmin.com/connect-iq/submit-an-app/">Submit an App</a> page of the Garmin Developer site. Click on the <em>Submit an App</em> button to fill out the form shown below:</p>
<figure>
<img src="resources/programmers-guide/upload_app.png" style="max-width:600px;" title="Uploading an app to the App Store" />
</figure>

<p>Once the IQ file has been validated, add in a description, screen shots, and other details about your app:</p>
<figure>
<img src="resources/programmers-guide/title_description.png" style="max-width:600px;" title="Adding a title and description" />
</figure>

<h1 id="approvalprocess">Approval Process</h1>

<p>After the app is successfully uploaded, the Connect IQ team will review it. Aside from some special circumstances, such as national holidays, the Connect IQ team will complete app reviews and approvals within 72 hours of your submission. If your app talks to an ANT+ compatible device, extra time will be needed to have the app evaluated by the ANT+ certification team.</p>

<p>While approval is pending, your app will not appear on the Garmin Connect App Store, but you will be able to preview your app and download it yourself for testing. Once it&#8217;s approved, you will receive a notification and it will appear on the Connect IQ App Store for all users to download and load to their devices!</p>

<p>If for some reason your app is rejected, don&#8217;t despair! The Connect IQ team will provide specific reasons for the rejection via email, and may work with you to resolve issues. The app will continue to be available for you to update as needed and re-submit for approval, but it will not be displayed on the Connect IQ App Store until approved.</p>

<h1 id="appendices">Appendices</h1>

<h2 id="appendixa:supportedlanguagequalifiers">Appendix A: Supported Language Qualifiers</h2>

<p>Below is a table containing the language qualifiers the compiler will recognize. This list is a subset of the <a href="https://www.loc.gov/standards/iso639-2/php/code_list.php">ISO 639&#8211;2 3-Character codes</a>.</p>
<div id="languages">

<table>
<colgroup>
<col style="text-align:left;"/>
<col style="text-align:center;"/>
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Language</th>
	<th style="text-align:center;">Qualifier</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">Chinese (simplified)</td>
	<td style="text-align:center;">zhs</td>
</tr>
<tr>
	<td style="text-align:left;">Chinese (traditional)</td>
	<td style="text-align:center;">zht</td>
</tr>
<tr>
	<td style="text-align:left;">Croatian</td>
	<td style="text-align:center;">hrv</td>
</tr>
<tr>
	<td style="text-align:left;">Czech</td>
	<td style="text-align:center;">ces</td>
</tr>
<tr>
	<td style="text-align:left;">Danish</td>
	<td style="text-align:center;">dan</td>
</tr>
<tr>
	<td style="text-align:left;">Dutch</td>
	<td style="text-align:center;">dut</td>
</tr>
<tr>
	<td style="text-align:left;">English</td>
	<td style="text-align:center;">eng</td>
</tr>
<tr>
	<td style="text-align:left;">Finnish</td>
	<td style="text-align:center;">fin</td>
</tr>
<tr>
	<td style="text-align:left;">French</td>
	<td style="text-align:center;">fre</td>
</tr>
<tr>
	<td style="text-align:left;">German</td>
	<td style="text-align:center;">deu</td>
</tr>
<tr>
	<td style="text-align:left;">Greek</td>
	<td style="text-align:center;">gre</td>
</tr>
<tr>
	<td style="text-align:left;">Hungarian</td>
	<td style="text-align:center;">hun</td>
</tr>
<tr>
	<td style="text-align:left;">Indonesian</td>
	<td style="text-align:center;">ind</td>
</tr>
<tr>
	<td style="text-align:left;">Italian</td>
	<td style="text-align:center;">ita</td>
</tr>
<tr>
	<td style="text-align:left;">Japanese</td>
	<td style="text-align:center;">jpn</td>
</tr>
<tr>
	<td style="text-align:left;">Norwegian</td>
	<td style="text-align:center;">nob</td>
</tr>
<tr>
	<td style="text-align:left;">Polish</td>
	<td style="text-align:center;">pol</td>
</tr>
<tr>
	<td style="text-align:left;">Portuguese</td>
	<td style="text-align:center;">por</td>
</tr>
<tr>
	<td style="text-align:left;">Russian</td>
	<td style="text-align:center;">rus</td>
</tr>
<tr>
	<td style="text-align:left;">Slovak</td>
	<td style="text-align:center;">slo</td>
</tr>
<tr>
	<td style="text-align:left;">Slovenian</td>
	<td style="text-align:center;">slv</td>
</tr>
<tr>
	<td style="text-align:left;">Spanish</td>
	<td style="text-align:center;">spa</td>
</tr>
<tr>
	<td style="text-align:left;">Standard (Bahasa) Malay</td>
	<td style="text-align:center;">zsm</td>
</tr>
<tr>
	<td style="text-align:left;">Swedish</td>
	<td style="text-align:center;">swe</td>
</tr>
<tr>
	<td style="text-align:left;">Thai</td>
	<td style="text-align:center;">tha</td>
</tr>
</tbody>
</table>
</div>

<div class="footnotes">
<hr />
<ol>

<li id="fn:1">
<p>This is different than Monkey Typing, where a thousand monkeys over infinite time write the works of Shakespeare. <a href="#fnref:1" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

<li id="fn:2">
<p>Tofu for the vegetarians, BBQ for Kansans&hellip; <a href="#fnref:2" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

<li id="fn:3">
<p>Not that this ever happened to the author. <a href="#fnref:3" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

<li id="fn:4">
<p>We are all about conflict avoidance here. <a href="#fnref:4" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

<li id="fn:5">
<p>Do not forget to match your bling with pieces of flair; you can&#8217;t have enough of either. <a href="#fnref:5" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

<li id="fn:6">
<p>How can we possibly tell who is more at peace with the universe if we don&#8217;t have a metric? <a href="#fnref:6" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

<li id="fn:7">
<p>WML is gonna be making a comeback Liz! Technology is cyclical! <a href="#fnref:7" title="return to article" class="reversefootnote">&#160;&#8617;</a></p>
</li>

</ol>
</div>


</body>
</html>
